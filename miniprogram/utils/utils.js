"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../service/api.service");
const showModal = (title, content) => {
    const model = {
        title: title ? title : '网络异常',
    };
    if (content) {
        model.content = content;
    }
    wx.showModal(model);
};
exports.showModal = showModal;
const showModelAction = (title, success) => {
    const model = {
        title: title ? title : '网络异常',
        success: function (_) {
            success();
        }
    };
    wx.showModal(model);
};
exports.showModelAction = showModelAction;
const cityReplace = (val) => {
    return val.replace(/市$/, '');
};
exports.cityReplace = cityReplace;
const validateEmpty = (value, desc) => {
    if (!value) {
        wx.showToast({
            title: desc,
            icon: 'none',
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validateEmpty = validateEmpty;
const validateImages = (images, desc) => {
    if (images.length <= 0) {
        wx.showToast({
            title: desc,
            icon: 'none',
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validateImages = validateImages;
const validatePhone = (phone, desc) => {
    const myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
    if (!myreg.test(phone)) {
        wx.showToast({
            title: desc,
            icon: 'none',
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validatePhone = validatePhone;
const phoneCall = (e) => {
    const phone = e.currentTarget.dataset.phone;
    wx.makePhoneCall({
        phoneNumber: phone,
    });
};
exports.phoneCall = phoneCall;
const getDate = (dateStr) => {
    const date = new Date(dateStr);
    const year = date.getFullYear();
    let month = date.getMonth() + 1;
    month = month <= 9 ? `0${month}` : month;
    let day = date.getDate();
    day = day <= 9 ? `0${day}` : day;
    return `${year}年${month}月${day}日`;
};
exports.getDate = getDate;
const getTime = (dateStr) => {
    const date = new Date(dateStr);
    let hours = date.getHours();
    hours = hours <= 9 ? `0${hours}` : hours;
    let minutes = date.getMinutes();
    minutes = minutes <= 9 ? `0${minutes}` : minutes;
    return `${minutes}:${minutes}`;
};
exports.getTime = getTime;
function formatTime(date) {
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const hour = date.getHours();
    const minute = date.getMinutes();
    const second = date.getSeconds();
    return [year, month, day].map(formatNumber).join('/') + ' ' + [hour, minute, second].map(formatNumber).join(':');
}
exports.formatTime = formatTime;
const formatNumber = (n) => {
    const str = n.toString();
    return str[1] ? str : '0' + str;
};
const getUserInfo = () => {
    let userInfo = {};
    wx.getStorage({
        key: 'user',
        success: function (res) {
            const { openid } = res.data;
            userInfo = Api.getUserInfo(openid).then((result) => {
                if (result) {
                    return result.data || {};
                }
            });
        },
    });
    return userInfo;
};
const dealRightIntercept = (rightType) => {
    let userInfo = getUserInfo();
    const { vipType = '' } = userInfo;
    let needIntercept = false;
    let times = 0;
    let rightTypeData = wx.getStorageSync(rightType);
    let timesNow = rightTypeData.times || 0;
    let rightConfig = wx.getStorageSync('rightConfig');
    switch (vipType) {
        case '':
            times = rightConfig[0][rightType];
            console.log('读取拦截times：', times);
            needIntercept = timesNow >= times;
            break;
        case 'bronze':
            times = rightConfig[1][rightType];
            console.log('读取拦截times：', times);
            needIntercept = timesNow >= times;
            break;
        case 'platinum':
            times = rightConfig[2][rightType];
            console.log('读取拦截times：', times);
            needIntercept = timesNow >= times;
            break;
        default:
            needIntercept = false;
            break;
    }
    return needIntercept;
};
exports.dealRightIntercept = dealRightIntercept;
const setRightStorage = (rightType, value = 0) => {
    let times = 0;
    let rightData = wx.getStorageSync(rightType);
    let dateNow = new Date();
    if (rightData.updateTime && rightData.updateTime.toDateString() == dateNow.toDateString()) {
        times = rightData.times + 1;
    }
    if (value) {
        times = value;
    }
    console.log('设置times：', times);
    wx.setStorage({
        key: rightType,
        data: {
            times,
            dateNow,
        }
    });
};
exports.setRightStorage = setRightStorage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUE4QztBQUc5QyxNQUFNLFNBQVMsR0FBRyxDQUFDLEtBQVcsRUFBRSxPQUFhLEVBQUUsRUFBRTtJQUMvQyxNQUFNLEtBQUssR0FBUTtRQUNqQixLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU07S0FDOUIsQ0FBQTtJQUNELElBQUksT0FBTyxFQUFFO1FBQ1gsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7S0FDeEI7SUFDRCxFQUFFLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ3JCLENBQUMsQ0FBQTtBQTRLQyw4QkFBUztBQTFLWCxNQUFNLGVBQWUsR0FBRyxDQUFDLEtBQVUsRUFBRSxPQUFpQixFQUFFLEVBQUU7SUFDeEQsTUFBTSxLQUFLLEdBQVE7UUFDakIsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNO1FBQzdCLE9BQU8sRUFBRSxVQUFTLENBQU07WUFDdEIsT0FBTyxFQUFFLENBQUE7UUFDWCxDQUFDO0tBQ0YsQ0FBQTtJQUNELEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDckIsQ0FBQyxDQUFBO0FBbUtDLDBDQUFlO0FBaktqQixNQUFNLFdBQVcsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFO0lBQy9CLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDL0IsQ0FBQyxDQUFBO0FBZ0tDLGtDQUFXO0FBN0piLE1BQU0sYUFBYSxHQUFHLENBQUMsS0FBVSxFQUFFLElBQVEsRUFBRSxFQUFFO0lBQzdDLElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDVixFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1gsS0FBSyxFQUFFLElBQUk7WUFD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cnZpY2UvYXBpLnNlcnZpY2UnO1xuXG5cbmNvbnN0IHNob3dNb2RhbCA9ICh0aXRsZT86IGFueSwgY29udGVudD86IGFueSkgPT4ge1xuICBjb25zdCBtb2RlbDogYW55ID0ge1xuICAgIHRpdGxlOiB0aXRsZSA/IHRpdGxlIDogJ+e9kee7nOW8guW4uCcsXG4gIH1cbiAgaWYgKGNvbnRlbnQpIHtcbiAgICBtb2RlbC5jb250ZW50ID0gY29udGVudFxuICB9XG4gIHd4LnNob3dNb2RhbChtb2RlbClcbn1cblxuY29uc3Qgc2hvd01vZGVsQWN0aW9uID0gKHRpdGxlOiBhbnksIHN1Y2Nlc3M6IEZ1bmN0aW9uKSA9PiB7XG4gIGNvbnN0IG1vZGVsOiBhbnkgPSB7XG4gICAgdGl0bGU6IHRpdGxlID8gdGl0bGUgOiAn572R57uc5byC5bi4JyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbihfOiBhbnkpIHtcbiAgICAgIHN1Y2Nlc3MoKVxuICAgIH1cbiAgfVxuICB3eC5zaG93TW9kYWwobW9kZWwpXG59XG5cbmNvbnN0IGNpdHlSZXBsYWNlID0gKHZhbDogYW55KSA9PiB7XG4gIHJldHVybiB2YWwucmVwbGFjZSgv5biCJC8sICcnKTtcbn1cblxuLyoqIOagoemqjOWtl+auteS4jeiDveS4uuepuiAqL1xuY29uc3QgdmFsaWRhdGVFbXB0eSA9ICh2YWx1ZTogYW55LCBkZXNjOmFueSkgPT4ge1xuICBpZiAoIXZhbHVlKSB7XG4gICAgd3guc2hvd1RvYXN0KHtcbiAgICAgIHRpdGxlOiBkZXNjLFxuICAgICAgaWNvbjogJ25vbmUnLFxuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vKiog5qCh6aqM5LiK5Lyg5Zu+54mHICovXG5jb25zdCB2YWxpZGF0ZUltYWdlcyA9IChpbWFnZXM6YW55LCBkZXNjOmFueSkgPT4ge1xuICBpZiAoaW1hZ2VzLmxlbmd0aCA8PSAwKSB7XG4gICAgd3guc2hvd1RvYXN0KHtcbiAgICAgIHRpdGxlOiBkZXNjLFxuICAgICAgaWNvbjogJ25vbmUnLFxuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vKiog5qCh6aqM5omL5py65Y+356CB5qC85byPICovXG5jb25zdCB2YWxpZGF0ZVBob25lID0gKHBob25lOmFueSwgZGVzYzphbnkpID0+IHtcbiAgY29uc3QgbXlyZWcgPSAvXlsxXVszLDQsNSw3LDhdWzAtOV17OX0kLztcbiAgaWYgKCFteXJlZy50ZXN0KHBob25lKSkge1xuICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICB0aXRsZTogZGVzYyxcbiAgICAgIGljb246ICdub25lJyxcbiAgICB9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuY29uc3QgcGhvbmVDYWxsID0gKGU6IGFueSkgPT4ge1xuICBjb25zdCBwaG9uZSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnBob25lXG4gIHd4Lm1ha2VQaG9uZUNhbGwoe1xuICAgIHBob25lTnVtYmVyOiBwaG9uZSxcbiAgfSlcbn1cblxuLyoqIDIwMjDlubQwM+aciDA55pelICovXG5jb25zdCBnZXREYXRlID0gKGRhdGVTdHI6IHN0cmluZykgPT4ge1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cik7XG4gIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gIGxldCBtb250aDogbnVtYmVyIHwgc3RyaW5nID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgbW9udGggPSBtb250aCA8PSA5ID8gYDAke21vbnRofWAgOiBtb250aDtcbiAgbGV0IGRheTogbnVtYmVyIHwgc3RyaW5nID0gZGF0ZS5nZXREYXRlKCk7XG4gIGRheSA9IGRheSA8PSA5ID8gYDAke2RheX1gIDogZGF5O1xuICByZXR1cm4gYCR7eWVhcn3lubQke21vbnRofeaciCR7ZGF5feaXpWA7XG59O1xuXG4vKiogMDk6MjMgKi9cbmNvbnN0IGdldFRpbWUgPSAoZGF0ZVN0cjogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTtcbiAgbGV0IGhvdXJzOiBudW1iZXIgfCBzdHJpbmcgPSBkYXRlLmdldEhvdXJzKCk7XG4gIGhvdXJzID0gaG91cnMgPD0gOSA/IGAwJHtob3Vyc31gIDogaG91cnM7XG4gIGxldCBtaW51dGVzOiBudW1iZXIgfCBzdHJpbmcgPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgbWludXRlcyA9IG1pbnV0ZXMgPD0gOSA/IGAwJHttaW51dGVzfWAgOiBtaW51dGVzO1xuICByZXR1cm4gYCR7bWludXRlc306JHttaW51dGVzfWA7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFRpbWUoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKClcbiAgY29uc3QgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxXG4gIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpXG4gIGNvbnN0IGhvdXIgPSBkYXRlLmdldEhvdXJzKClcbiAgY29uc3QgbWludXRlID0gZGF0ZS5nZXRNaW51dGVzKClcbiAgY29uc3Qgc2Vjb25kID0gZGF0ZS5nZXRTZWNvbmRzKClcblxuICByZXR1cm4gW3llYXIsIG1vbnRoLCBkYXldLm1hcChmb3JtYXROdW1iZXIpLmpvaW4oJy8nKSArICcgJyArIFtob3VyLCBtaW51dGUsIHNlY29uZF0ubWFwKGZvcm1hdE51bWJlcikuam9pbignOicpXG59XG5cbmNvbnN0IGZvcm1hdE51bWJlciA9IChuOiBudW1iZXIpID0+IHtcbiAgY29uc3Qgc3RyID0gbi50b1N0cmluZygpXG4gIHJldHVybiBzdHJbMV0gPyBzdHIgOiAnMCcgKyBzdHJcbn1cblxuLyoqIOiOt+WPlueUqOaIt+S/oeaBryAqL1xuY29uc3QgZ2V0VXNlckluZm8gPSAoKSA9PiB7XG4gIGxldCB1c2VySW5mbzogYW55ID0ge307XG4gIHd4LmdldFN0b3JhZ2Uoe1xuICAgIGtleTogJ3VzZXInLCAvLyDnlKjmiLflpLTlg4/kv6Hmga9cbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICBjb25zdCB7IG9wZW5pZCB9ID0gcmVzLmRhdGE7XG4gICAgICB1c2VySW5mbyA9IEFwaS5nZXRVc2VySW5mbyhvcGVuaWQpLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0LmRhdGEgfHwge307XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gdXNlckluZm87XG59O1xuXG5cbi8qKiDlpITnkIbmnYPnm4rmi6bmiKogKi9cbmNvbnN0IGRlYWxSaWdodEludGVyY2VwdCA9IChyaWdodFR5cGU6IHN0cmluZyApID0+IHtcbiAgbGV0IHVzZXJJbmZvID0gZ2V0VXNlckluZm8oKTtcbiAgY29uc3QgeyB2aXBUeXBlID0gJycgfSA9IHVzZXJJbmZvO1xuICBsZXQgbmVlZEludGVyY2VwdCA9IGZhbHNlOyAvLyDmmK/lkKbpnIDopoHmi6bmiKpcbiAgbGV0IHRpbWVzID0gMDtcbiAgbGV0IHJpZ2h0VHlwZURhdGEgPSB3eC5nZXRTdG9yYWdlU3luYyhyaWdodFR5cGUpOyAvLyDku47nvJPlrZjkuK3ojrflj5bmnYPnm4rkvb/nlKjmg4XlhrVcbiAgbGV0IHRpbWVzTm93ID0gcmlnaHRUeXBlRGF0YS50aW1lcyB8fCAwO1xuICBsZXQgcmlnaHRDb25maWc6IGFueSA9IHd4LmdldFN0b3JhZ2VTeW5jKCdyaWdodENvbmZpZycpOyAvLyDku47nvJPlrZjkuK3or7vlj5bpppbpobXkuK1zZXTnmoTmnYPnm4rphY3nva5cbiAgc3dpdGNoICh2aXBUeXBlKSB7XG4gICAgY2FzZSAnJzogLy8g5pmu6YCaXG4gICAgICB0aW1lcyA9IHJpZ2h0Q29uZmlnWzBdW3JpZ2h0VHlwZV07XG4gICAgICBjb25zb2xlLmxvZygn6K+75Y+W5oum5oiqdGltZXPvvJonLCB0aW1lcyk7XG4gICAgICBuZWVkSW50ZXJjZXB0ID0gdGltZXNOb3cgPj0gdGltZXM7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdicm9uemUnOiAvLyDpu4Tpk5xcbiAgICAgIHRpbWVzID0gcmlnaHRDb25maWdbMV1bcmlnaHRUeXBlXTtcbiAgICAgIGNvbnNvbGUubG9nKCfor7vlj5bmi6bmiKp0aW1lc++8micsIHRpbWVzKTtcbiAgICAgIG5lZWRJbnRlcmNlcHQgPSB0aW1lc05vdyA+PSB0aW1lcztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3BsYXRpbnVtJzogLy8g55m96YeRXG4gICAgICB0aW1lcyA9IHJpZ2h0Q29uZmlnWzJdW3JpZ2h0VHlwZV07XG4gICAgICBjb25zb2xlLmxvZygn6K+75Y+W5oum5oiqdGltZXPvvJonLCB0aW1lcyk7XG4gICAgICBuZWVkSW50ZXJjZXB0ID0gdGltZXNOb3cgPj0gdGltZXM7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbmVlZEludGVyY2VwdCA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIG5lZWRJbnRlcmNlcHQ7XG59XG5cbmNvbnN0IHNldFJpZ2h0U3RvcmFnZSA9IChyaWdodFR5cGU6IHN0cmluZywgdmFsdWUgPSAwKSA9PiB7XG4gIGxldCB0aW1lcyA9IDA7XG4gIGxldCByaWdodERhdGEgPSB3eC5nZXRTdG9yYWdlU3luYyhyaWdodFR5cGUpO1xuICBsZXQgZGF0ZU5vdyA9IG5ldyBEYXRlKCk7XG4gIC8vIOWIpOaWreaYr+WQpuaYr+WQjOS4gOWkqVxuICBpZiAocmlnaHREYXRhLnVwZGF0ZVRpbWUgJiYgcmlnaHREYXRhLnVwZGF0ZVRpbWUudG9EYXRlU3RyaW5nKCkgPT0gZGF0ZU5vdy50b0RhdGVTdHJpbmcoKSkge1xuICAgIHRpbWVzID0gcmlnaHREYXRhLnRpbWVzICsgMTtcbiAgfVxuICBpZiAodmFsdWUpIHtcbiAgICB0aW1lcyA9IHZhbHVlO1xuICB9XG4gIGNvbnNvbGUubG9nKCforr7nva50aW1lc++8micsIHRpbWVzKTtcbiAgd3guc2V0U3RvcmFnZSh7XG4gICAga2V5OiByaWdodFR5cGUsXG4gICAgZGF0YToge1xuICAgICAgdGltZXMsXG4gICAgICBkYXRlTm93LFxuICAgIH0gXG4gIH0pO1xufVxuXG5leHBvcnQge1xuICBzaG93TW9kYWwsXG4gIHNob3dNb2RlbEFjdGlvbixcbiAgY2l0eVJlcGxhY2UsXG4gIHZhbGlkYXRlRW1wdHksXG4gIHZhbGlkYXRlSW1hZ2VzLFxuICB2YWxpZGF0ZVBob25lLFxuICBwaG9uZUNhbGwsXG4gIGdldERhdGUsXG4gIGdldFRpbWUsXG4gIGZvcm1hdFRpbWUsXG4gIGRlYWxSaWdodEludGVyY2VwdCxcbiAgc2V0UmlnaHRTdG9yYWdlLFxufSJdfQ==
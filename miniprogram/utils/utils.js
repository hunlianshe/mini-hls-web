"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../service/api.service");
const showModal = (title, content) => {
    const model = {
        title: title ? title : "网络异常",
    };
    if (content) {
        model.content = content;
    }
    wx.showModal(model);
};
exports.showModal = showModal;
const showModelAction = (title, success) => {
    const model = {
        title: title ? title : "网络异常",
        success: function (_) {
            success();
        },
    };
    wx.showModal(model);
};
exports.showModelAction = showModelAction;
const cityReplace = (val) => {
    return val.replace(/市$/, "");
};
exports.cityReplace = cityReplace;
const validateEmpty = (value, desc) => {
    if (!value) {
        wx.showToast({
            title: desc,
            icon: "none",
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validateEmpty = validateEmpty;
const validateMoney = (value, desc) => {
    let ret = /^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;
    ret = new RegExp(ret);
    if (!ret.test(value)) {
        wx.showToast({
            title: desc,
            icon: "none",
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validateMoney = validateMoney;
const validateImages = (images, desc) => {
    if (images.length <= 0) {
        wx.showToast({
            title: desc,
            icon: "none",
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validateImages = validateImages;
const validatePhone = (phone, desc) => {
    const myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
    if (!myreg.test(phone)) {
        wx.showToast({
            title: desc,
            icon: "none",
        });
        return false;
    }
    else {
        return true;
    }
};
exports.validatePhone = validatePhone;
const phoneCall = (e) => {
    const phone = e.currentTarget.dataset.phone;
    wx.makePhoneCall({
        phoneNumber: phone,
    });
};
exports.phoneCall = phoneCall;
const getDate = (dateStr) => {
    if (!dateStr) {
        return "";
    }
    const date = new Date(dateStr);
    const year = date.getFullYear();
    let month = date.getMonth() + 1;
    month = month <= 9 ? `0${month}` : month;
    let day = date.getDate();
    day = day <= 9 ? `0${day}` : day;
    return `${year}年${month}月${day}日`;
};
exports.getDate = getDate;
const getTime = (dateStr) => {
    const date = new Date(dateStr);
    let hours = date.getHours();
    hours = hours <= 9 ? `0${hours}` : hours;
    let minutes = date.getMinutes();
    minutes = minutes <= 9 ? `0${minutes}` : minutes;
    return `${hours}:${minutes}`;
};
exports.getTime = getTime;
function formatTime(date) {
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const hour = date.getHours();
    const minute = date.getMinutes();
    const second = date.getSeconds();
    return ([year, month, day].map(formatNumber).join("/") +
        " " +
        [hour, minute, second].map(formatNumber).join(":"));
}
exports.formatTime = formatTime;
function formatHLSTime(dateStr) {
    if (dateStr === "") {
        return "";
    }
    const date = new Date(dateStr);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    console.log(`-------`, year, month, day);
    return [year, month, day].map(formatNumber).join(".");
}
exports.formatHLSTime = formatHLSTime;
const formatNumber = (n) => {
    const str = n.toString();
    return str[1] ? str : "0" + str;
};
const getUserInfo = () => {
    let userInfo = {};
    wx.getStorage({
        key: "user",
        success: function (res) {
            const { openid } = res.data;
            userInfo = Api.getUserInfo(openid).then((result) => {
                console.log("result", result);
                if (result) {
                    return result.data || {};
                }
            });
        },
    });
    return userInfo;
};
exports.getUserInfo = getUserInfo;
const dealRightIntercept = (rightType) => {
    const userInfo = wx.getStorageSync("userInfo");
    console.log("userInfo", userInfo);
    const { vipType = "" } = userInfo;
    let needIntercept = false;
    let times = 0;
    let rightTypeData = wx.getStorageSync(rightType);
    let timesNow = rightTypeData.times || 0;
    let rightConfig = wx.getStorageSync("rightConfig");
    switch (vipType) {
        case "":
            times = rightConfig[0][rightType];
            console.log("读取拦截times：", times);
            needIntercept = timesNow >= times;
            break;
        case "bronze":
            times = rightConfig[1][rightType];
            console.log("读取拦截times：", times);
            console.log("xianzaitimes：", timesNow);
            needIntercept = timesNow >= times;
            break;
        case "platinum":
            times = rightConfig[2][rightType];
            console.log("读取拦截times：", times);
            needIntercept = timesNow >= times;
            break;
        default:
            needIntercept = false;
            break;
    }
    return needIntercept;
};
exports.dealRightIntercept = dealRightIntercept;
const setRightStorage = (rightType, value = 0) => {
    let times = 0;
    let rightData = wx.getStorageSync(rightType);
    let dateNow = new Date();
    if (rightData.updateTime &&
        rightData.updateTime.toDateString() == dateNow.toDateString()) {
        times = rightData.times + 1;
    }
    if (value) {
        times = value;
    }
    console.log("设置times：", times);
    wx.setStorage({
        key: rightType,
        data: {
            times,
            dateNow,
        },
    });
};
exports.setRightStorage = setRightStorage;
const dealFateChatIntercept = (toOpenid) => {
    let rightType = "fateChat";
    const userInfo = wx.getStorageSync("userInfo");
    const vipType = userInfo.vipType || "";
    let needIntercept = false;
    let times = 0;
    let chatSession = wx.getStorageSync("chatSession");
    console.log("chatSession>>>>", chatSession);
    let openidList = chatSession.openidList || [];
    let timesNow = openidList.length;
    let rightConfig = wx.getStorageSync("rightConfig");
    const findIndex = openidList.findIndex((openid) => openid === toOpenid);
    switch (vipType) {
        case "":
            times = rightConfig[0][rightType];
            console.log("读取拦截times：", times);
            if (timesNow < times || findIndex !== -1) {
                needIntercept = false;
            }
            else {
                needIntercept = true;
            }
            break;
        case "bronze":
            times = rightConfig[1][rightType];
            console.log("读取拦截times：", times);
            console.log("timesNow:", timesNow);
            if (timesNow < times || findIndex !== -1) {
                needIntercept = false;
            }
            else {
                needIntercept = true;
            }
            break;
        case "platinum":
            times = rightConfig[2][rightType];
            console.log("读取拦截times：", times);
            if (timesNow < times || findIndex !== -1) {
                needIntercept = false;
            }
            else {
                needIntercept = true;
            }
            break;
        default:
            needIntercept = false;
            break;
    }
    return needIntercept;
};
exports.dealFateChatIntercept = dealFateChatIntercept;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUE4QztBQUU5QyxNQUFNLFNBQVMsR0FBRyxDQUFDLEtBQVcsRUFBRSxPQUFhLEVBQUUsRUFBRTtJQUMvQyxNQUFNLEtBQUssR0FBUTtRQUNqQixLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU07S0FDOUIsQ0FBQztJQUNGLElBQUksT0FBTyxFQUFFO1FBQ1gsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7S0FDekI7SUFDRCxFQUFFLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3RCLENBQUMsQ0FBQztBQTBRQSw4QkFBUztBQXhRWCxNQUFNLGVBQWUsR0FBRyxDQUFDLEtBQVUsRUFBRSxPQUFpQixFQUFFLEVBQUU7SUFDeEQsTUFBTSxLQUFLLEdBQVE7UUFDakIsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNO1FBQzdCLE9BQU8sRUFBRSxVQUFVLENBQU07WUFDdkIsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDO0tBQ0YsQ0FBQztJQUNGLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDdEIsQ0FBQyxDQUFDO0FBaVFBLDBDQUFlO0FBL1BqQixNQUFNLFdBQVcsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFO0lBQy9CLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDL0IsQ0FBQyxDQUFDO0FBOFBBLGtDQUFXO0FBM1BiLE1BQU0sYUFBYSxHQUFHLENBQUMsS0FBVSxFQUFFLElBQVMsRUFBRSxFQUFFO0lBQzlDLElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDVixFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1gsS0FBSyxFQUFFLElBQUk7WUFD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QUMsQ0FBQyxFQUFFO2dCQUN4QyxhQUFhLEdBQUcsS0FBSyxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLGFBQWEsR0FBRyxJQUFJLENBQUM7YUFDdEI7WUFDRCxNQUFNO1FBQ1IsS0FBSyxRQUFRO1lBQ1gsS0FBSyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNsQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNuQyxJQUFJLFFBQVEsR0FBRyxLQUFLLElBQUksU0FBUyxLQUFLLENBQUMsQ0FBQyxFQUFFO2dCQUN4QyxhQUFhLEdBQUcsS0FBSyxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLGFBQWEsR0FBRyxJQUFJLENBQUM7YUFDdEI7WUFDRCxNQUFNO1FBQ1IsS0FBSyxVQUFVO1lBQ2IsS0FBSyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNsQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqQyxJQUFJLFFBQVEsR0FBRyxLQUFLLElBQUksU0FBUyxLQUFLLENBQUMsQ0FBQyxFQUFFO2dCQUN4QyxhQUFhLEdBQUcsS0FBSyxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLGFBQWEsR0FBRyxJQUFJLENBQUM7YUFDdEI7WUFDRCxNQUFNO1FBQ1I7WUFDRSxhQUFhLEdBQUcsS0FBSyxDQUFDO1lBQ3RCLE1BQU07S0FDVDtJQUNELE9BQU8sYUFBYSxDQUFDO0FBQ3ZCLENBQUMsQ0FBQztBQWVBLHNEQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFwaSBmcm9tIFwiLi4vc2VydmljZS9hcGkuc2VydmljZVwiO1xuXG5jb25zdCBzaG93TW9kYWwgPSAodGl0bGU/OiBhbnksIGNvbnRlbnQ/OiBhbnkpID0+IHtcbiAgY29uc3QgbW9kZWw6IGFueSA9IHtcbiAgICB0aXRsZTogdGl0bGUgPyB0aXRsZSA6IFwi572R57uc5byC5bi4XCIsXG4gIH07XG4gIGlmIChjb250ZW50KSB7XG4gICAgbW9kZWwuY29udGVudCA9IGNvbnRlbnQ7XG4gIH1cbiAgd3guc2hvd01vZGFsKG1vZGVsKTtcbn07XG5cbmNvbnN0IHNob3dNb2RlbEFjdGlvbiA9ICh0aXRsZTogYW55LCBzdWNjZXNzOiBGdW5jdGlvbikgPT4ge1xuICBjb25zdCBtb2RlbDogYW55ID0ge1xuICAgIHRpdGxlOiB0aXRsZSA/IHRpdGxlIDogXCLnvZHnu5zlvILluLhcIixcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoXzogYW55KSB7XG4gICAgICBzdWNjZXNzKCk7XG4gICAgfSxcbiAgfTtcbiAgd3guc2hvd01vZGFsKG1vZGVsKTtcbn07XG5cbmNvbnN0IGNpdHlSZXBsYWNlID0gKHZhbDogYW55KSA9PiB7XG4gIHJldHVybiB2YWwucmVwbGFjZSgv5biCJC8sIFwiXCIpO1xufTtcblxuLyoqIOagoemqjOWtl+auteS4jeiDveS4uuepuiAqL1xuY29uc3QgdmFsaWRhdGVFbXB0eSA9ICh2YWx1ZTogYW55LCBkZXNjOiBhbnkpID0+IHtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICB0aXRsZTogZGVzYyxcbiAgICAgIGljb246IFwibm9uZVwiLFxuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcblxuLyoqXG4gKiDmoKHpqozlrZfmrrXkuI3og73mnInlpJrkvZky5L2N5bCP5pWwXG4gKiAqKi9cbmNvbnN0IHZhbGlkYXRlTW9uZXkgPSAodmFsdWU6IGFueSwgZGVzYzogYW55KSA9PiB7XG4gIC8vIOWIpOaWreaYr+WQpuaYr+Wwj+aVsOS9jeWkp+S6jjLkvY1cbiAgbGV0IHJldDogYW55ID0gL14oKFsxLTldWzAtOV0qKXwoKFswXVxcLlxcZHsxLDJ9fFsxLTldWzAtOV0qXFwuXFxkezEsMn0pKSkkLztcbiAgcmV0ID0gbmV3IFJlZ0V4cChyZXQpO1xuICBpZiAoIXJldC50ZXN0KHZhbHVlKSkge1xuICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICB0aXRsZTogZGVzYyxcbiAgICAgIGljb246IFwibm9uZVwiLFxuICAgIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcblxuLyoqIOagoemqjOS4iuS8oOWbvueJhyAqL1xuY29uc3QgdmFsaWRhdGVJbWFnZXMgPSAoaW1hZ2VzOiBhbnksIGRlc2M6IGFueSkgPT4ge1xuICBpZiAoaW1hZ2VzLmxlbmd0aCA8PSAwKSB7XG4gICAgd3guc2hvd1RvYXN0KHtcbiAgICAgIHRpdGxlOiBkZXNjLFxuICAgICAgaWNvbjogXCJub25lXCIsXG4gICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG4vKiog5qCh6aqM5omL5py65Y+356CB5qC85byPICovXG5jb25zdCB2YWxpZGF0ZVBob25lID0gKHBob25lOiBhbnksIGRlc2M6IGFueSkgPT4ge1xuICBjb25zdCBteXJlZyA9IC9eWzFdWzMsNCw1LDcsOF1bMC05XXs5fSQvO1xuICBpZiAoIW15cmVnLnRlc3QocGhvbmUpKSB7XG4gICAgd3guc2hvd1RvYXN0KHtcbiAgICAgIHRpdGxlOiBkZXNjLFxuICAgICAgaWNvbjogXCJub25lXCIsXG4gICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG5jb25zdCBwaG9uZUNhbGwgPSAoZTogYW55KSA9PiB7XG4gIGNvbnN0IHBob25lID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQucGhvbmU7XG4gIHd4Lm1ha2VQaG9uZUNhbGwoe1xuICAgIHBob25lTnVtYmVyOiBwaG9uZSxcbiAgfSk7XG59O1xuXG4vKiogMjAyMOW5tDAz5pyIMDnml6UgKi9cbmNvbnN0IGdldERhdGUgPSAoZGF0ZVN0cjogc3RyaW5nKSA9PiB7XG4gIGlmICghZGF0ZVN0cikge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTtcbiAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgbGV0IG1vbnRoOiBudW1iZXIgfCBzdHJpbmcgPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICBtb250aCA9IG1vbnRoIDw9IDkgPyBgMCR7bW9udGh9YCA6IG1vbnRoO1xuICBsZXQgZGF5OiBudW1iZXIgfCBzdHJpbmcgPSBkYXRlLmdldERhdGUoKTtcbiAgZGF5ID0gZGF5IDw9IDkgPyBgMCR7ZGF5fWAgOiBkYXk7XG4gIHJldHVybiBgJHt5ZWFyfeW5tCR7bW9udGh95pyIJHtkYXl95pelYDtcbn07XG5cbi8qKiAwOToyMyAqL1xuY29uc3QgZ2V0VGltZSA9IChkYXRlU3RyOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRhdGVTdHIpO1xuICBsZXQgaG91cnM6IG51bWJlciB8IHN0cmluZyA9IGRhdGUuZ2V0SG91cnMoKTtcbiAgaG91cnMgPSBob3VycyA8PSA5ID8gYDAke2hvdXJzfWAgOiBob3VycztcbiAgbGV0IG1pbnV0ZXM6IG51bWJlciB8IHN0cmluZyA9IGRhdGUuZ2V0TWludXRlcygpO1xuICBtaW51dGVzID0gbWludXRlcyA8PSA5ID8gYDAke21pbnV0ZXN9YCA6IG1pbnV0ZXM7XG4gIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfWA7XG59O1xuXG5mdW5jdGlvbiBmb3JtYXRUaW1lKGRhdGU6IERhdGUpOiBzdHJpbmcge1xuICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDE7XG4gIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuICBjb25zdCBob3VyID0gZGF0ZS5nZXRIb3VycygpO1xuICBjb25zdCBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgY29uc3Qgc2Vjb25kID0gZGF0ZS5nZXRTZWNvbmRzKCk7XG5cbiAgcmV0dXJuIChcbiAgICBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbihcIi9cIikgK1xuICAgIFwiIFwiICtcbiAgICBbaG91ciwgbWludXRlLCBzZWNvbmRdLm1hcChmb3JtYXROdW1iZXIpLmpvaW4oXCI6XCIpXG4gICk7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdEhMU1RpbWUoZGF0ZVN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKGRhdGVTdHIgPT09IFwiXCIpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cik7XG4gIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG4gIGNvbnNvbGUubG9nKGAtLS0tLS0tYCwgeWVhciwgbW9udGgsIGRheSk7XG4gIHJldHVybiBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbihcIi5cIik7XG59XG5cbmNvbnN0IGZvcm1hdE51bWJlciA9IChuOiBudW1iZXIpID0+IHtcbiAgY29uc3Qgc3RyID0gbi50b1N0cmluZygpO1xuICByZXR1cm4gc3RyWzFdID8gc3RyIDogXCIwXCIgKyBzdHI7XG59O1xuXG4vKiog6I635Y+W55So5oi35L+h5oGvICovXG5jb25zdCBnZXRVc2VySW5mbyA9ICgpID0+IHtcbiAgbGV0IHVzZXJJbmZvOiBhbnkgPSB7fTtcbiAgd3guZ2V0U3RvcmFnZSh7XG4gICAga2V5OiBcInVzZXJcIiwgLy8g55So5oi35aS05YOP5L+h5oGvXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgY29uc3QgeyBvcGVuaWQgfSA9IHJlcy5kYXRhO1xuICAgICAgdXNlckluZm8gPSBBcGkuZ2V0VXNlckluZm8ob3BlbmlkKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VsdFwiLCByZXN1bHQpO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kYXRhIHx8IHt9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcbiAgcmV0dXJuIHVzZXJJbmZvO1xufTtcblxuLyoqIOWkhOeQhuadg+ebiuaLpuaIqiAqL1xuY29uc3QgZGVhbFJpZ2h0SW50ZXJjZXB0ID0gKHJpZ2h0VHlwZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHVzZXJJbmZvID0gd3guZ2V0U3RvcmFnZVN5bmMoXCJ1c2VySW5mb1wiKTtcbiAgY29uc29sZS5sb2coXCJ1c2VySW5mb1wiLCB1c2VySW5mbyk7XG4gIGNvbnN0IHsgdmlwVHlwZSA9IFwiXCIgfSA9IHVzZXJJbmZvO1xuICBsZXQgbmVlZEludGVyY2VwdCA9IGZhbHNlOyAvLyDmmK/lkKbpnIDopoHmi6bmiKpcbiAgbGV0IHRpbWVzID0gMDtcbiAgbGV0IHJpZ2h0VHlwZURhdGEgPSB3eC5nZXRTdG9yYWdlU3luYyhyaWdodFR5cGUpOyAvLyDku47nvJPlrZjkuK3ojrflj5bmnYPnm4rkvb/nlKjmg4XlhrVcbiAgbGV0IHRpbWVzTm93ID0gcmlnaHRUeXBlRGF0YS50aW1lcyB8fCAwO1xuICBsZXQgcmlnaHRDb25maWc6IGFueSA9IHd4LmdldFN0b3JhZ2VTeW5jKFwicmlnaHRDb25maWdcIik7IC8vIOS7jue8k+WtmOS4reivu+WPlummlumhteS4rXNldOeahOadg+ebiumFjee9rlxuICBzd2l0Y2ggKHZpcFR5cGUpIHtcbiAgICBjYXNlIFwiXCI6IC8vIOaZrumAmlxuICAgICAgdGltZXMgPSByaWdodENvbmZpZ1swXVtyaWdodFR5cGVdO1xuICAgICAgY29uc29sZS5sb2coXCLor7vlj5bmi6bmiKp0aW1lc++8mlwiLCB0aW1lcyk7XG4gICAgICBuZWVkSW50ZXJjZXB0ID0gdGltZXNOb3cgPj0gdGltZXM7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiYnJvbnplXCI6IC8vIOm7hOmTnFxuICAgICAgdGltZXMgPSByaWdodENvbmZpZ1sxXVtyaWdodFR5cGVdO1xuICAgICAgY29uc29sZS5sb2coXCLor7vlj5bmi6bmiKp0aW1lc++8mlwiLCB0aW1lcyk7XG4gICAgICBjb25zb2xlLmxvZyhcInhpYW56YWl0aW1lc++8mlwiLCB0aW1lc05vdyk7XG4gICAgICBuZWVkSW50ZXJjZXB0ID0gdGltZXNOb3cgPj0gdGltZXM7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwicGxhdGludW1cIjogLy8g55m96YeRXG4gICAgICB0aW1lcyA9IHJpZ2h0Q29uZmlnWzJdW3JpZ2h0VHlwZV07XG4gICAgICBjb25zb2xlLmxvZyhcIuivu+WPluaLpuaIqnRpbWVz77yaXCIsIHRpbWVzKTtcbiAgICAgIG5lZWRJbnRlcmNlcHQgPSB0aW1lc05vdyA+PSB0aW1lcztcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBuZWVkSW50ZXJjZXB0ID0gZmFsc2U7XG4gICAgICBicmVhaztcbiAgfVxuICByZXR1cm4gbmVlZEludGVyY2VwdDtcbn07XG5cbmNvbnN0IHNldFJpZ2h0U3RvcmFnZSA9IChyaWdodFR5cGU6IHN0cmluZywgdmFsdWUgPSAwKSA9PiB7XG4gIGxldCB0aW1lcyA9IDA7XG4gIGxldCByaWdodERhdGEgPSB3eC5nZXRTdG9yYWdlU3luYyhyaWdodFR5cGUpO1xuICBsZXQgZGF0ZU5vdyA9IG5ldyBEYXRlKCk7XG4gIC8vIOWIpOaWreaYr+WQpuaYr+WQjOS4gOWkqVxuICBpZiAoXG4gICAgcmlnaHREYXRhLnVwZGF0ZVRpbWUgJiZcbiAgICByaWdodERhdGEudXBkYXRlVGltZS50b0RhdGVTdHJpbmcoKSA9PSBkYXRlTm93LnRvRGF0ZVN0cmluZygpXG4gICkge1xuICAgIHRpbWVzID0gcmlnaHREYXRhLnRpbWVzICsgMTtcbiAgfVxuICBpZiAodmFsdWUpIHtcbiAgICB0aW1lcyA9IHZhbHVlO1xuICB9XG4gIGNvbnNvbGUubG9nKFwi6K6+572udGltZXPvvJpcIiwgdGltZXMpO1xuICB3eC5zZXRTdG9yYWdlKHtcbiAgICBrZXk6IHJpZ2h0VHlwZSxcbiAgICBkYXRhOiB7XG4gICAgICB0aW1lcyxcbiAgICAgIGRhdGVOb3csXG4gICAgfSxcbiAgfSk7XG59O1xuXG4vKiog57yY5YiG6IGK5aSp5oum5oiq5Y2V54us5aSE55CGXG4gKiDliKTmlq3lvZPlpKnogYrlpKnkurrliJfooahcbiAqL1xuY29uc3QgZGVhbEZhdGVDaGF0SW50ZXJjZXB0ID0gKHRvT3BlbmlkOiBzdHJpbmcpID0+IHtcbiAgbGV0IHJpZ2h0VHlwZSA9IFwiZmF0ZUNoYXRcIjtcbiAgY29uc3QgdXNlckluZm8gPSB3eC5nZXRTdG9yYWdlU3luYyhcInVzZXJJbmZvXCIpO1xuICAvLyDkuIvpnaLov5nooYzmmK/kuLrkuobmtYvor5VcbiAgY29uc3QgdmlwVHlwZSA9IHVzZXJJbmZvLnZpcFR5cGUgfHwgXCJcIjtcbiAgbGV0IG5lZWRJbnRlcmNlcHQgPSBmYWxzZTsgLy8g5piv5ZCm6ZyA6KaB5oum5oiqXG4gIGxldCB0aW1lcyA9IDA7XG4gIGxldCBjaGF0U2Vzc2lvbiA9IHd4LmdldFN0b3JhZ2VTeW5jKFwiY2hhdFNlc3Npb25cIik7XG4gIGNvbnNvbGUubG9nKFwiY2hhdFNlc3Npb24+Pj4+XCIsIGNoYXRTZXNzaW9uKTtcbiAgbGV0IG9wZW5pZExpc3QgPSBjaGF0U2Vzc2lvbi5vcGVuaWRMaXN0IHx8IFtdO1xuICBsZXQgdGltZXNOb3cgPSBvcGVuaWRMaXN0Lmxlbmd0aDtcbiAgbGV0IHJpZ2h0Q29uZmlnOiBhbnkgPSB3eC5nZXRTdG9yYWdlU3luYyhcInJpZ2h0Q29uZmlnXCIpOyAvLyDku47nvJPlrZjkuK3or7vlj5bpppbpobXkuK1zZXTnmoTmnYPnm4rphY3nva5cbiAgY29uc3QgZmluZEluZGV4ID0gb3BlbmlkTGlzdC5maW5kSW5kZXgoKG9wZW5pZDogYW55KSA9PiBvcGVuaWQgPT09IHRvT3BlbmlkKTtcbiAgc3dpdGNoICh2aXBUeXBlKSB7XG4gICAgY2FzZSBcIlwiOiAvLyDmma7pgJpcbiAgICAgIHRpbWVzID0gcmlnaHRDb25maWdbMF1bcmlnaHRUeXBlXTtcbiAgICAgIGNvbnNvbGUubG9nKFwi6K+75Y+W5oum5oiqdGltZXPvvJpcIiwgdGltZXMpO1xuICAgICAgaWYgKHRpbWVzTm93IDwgdGltZXMgfHwgZmluZEluZGV4ICE9PSAtMSkge1xuICAgICAgICBuZWVkSW50ZXJjZXB0ID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZWVkSW50ZXJjZXB0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCJicm9uemVcIjogLy8g6buE6ZOcXG4gICAgICB0aW1lcyA9IHJpZ2h0Q29uZmlnWzFdW3JpZ2h0VHlwZV07XG4gICAgICBjb25zb2xlLmxvZyhcIuivu+WPluaLpuaIqnRpbWVz77yaXCIsIHRpbWVzKTtcbiAgICAgIGNvbnNvbGUubG9nKFwidGltZXNOb3c6XCIsIHRpbWVzTm93KTtcbiAgICAgIGlmICh0aW1lc05vdyA8IHRpbWVzIHx8IGZpbmRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgbmVlZEludGVyY2VwdCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmVlZEludGVyY2VwdCA9IHRydWU7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwicGxhdGludW1cIjogLy8g55m96YeRXG4gICAgICB0aW1lcyA9IHJpZ2h0Q29uZmlnWzJdW3JpZ2h0VHlwZV07XG4gICAgICBjb25zb2xlLmxvZyhcIuivu+WPluaLpuaIqnRpbWVz77yaXCIsIHRpbWVzKTtcbiAgICAgIGlmICh0aW1lc05vdyA8IHRpbWVzIHx8IGZpbmRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgbmVlZEludGVyY2VwdCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmVlZEludGVyY2VwdCA9IHRydWU7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbmVlZEludGVyY2VwdCA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIG5lZWRJbnRlcmNlcHQ7XG59O1xuXG5leHBvcnQge1xuICBzaG93TW9kYWwsXG4gIHNob3dNb2RlbEFjdGlvbixcbiAgY2l0eVJlcGxhY2UsXG4gIHZhbGlkYXRlRW1wdHksXG4gIHZhbGlkYXRlSW1hZ2VzLFxuICB2YWxpZGF0ZVBob25lLFxuICBwaG9uZUNhbGwsXG4gIGdldERhdGUsXG4gIGdldFRpbWUsXG4gIGZvcm1hdFRpbWUsXG4gIGRlYWxSaWdodEludGVyY2VwdCxcbiAgc2V0UmlnaHRTdG9yYWdlLFxuICBkZWFsRmF0ZUNoYXRJbnRlcmNlcHQsXG4gIGZvcm1hdEhMU1RpbWUsXG4gIGdldFVzZXJJbmZvLFxuICB2YWxpZGF0ZU1vbmV5LFxufTtcbiJdfQ==
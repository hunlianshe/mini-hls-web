"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../../service/api.service");
Page({
    data: {
        payInfo: {},
        userInfo: {},
    },
    onLoad: function (options) {
        const user = wx.getStorageSync("userInfo");
        console.log("userInfo", user);
        this.setData({
            userInfo: Object.assign({}, user, { vipType: "bronze", vipExpireAt: "2020.12.31" }),
        });
        console.log(`===options===`, options);
        if (options.payInfo) {
            this.setData({
                payInfo: JSON.parse(options.payInfo),
            });
        }
    },
    wxPay: function () {
        const reqParams = this.preparePayInfo();
        Api.buyVipByWechat(reqParams).then((result) => {
            console.log(result);
            if (result && result.code === 200) {
                let data = result.data;
                this.callWxForPay(data);
            }
        });
        console.log("wxPay");
    },
    callWxForPay: function (data) {
        const that = this;
        wx.requestPayment({
            timeStamp: data.timeStamp,
            nonceStr: data.nonceStr,
            package: "prepay_id=" + data.prepayId,
            signType: "MD5",
            paySign: data.paySign,
            success(res) {
                console.log(`付款成功: `, res);
            },
            fail(res) {
                console.log(`付款失败: `, res);
            },
            complete(res) {
                console.log(`付款结束complete: `, res);
                Api.checkOrderStatus(data.orderNum).then((result) => {
                    if (result && result.code === 200) {
                        that.requestForUserInfo();
                        wx.navigateTo({
                            url: `../paySuccess/paySuccess`,
                        });
                    }
                });
            },
        });
    },
    requestForUserInfo() {
        Api.getUserInfo(this.data.userInfo.openid).then((result) => {
            if (result) {
                const userInfo = result.data;
                this.setData({
                    userInfo,
                });
                wx.setStorageSync("userInfo", userInfo);
            }
        });
    },
    preparePayInfo: function () {
        const reqParams = {};
        const { userInfo, payInfo } = this.data;
        console.log(userInfo.vipType);
        console.log(payInfo);
        switch (userInfo.vipType) {
            case "bronze":
                if (payInfo.vipType === "bronze") {
                    reqParams.payType = "renew";
                }
                else {
                    reqParams.payType = "upgrade";
                }
                reqParams.period = payInfo.name;
                reqParams.vipType = payInfo.vipType;
                break;
            case "platinum":
                reqParams.payType = "renew";
                reqParams.period = payInfo.name;
                reqParams.vipType = "platinum";
                break;
            default:
                reqParams.payType = "join";
                reqParams.period = payInfo.name;
                reqParams.vipType = payInfo.vipType;
                break;
        }
        return reqParams;
    },
    coinPay: function () {
        console.log("coinPay");
    },
    onReady: function () { },
    onShow: function () { },
    onHide: function () { },
    onUnload: function () { },
    onPullDownRefresh: function () { },
    onReachBottom: function () { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvb3NlUGF5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2hvb3NlUGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esb0RBQW9EO0FBRXBELElBQUksQ0FBQztJQUlILElBQUksRUFBRTtRQUNKLE9BQU8sRUFBRSxFQUFTO1FBQ2xCLFFBQVEsRUFBRSxFQUFTO0tBQ3BCO0lBRUQsTUFBTSxFQUFFLFVBQVUsT0FBWTtRQUM1QixNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixRQUFRLG9CQUNILElBQUksSUFDUCxPQUFPLEVBQUUsUUFBUSxFQUNqQixXQUFXLEVBQUUsWUFBWSxHQUMxQjtTQUNGLENBQUMsQ0FBQztRQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3RDLElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUNuQixJQUFJLENBQUMsT0FBUSxDQUFDO2dCQUNaLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7YUFDckMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBR0QsS0FBSyxFQUFFO1FBQ0wsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3hDLEdBQUcsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwQixJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLEdBQUcsRUFBRTtnQkFDakMsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDdkIs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T0FBTyxHQUFHLFVBQVUsQ0FBQztnQkFDL0IsTUFBTTtZQUNSO2dCQUNFLFNBQVMsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2dCQUMzQixTQUFTLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBQ2hDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztnQkFDcEMsTUFBTTtTQUNUO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU8sRUFBRTtRQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELE9BQU8sRUFBRSxjQUFhLENBQUM7SUFFdkIsTUFBTSxFQUFFLGNBQWEsQ0FBQztJQUV0QixNQUFNLEVBQUUsY0FBYSxDQUFDO0lBRXRCLFFBQVEsRUFBRSxjQUFhLENBQUM7SUFFeEIsaUJBQWlCLEVBQUUsY0FBYSxDQUFDO0lBRWpDLGFBQWEsRUFBRSxjQUFhLENBQUM7Q0FDOUIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFja2FnZU15aG9tZS9wYWdlcy9jaG9vc2VQYXkuanNcbmltcG9ydCAqIGFzIEFwaSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZS9hcGkuc2VydmljZVwiO1xuXG5QYWdlKHtcbiAgLyoqXG4gICAqIFBhZ2UgaW5pdGlhbCBkYXRhXG4gICAqL1xuICBkYXRhOiB7XG4gICAgcGF5SW5mbzoge30gYXMgYW55LFxuICAgIHVzZXJJbmZvOiB7fSBhcyBhbnksXG4gIH0sXG5cbiAgb25Mb2FkOiBmdW5jdGlvbiAob3B0aW9uczogYW55KSB7XG4gICAgY29uc3QgdXNlciA9IHd4LmdldFN0b3JhZ2VTeW5jKFwidXNlckluZm9cIik7XG4gICAgY29uc29sZS5sb2coXCJ1c2VySW5mb1wiLCB1c2VyKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHVzZXJJbmZvOiB7XG4gICAgICAgIC4uLnVzZXIsXG4gICAgICAgIHZpcFR5cGU6IFwiYnJvbnplXCIsXG4gICAgICAgIHZpcEV4cGlyZUF0OiBcIjIwMjAuMTIuMzFcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coYD09PW9wdGlvbnM9PT1gLCBvcHRpb25zKTtcbiAgICBpZiAob3B0aW9ucy5wYXlJbmZvKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcGF5SW5mbzogSlNPTi5wYXJzZShvcHRpb25zLnBheUluZm8pLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIC8vIOWIpOaWreW9k+WJjeaYr+WQpuaYr+W8gOmAmueKtuaAgVxuICB3eFBheTogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcVBhcmFtcyA9IHRoaXMucHJlcGFyZVBheUluZm8oKTtcbiAgICBBcGkuYnV5VmlwQnlXZWNoYXQocmVxUGFyYW1zKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdC5kYXRhO1xuICAgICAgICB0aGlzLmNhbGxXeEZvclBheShkYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhcInd4UGF5XCIpO1xuICB9LFxuXG4gIGNhbGxXeEZvclBheTogZnVuY3Rpb24gKGRhdGE6IGFueSkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnJlcXVlc3RQYXltZW50KHtcbiAgICAgIHRpbWVTdGFtcDogZGF0YS50aW1lU3RhbXAsXG4gICAgICBub25jZVN0cjogZGF0YS5ub25jZVN0cixcbiAgICAgIC8vIHBhY2thZ2U6IGRhdGEucGFja2FnZSxcbiAgICAgIHBhY2thZ2U6IFwicHJlcGF5X2lkPVwiICsgZGF0YS5wcmVwYXlJZCxcbiAgICAgIHNpZ25UeXBlOiBcIk1ENVwiLFxuICAgICAgcGF5U2lnbjogZGF0YS5wYXlTaWduLFxuICAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg5LuY5qy+5oiQ5YqfOiBgLCByZXMpO1xuICAgICAgfSxcbiAgICAgIGZhaWwocmVzOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOS7mOasvuWksei0pTogYCwgcmVzKTtcbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZShyZXM6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg5LuY5qy+57uT5p2fY29tcGxldGU6IGAsIHJlcyk7XG4gICAgICAgIC8vIOS7mOasvuaIkOWKn+ebtOaOpeabtOaWsFxuICAgICAgICBBcGkuY2hlY2tPcmRlclN0YXR1cyhkYXRhLm9yZGVyTnVtKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgdGhhdC5yZXF1ZXN0Rm9yVXNlckluZm8oKTtcbiAgICAgICAgICAgIC8vIOi3s+i9rOiuouWNleivpuaDhVxuICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgIHVybDogYC4uL3BheVN1Y2Nlc3MvcGF5U3VjY2Vzc2AsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcblxuICByZXF1ZXN0Rm9yVXNlckluZm8oKSB7XG4gICAgQXBpLmdldFVzZXJJbmZvKHRoaXMuZGF0YS51c2VySW5mby5vcGVuaWQpLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IHVzZXJJbmZvID0gcmVzdWx0LmRhdGE7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIHVzZXJJbmZvLFxuICAgICAgICB9KTtcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoXCJ1c2VySW5mb1wiLCB1c2VySW5mbyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIHtcbiAgLy8g6YCJ5oup5bm05LuYLCDmnIjku5gsIOWto+S7mFxuICBcInBlcmlvZFwiOiBcIm1vbnRoXCIsIC8vIFwibW9udGhcIi3mnIggXCJzZWFzb25cIi3lraPluqYgXCJ5ZWFyXCIt5bm0XG4gIC8vIOS8muWRmOexu+WeiyBcbiAgXCJ2aXBUeXBlXCI6IFwiYnJvbnplXCIsIC8vIFwiYnJvbnplXCIt6buE6ZOcIFwicGxhdGludW1cIi3nmb3ph5EgXG4gIC8vIOS7mOasvuexu+Wei1xuICBcInBheVR5cGVcIjogXCJqb2luXCIgLy8gXCJqb2luXCIt5Yqg5YWlIFwicmVuZXdcIi3nu63otLkgXCJ1cGdyYWRlXCIt5Y2H57qnXG59XG4gICAqIFxuICAqL1xuICBwcmVwYXJlUGF5SW5mbzogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcVBhcmFtczogYW55ID0ge307XG4gICAgY29uc3QgeyB1c2VySW5mbywgcGF5SW5mbyB9ID0gdGhpcy5kYXRhO1xuICAgIGNvbnNvbGUubG9nKHVzZXJJbmZvLnZpcFR5cGUpO1xuICAgIGNvbnNvbGUubG9nKHBheUluZm8pO1xuICAgIHN3aXRjaCAodXNlckluZm8udmlwVHlwZSkge1xuICAgICAgLy8g6buE6ZOcXG4gICAgICBjYXNlIFwiYnJvbnplXCI6XG4gICAgICAgIGlmIChwYXlJbmZvLnZpcFR5cGUgPT09IFwiYnJvbnplXCIpIHtcbiAgICAgICAgICAvL+e7rei0uVxuICAgICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJyZW5ld1wiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJ1cGdyYWRlXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmVxUGFyYW1zLnBlcmlvZCA9IHBheUluZm8ubmFtZTtcbiAgICAgICAgcmVxUGFyYW1zLnZpcFR5cGUgPSBwYXlJbmZvLnZpcFR5cGU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8g55m96YeRXG4gICAgICBjYXNlIFwicGxhdGludW1cIjpcbiAgICAgICAgcmVxUGFyYW1zLnBheVR5cGUgPSBcInJlbmV3XCI7XG4gICAgICAgIHJlcVBhcmFtcy5wZXJpb2QgPSBwYXlJbmZvLm5hbWU7XG4gICAgICAgIHJlcVBhcmFtcy52aXBUeXBlID0gXCJwbGF0aW51bVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJqb2luXCI7XG4gICAgICAgIHJlcVBhcmFtcy5wZXJpb2QgPSBwYXlJbmZvLm5hbWU7XG4gICAgICAgIHJlcVBhcmFtcy52aXBUeXBlID0gcGF5SW5mby52aXBUeXBlO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHJlcVBhcmFtcztcbiAgfSxcblxuICBjb2luUGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coXCJjb2luUGF5XCIpO1xuICB9LFxuXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge30sXG5cbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7fSxcblxuICBvblVubG9hZDogZnVuY3Rpb24gKCkge30sXG5cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHt9LFxufSk7XG4iXX0=
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../../service/api.service");
Page({
    data: {
        payInfo: {},
        userInfo: {},
        payItems: [
            { value: 'wx', name: '微信支付', iconName: 'wx', balance: '', checked: true },
            { value: 'yfb', name: '缘分币支付', iconName: 'moneyRecharge', balance: 80, checked: false },
        ],
        shooseType: 'wx',
    },
    onLoad: function (options) {
        const user = wx.getStorageSync("userInfo");
        console.log("userInfo", user);
        this.setData({
            userInfo: Object.assign({}, user, { vipType: "bronze", vipExpireAt: "2020.12.31" }),
        });
        console.log(`===options===`, options);
        if (options.payInfo) {
            this.setData({
                payInfo: JSON.parse(options.payInfo),
            });
        }
    },
    radioChange(e) {
        console.log('radio发生change事件，选择的支付方式为：', e.detail.value);
        const payItems = this.data.payItems;
        for (let i = 0, len = payItems.length; i < len; ++i) {
            payItems[i].checked = payItems[i].value === e.detail.value;
        }
        this.setData({
            payItems,
            shooseType: e.detail.value,
        });
    },
    goPay() {
        const { payInfo, shooseType } = this.data;
        if (shooseType === 'yfb' && payInfo.value > 88) {
            wx.showToast({
                title: '余额不足',
                icon: 'none',
                duration: 2000
            });
        }
        console.log("根据支付方式调用接口");
    },
    wxPay: function () {
        const reqParams = this.preparePayInfo();
        Api.buyVipByWechat(reqParams).then((result) => {
            console.log(result);
            if (result && result.code === 200) {
                let data = result.data;
                this.callWxForPay(data);
            }
        });
        console.log("wxPay");
    },
    callWxForPay: function (data) {
        const that = this;
        wx.requestPayment({
            timeStamp: data.timeStamp,
            nonceStr: data.nonceStr,
            package: "prepay_id=" + data.prepayId,
            signType: "MD5",
            paySign: data.paySign,
            success(res) {
                console.log(`付款成功: `, res);
            },
            fail(res) {
                console.log(`付款失败: `, res);
            },
            complete(res) {
                console.log(`付款结束complete: `, res);
                Api.checkOrderStatus(data.orderNum).then((result) => {
                    if (result && result.code === 200) {
                        that.requestForUserInfo();
                        wx.navigateTo({
                            url: `../paySuccess/paySuccess`,
                        });
                    }
                });
            },
        });
    },
    requestForUserInfo() {
        Api.getUserInfo(this.data.userInfo.openid).then((result) => {
            if (result) {
                const userInfo = result.data;
                this.setData({
                    userInfo,
                });
                wx.setStorageSync("userInfo", userInfo);
            }
        });
    },
    preparePayInfo: function () {
        const reqParams = {};
        const { userInfo, payInfo } = this.data;
        console.log(userInfo.vipType);
        console.log(payInfo);
        switch (userInfo.vipType) {
            case "bronze":
                if (payInfo.vipType === "bronze") {
                    reqParams.payType = "renew";
                }
                else {
                    reqParams.payType = "upgrade";
                }
                reqParams.period = payInfo.name;
                reqParams.vipType = payInfo.vipType;
                break;
            case "platinum":
                reqParams.payType = "renew";
                reqParams.period = payInfo.name;
                reqParams.vipType = "platinum";
                break;
            default:
                reqParams.payType = "join";
                reqParams.period = payInfo.name;
                reqParams.vipType = payInfo.vipType;
                break;
        }
        return reqParams;
    },
    coinPay: function () {
        console.log("coinPay");
    },
    onReady: function () { },
    onShow: function () { },
    onHide: function () { },
    onUnload: function () { },
    onPullDownRefresh: function () { },
    onReachBottom: function () { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvb3NlUGF5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2hvb3NlUGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esb0RBQW9EO0FBRXBELElBQUksQ0FBQztJQUlILElBQUksRUFBRTtRQUNKLE9BQU8sRUFBRSxFQUFTO1FBQ2xCLFFBQVEsRUFBRSxFQUFTO1FBQ25CLFFBQVEsRUFBRTtZQUNSLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFO1lBQ3pFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFO1NBQ3hGO1FBQ0QsVUFBVSxFQUFFLElBQUk7S0FDakI7SUFFRCxNQUFNLEVBQUUsVUFBVSxPQUFZO1FBQzVCLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFFBQVEsb0JBQ0gsSUFBSSxJQUNQLE9BQU8sRUFBRSxRQUFRLEVBQ2pCLFdBQVcsRUFBRSxZQUFZLEdBQzFCO1NBQ0YsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdEMsSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFO1lBQ25CLElBQUksQ0FBQyxPQUFRLENBQUM7Z0JBQ1osT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQzthQUNyQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFFRCxXQUFX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UixLQUFLLFVBQVU7Z0JBQ2IsU0FBUyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7Z0JBQzVCLFNBQVMsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDaEMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUM7Z0JBQy9CLE1BQU07WUFDUjtnQkFDRSxTQUFTLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztnQkFDM0IsU0FBUyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUNoQyxTQUFTLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7Z0JBQ3BDLE1BQU07U0FDVDtRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRCxPQUFPLEVBQUU7UUFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxPQUFPLEVBQUUsY0FBYSxDQUFDO0lBRXZCLE1BQU0sRUFBRSxjQUFhLENBQUM7SUFFdEIsTUFBTSxFQUFFLGNBQWEsQ0FBQztJQUV0QixRQUFRLEVBQUUsY0FBYSxDQUFDO0lBRXhCLGlCQUFpQixFQUFFLGNBQWEsQ0FBQztJQUVqQyxhQUFhLEVBQUUsY0FBYSxDQUFDO0NBQzlCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHBhY2thZ2VNeWhvbWUvcGFnZXMvY2hvb3NlUGF5LmpzXG5pbXBvcnQgKiBhcyBBcGkgZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvYXBpLnNlcnZpY2VcIjtcblxuUGFnZSh7XG4gIC8qKlxuICAgKiBQYWdlIGluaXRpYWwgZGF0YVxuICAgKi9cbiAgZGF0YToge1xuICAgIHBheUluZm86IHt9IGFzIGFueSxcbiAgICB1c2VySW5mbzoge30gYXMgYW55LFxuICAgIHBheUl0ZW1zOiBbXG4gICAgICB7IHZhbHVlOiAnd3gnLCBuYW1lOiAn5b6u5L+h5pSv5LuYJywgaWNvbk5hbWU6ICd3eCcsIGJhbGFuY2U6ICcnLCBjaGVja2VkOiB0cnVlIH0sXG4gICAgICB7IHZhbHVlOiAneWZiJywgbmFtZTogJ+e8mOWIhuW4geaUr+S7mCcsIGljb25OYW1lOiAnbW9uZXlSZWNoYXJnZScsIGJhbGFuY2U6IDgwLCBjaGVja2VkOiBmYWxzZSB9LFxuICAgIF0sXG4gICAgc2hvb3NlVHlwZTogJ3d4JyxcbiAgfSxcblxuICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zOiBhbnkpIHtcbiAgICBjb25zdCB1c2VyID0gd3guZ2V0U3RvcmFnZVN5bmMoXCJ1c2VySW5mb1wiKTtcbiAgICBjb25zb2xlLmxvZyhcInVzZXJJbmZvXCIsIHVzZXIpO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgdXNlckluZm86IHtcbiAgICAgICAgLi4udXNlcixcbiAgICAgICAgdmlwVHlwZTogXCJicm9uemVcIixcbiAgICAgICAgdmlwRXhwaXJlQXQ6IFwiMjAyMC4xMi4zMVwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhgPT09b3B0aW9ucz09PWAsIG9wdGlvbnMpO1xuICAgIGlmIChvcHRpb25zLnBheUluZm8pIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwYXlJbmZvOiBKU09OLnBhcnNlKG9wdGlvbnMucGF5SW5mbyksXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgcmFkaW9DaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ3JhZGlv5Y+R55SfY2hhbmdl5LqL5Lu277yM6YCJ5oup55qE5pSv5LuY5pa55byP5Li677yaJywgZS5kZXRhaWwudmFsdWUpXG5cbiAgICBjb25zdCBwYXlJdGVtcyA9IHRoaXMuZGF0YS5wYXlJdGVtcztcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGF5SXRlbXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgIHBheUl0ZW1zW2ldLmNoZWNrZWQgPSBwYXlJdGVtc1tpXS52YWx1ZSA9PT0gZS5kZXRhaWwudmFsdWVcbiAgICB9XG5cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcGF5SXRlbXMsXG4gICAgICBzaG9vc2VUeXBlOiBlLmRldGFpbC52YWx1ZSxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDnq4vljbPmlK/ku5ggKi9cbiAgZ29QYXkoKSB7XG4gICAgY29uc3QgeyBwYXlJbmZvLCBzaG9vc2VUeXBlIH0gPSB0aGlzLmRhdGE7XG5cbiAgICAvLyBUT0RPIOiOt+WPlueUqOaIt+W9k+WJjee8mOWIhuW4geS9meminVxuICAgIGlmIChzaG9vc2VUeXBlID09PSAneWZiJyAmJiBwYXlJbmZvLnZhbHVlID4gODgpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn5L2Z6aKd5LiN6LazJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBkdXJhdGlvbjogMjAwMFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKFwi5qC55o2u5pSv5LuY5pa55byP6LCD55So5o6l5Y+jXCIpO1xuICB9LFxuXG4gIC8vIOWIpOaWreW9k+WJjeaYr+WQpuaYr+W8gOmAmueKtuaAgVxuICB3eFBheTogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcVBhcmFtcyA9IHRoaXMucHJlcGFyZVBheUluZm8oKTtcbiAgICBBcGkuYnV5VmlwQnlXZWNoYXQocmVxUGFyYW1zKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdC5kYXRhO1xuICAgICAgICB0aGlzLmNhbGxXeEZvclBheShkYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhcInd4UGF5XCIpO1xuICB9LFxuXG4gIGNhbGxXeEZvclBheTogZnVuY3Rpb24gKGRhdGE6IGFueSkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnJlcXVlc3RQYXltZW50KHtcbiAgICAgIHRpbWVTdGFtcDogZGF0YS50aW1lU3RhbXAsXG4gICAgICBub25jZVN0cjogZGF0YS5ub25jZVN0cixcbiAgICAgIC8vIHBhY2thZ2U6IGRhdGEucGFja2FnZSxcbiAgICAgIHBhY2thZ2U6IFwicHJlcGF5X2lkPVwiICsgZGF0YS5wcmVwYXlJZCxcbiAgICAgIHNpZ25UeXBlOiBcIk1ENVwiLFxuICAgICAgcGF5U2lnbjogZGF0YS5wYXlTaWduLFxuICAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg5LuY5qy+5oiQ5YqfOiBgLCByZXMpO1xuICAgICAgfSxcbiAgICAgIGZhaWwocmVzOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOS7mOasvuWksei0pTogYCwgcmVzKTtcbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZShyZXM6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg5LuY5qy+57uT5p2fY29tcGxldGU6IGAsIHJlcyk7XG4gICAgICAgIC8vIOS7mOasvuaIkOWKn+ebtOaOpeabtOaWsFxuICAgICAgICBBcGkuY2hlY2tPcmRlclN0YXR1cyhkYXRhLm9yZGVyTnVtKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgdGhhdC5yZXF1ZXN0Rm9yVXNlckluZm8oKTtcbiAgICAgICAgICAgIC8vIOi3s+i9rOiuouWNleivpuaDhVxuICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgIHVybDogYC4uL3BheVN1Y2Nlc3MvcGF5U3VjY2Vzc2AsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcblxuICByZXF1ZXN0Rm9yVXNlckluZm8oKSB7XG4gICAgQXBpLmdldFVzZXJJbmZvKHRoaXMuZGF0YS51c2VySW5mby5vcGVuaWQpLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IHVzZXJJbmZvID0gcmVzdWx0LmRhdGE7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIHVzZXJJbmZvLFxuICAgICAgICB9KTtcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoXCJ1c2VySW5mb1wiLCB1c2VySW5mbyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIHtcbiAgLy8g6YCJ5oup5bm05LuYLCDmnIjku5gsIOWto+S7mFxuICBcInBlcmlvZFwiOiBcIm1vbnRoXCIsIC8vIFwibW9udGhcIi3mnIggXCJzZWFzb25cIi3lraPluqYgXCJ5ZWFyXCIt5bm0XG4gIC8vIOS8muWRmOexu+WeiyBcbiAgXCJ2aXBUeXBlXCI6IFwiYnJvbnplXCIsIC8vIFwiYnJvbnplXCIt6buE6ZOcIFwicGxhdGludW1cIi3nmb3ph5EgXG4gIC8vIOS7mOasvuexu+Wei1xuICBcInBheVR5cGVcIjogXCJqb2luXCIgLy8gXCJqb2luXCIt5Yqg5YWlIFwicmVuZXdcIi3nu63otLkgXCJ1cGdyYWRlXCIt5Y2H57qnXG59XG4gICAqIFxuICAqL1xuICBwcmVwYXJlUGF5SW5mbzogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcVBhcmFtczogYW55ID0ge307XG4gICAgY29uc3QgeyB1c2VySW5mbywgcGF5SW5mbyB9ID0gdGhpcy5kYXRhO1xuICAgIGNvbnNvbGUubG9nKHVzZXJJbmZvLnZpcFR5cGUpO1xuICAgIGNvbnNvbGUubG9nKHBheUluZm8pO1xuICAgIHN3aXRjaCAodXNlckluZm8udmlwVHlwZSkge1xuICAgICAgLy8g6buE6ZOcXG4gICAgICBjYXNlIFwiYnJvbnplXCI6XG4gICAgICAgIGlmIChwYXlJbmZvLnZpcFR5cGUgPT09IFwiYnJvbnplXCIpIHtcbiAgICAgICAgICAvL+e7rei0uVxuICAgICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJyZW5ld1wiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJ1cGdyYWRlXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmVxUGFyYW1zLnBlcmlvZCA9IHBheUluZm8ubmFtZTtcbiAgICAgICAgcmVxUGFyYW1zLnZpcFR5cGUgPSBwYXlJbmZvLnZpcFR5cGU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8g55m96YeRXG4gICAgICBjYXNlIFwicGxhdGludW1cIjpcbiAgICAgICAgcmVxUGFyYW1zLnBheVR5cGUgPSBcInJlbmV3XCI7XG4gICAgICAgIHJlcVBhcmFtcy5wZXJpb2QgPSBwYXlJbmZvLm5hbWU7XG4gICAgICAgIHJlcVBhcmFtcy52aXBUeXBlID0gXCJwbGF0aW51bVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlcVBhcmFtcy5wYXlUeXBlID0gXCJqb2luXCI7XG4gICAgICAgIHJlcVBhcmFtcy5wZXJpb2QgPSBwYXlJbmZvLm5hbWU7XG4gICAgICAgIHJlcVBhcmFtcy52aXBUeXBlID0gcGF5SW5mby52aXBUeXBlO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHJlcVBhcmFtcztcbiAgfSxcblxuICBjb2luUGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coXCJjb2luUGF5XCIpO1xuICB9LFxuXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge30sXG5cbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7fSxcblxuICBvblVubG9hZDogZnVuY3Rpb24gKCkge30sXG5cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHt9LFxufSk7XG4iXX0=
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../../service/api.service");
const utils = require("../../../utils/utils");
const app = getApp();
Page({
    data: {
        userInfo: {},
        hasUserInfo: false,
        canIUse: wx.canIUse('button.open-type.getUserInfo'),
        smsDisable: false,
        smsTime: 59,
        phone: '',
        submitDisable: false,
        totalMoney: 0,
    },
    onLoad() {
        this.setData({
            userInfo: app.globalData.userInfo,
            totalMoney: app.globalData.userInfo.coin,
            hasUserInfo: true,
        });
    },
    bindPhoneInput(e) {
        this.setData({
            phone: e.detail.value
        });
    },
    getPhoneCode() {
        const { phone } = this.data;
        if (!utils.validateEmpty(phone, '请输入手机号')) {
            return false;
        }
    },
    goRegister() {
        wx.navigateTo({
            url: '../registerphone/registerphone'
        });
    },
    goHome() {
        wx.navigateTo({
            url: '../home/home'
        });
    },
    getUserInfo(e) {
        app.globalData.userInfo = e.detail.userInfo;
        this.setData({
            userInfo: e.detail.userInfo,
            hasUserInfo: true
        });
        this.IsFirstTime() ? this.goRegister() : this.goHome();
    },
    IsFirstTime() {
        return false;
    },
    jumpOver() {
        wx.navigateTo({
            url: '../home/home',
        });
    },
    next() {
        wx.navigateTo({
            url: '../matching/matching',
        });
    },
    formSubmit(e) {
        this.setData({
            submitDisable: true
        });
        const params = e.detail.value;
        if (!utils.validateEmpty(params.money, '请输入充值金额')) {
            return false;
        }
        Api.rechargeMoney(Object.assign({}, params, { money: +params.money })).then((result) => {
            console.log(`recharge money request:`, result);
            this.setData({
                submitDisable: true
            });
            this.callWxForPay(result.data);
        });
    },
    callWxForPay(data) {
        const _this = this;
        wx.requestPayment({
            timeStamp: data.timeStamp,
            nonceStr: data.nonceStr,
            package: 'prepay_id=' + data.prepayId,
            signType: 'MD5',
            paySign: data.paySign,
            success(res) {
                console.log(`付款成功: `, res);
            },
            fail(res) {
                console.log(`付款失败: `, res);
            },
            complete(res) {
                console.log(`付款结束complete: `, res);
                Api.checkOrderStatus(data.orderNum).then((result) => {
                    if (result && result.code === 200) {
                        console.log(`check order result`);
                        utils.showModelAction('支付成功', () => {
                            wx.navigateBack({
                                delta: 1
                            });
                        });
                        _this.setData({
                            submitDisable: false
                        });
                    }
                    else {
                        _this.setData({
                            submitDisable: false
                        });
                        utils.showModal('支付失败', result.message);
                    }
                });
            }
        });
    },
    formReset() {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjaGFyZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZWNoYXJnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9EQUFvRDtBQUNwRCw4Q0FBOEM7QUFHOUMsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFVLENBQUE7QUFFNUIsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsS0FBSztRQUNsQixPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztRQUNuRCxVQUFVLEVBQUUsS0FBSztRQUNqQixPQUFPLEVBQUUsRUFBRTtRQUNYLEtBQUssRUFBRSxFQUFFO1FBQ1QsYUFBYSxFQUFFLEtBQUs7UUFDcEIsVUFBVSxFQUFFLENBQUM7S0FDZDtJQUVELE1BQU07UUFDSixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osUUFBUSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUTtZQUNqQyxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSTtZQUN4QyxXQUFXLEVBQUUsSUFBSTtTQUNsQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsY0FBYyxDQUFDLENBQU07UUFDbkIsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUs7U0FDdEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFlBQVk7UUFDVixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEVBQUU7WUFDekMsT0FBTyxLQUFLLENBQUM7U0FDZDtJQUNILENBQUM7SUFFRCxVQUFVO1FBQ1IsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSxnQ0FBZ0M7U0FDdEMsQ0FBQyxD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ZSxDQUFDLE1BQU0sRUFBQyxHQUFHLEVBQUU7NEJBQ2hDLEVBQUUsQ0FBQyxZQUFZLENBQUM7Z0NBQ2QsS0FBSyxFQUFFLENBQUM7NkJBQ1QsQ0FBQyxDQUFBO3dCQUNKLENBQUMsQ0FBQyxDQUFDO3dCQUNILEtBQUssQ0FBQyxPQUFRLENBQUM7NEJBQ2IsYUFBYSxFQUFFLEtBQUs7eUJBQ3JCLENBQUMsQ0FBQztxQkFDSjt5QkFBSTt3QkFDSCxLQUFLLENBQUMsT0FBUSxDQUFDOzRCQUNiLGFBQWEsRUFBRSxLQUFLO3lCQUNyQixDQUFDLENBQUM7d0JBQ0gsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3FCQUN6QztnQkFDSCxDQUFDLENBQUMsQ0FBQTtZQUNKLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsU0FBUztJQUNULENBQUM7Q0FFRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBcGkgZnJvbSAnLi4vLi4vLi4vc2VydmljZS9hcGkuc2VydmljZSc7XG5pbXBvcnQgKiBhcyB1dGlscyBmcm9tICcuLi8uLi8uLi91dGlscy91dGlscyc7XG5cbmltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uLy4uL2FwcCc7XG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgdXNlckluZm86IHt9LFxuICAgIGhhc1VzZXJJbmZvOiBmYWxzZSxcbiAgICBjYW5JVXNlOiB3eC5jYW5JVXNlKCdidXR0b24ub3Blbi10eXBlLmdldFVzZXJJbmZvJyksXG4gICAgc21zRGlzYWJsZTogZmFsc2UsXG4gICAgc21zVGltZTogNTksXG4gICAgcGhvbmU6ICcnLFxuICAgIHN1Ym1pdERpc2FibGU6IGZhbHNlLFxuICAgIHRvdGFsTW9uZXk6IDAsXG4gIH0sXG4gIFxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICB1c2VySW5mbzogYXBwLmdsb2JhbERhdGEudXNlckluZm8sXG4gICAgICB0b3RhbE1vbmV5OiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby5jb2luLFxuICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgYmluZFBob25lSW5wdXQoZTogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwaG9uZTogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuXG4gIGdldFBob25lQ29kZSgpOiBhbnkge1xuICAgIGNvbnN0IHsgcGhvbmUgfSA9IHRoaXMuZGF0YTtcbiAgICBpZiAoIXV0aWxzLnZhbGlkYXRlRW1wdHkocGhvbmUsICfor7fovpPlhaXmiYvmnLrlj7cnKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICBnb1JlZ2lzdGVyKCk6IHZvaWQge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiAnLi4vcmVnaXN0ZXJwaG9uZS9yZWdpc3RlcnBob25lJ1xuICAgIH0pXG4gIH0sXG5cbiAgZ29Ib21lKCk6IHZvaWQge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiAnLi4vaG9tZS9ob21lJ1xuICAgIH0pXG4gIH0sXG5cbiAgLyoqIFxuICAgKiDvvIjmnKrmjojmnYPvvInmiYvliqjllKTotbfmjojmnYNcbiAgICovXG4gIGdldFVzZXJJbmZvKGU6IGFueSkge1xuICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gZS5kZXRhaWwudXNlckluZm9cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHVzZXJJbmZvOiBlLmRldGFpbC51c2VySW5mbyxcbiAgICAgIGhhc1VzZXJJbmZvOiB0cnVlXG4gICAgfSlcbiAgICB0aGlzLklzRmlyc3RUaW1lKCkgPyB0aGlzLmdvUmVnaXN0ZXIoKSA6IHRoaXMuZ29Ib21lKCk7XG4gIH0sXG5cbiAgLyoqIOaYr+WQpummluasoSAqL1xuICBJc0ZpcnN0VGltZSgpOiBCb29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfSxcblxuICBqdW1wT3ZlcigpOiB2b2lkIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy4uL2hvbWUvaG9tZScsXG4gICAgfSlcbiAgfSxcblxuICBuZXh0KCk6IHZvaWQge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiAnLi4vbWF0Y2hpbmcvbWF0Y2hpbmcnLFxuICAgIH0pXG4gIH0sXG4gICBcbiAgZm9ybVN1Ym1pdChlOiBhbnkpOiBhbnkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc3VibWl0RGlzYWJsZTogdHJ1ZVxuICAgIH0pOyBcbiAgICBjb25zdCBwYXJhbXMgPSBlLmRldGFpbC52YWx1ZVxuICAgIGlmICghdXRpbHMudmFsaWRhdGVFbXB0eShwYXJhbXMubW9uZXksICfor7fovpPlhaXlhYXlgLzph5Hpop0nKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBUT0RPXG4gICAgQXBpLnJlY2hhcmdlTW9uZXkoe1xuICAgICAgLi4ucGFyYW1zLFxuICAgICAgbW9uZXk6ICtwYXJhbXMubW9uZXlcbiAgICB9KS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYHJlY2hhcmdlIG1vbmV5IHJlcXVlc3Q6YCwgcmVzdWx0KTtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBzdWJtaXREaXNhYmxlOiB0cnVlXG4gICAgICB9KTsgIFxuICAgICAgdGhpcy5jYWxsV3hGb3JQYXkocmVzdWx0LmRhdGEpXG4gICAgICAvLyBpZiAocmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgLy8gICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIC8vICAgICB1cmw6ICcuLi9tYXRjaGluZy9tYXRjaGluZycsXG4gICAgICAvLyAgIH0pO1xuICAgICAgLy8gfSBlbHNlIHtcbiAgICAgIC8vICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAvLyAgICAgc3VibWl0RGlzYWJsZTogZmFsc2VcbiAgICAgIC8vICAgfSk7IFxuICAgICAgLy8gICB1dGlscy5zaG93TW9kYWwocmVzdWx0Lm1lc3NhZ2UpO1xuICAgICAgLy8gfVxuICAgIH0pXG4gIH0sXG5cbiAgY2FsbFd4Rm9yUGF5KGRhdGE6IGFueSl7XG4gICAgY29uc3QgX3RoaXMgPSB0aGlzO1xuICAgIHd4LnJlcXVlc3RQYXltZW50KHtcbiAgICAgIHRpbWVTdGFtcDogZGF0YS50aW1lU3RhbXAsXG4gICAgICBub25jZVN0cjogZGF0YS5ub25jZVN0cixcbiAgICAgIC8vIHBhY2thZ2U6IGRhdGEucGFja2FnZSxcbiAgICAgIHBhY2thZ2U6ICdwcmVwYXlfaWQ9JyArIGRhdGEucHJlcGF5SWQsXG4gICAgICBzaWduVHlwZTogJ01ENScsXG4gICAgICBwYXlTaWduOiBkYXRhLnBheVNpZ24sXG4gICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhg5LuY5qy+5oiQ5YqfOiBgLCByZXMpXG4gICAgICB9LFxuICAgICAgZmFpbChyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOS7mOasvuWksei0pTogYCwgcmVzKVxuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlIChyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOS7mOasvue7k+adn2NvbXBsZXRlOiBgLCByZXMpXG4gICAgICAgIC8vIOS7mOasvuaIkOWKn+ebtOaOpeabtOaWsCBcbiAgICAgICAgQXBpLmNoZWNrT3JkZXJTdGF0dXMoZGF0YS5vcmRlck51bSkudGhlbigocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5jb2RlID09PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBjaGVjayBvcmRlciByZXN1bHRgKVxuICAgICAgICAgICAgLy8g6Lez6L2s6K6i5Y2V6K+m5oOFXG4gICAgICAgICAgICAvLyB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgIC8vICAgdXJsOiBgLi4vLi4vLi4vcGFnZXMvbXlIb21lL215SG9tZWAsXG4gICAgICAgICAgICAvLyB9KVxuICAgICAgICAgICAgdXRpbHMuc2hvd01vZGVsQWN0aW9uKCfmlK/ku5jmiJDlip8nLCgpID0+IHtcbiAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICBkZWx0YTogMVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBfdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgIHN1Ym1pdERpc2FibGU6IGZhbHNlXG4gICAgICAgICAgICB9KTsgXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBfdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgIHN1Ym1pdERpc2FibGU6IGZhbHNlXG4gICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICB1dGlscy5zaG93TW9kYWwoJ+aUr+S7mOWksei0pScsIHJlc3VsdC5tZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICBmb3JtUmVzZXQoKTogdm9pZCB7XG4gIH1cbiAgXG59KVxuIl19
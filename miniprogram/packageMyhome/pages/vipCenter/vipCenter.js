"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vipService_1 = require("./config/vipService");
const utils_1 = require("./config/utils");
const utils_2 = require("../../../utils/utils");
const api_service_1 = require("../../../service/api.service");
Page({
    data: {
        BJ: vipService_1.BAIJIN,
        HT: vipService_1.HUANGTONG,
        rightList: vipService_1.RIGHTLIST,
        swiper: {
            indicatorDots: true,
            vertical: false,
            autoplay: false,
            interval: 2000,
            duration: 500,
        },
        selectValue: {},
        payBarStatus: {
            isShow: true,
            content: "立即支付",
        },
        userInfo: {},
        currentRight: 0,
        currentPrice: 0,
        upgradeFlag: false,
        tipFlag: false,
        upgradeInfo: {},
    },
    onLoad: function (option) {
        const type = option.type;
        console.log(`vipCenter type:`, type);
        this.adjustVipType(type);
        const user = wx.getStorageSync("userInfo");
        console.log("userInfo", user);
        this.setData({
            userInfo: Object.assign({}, user, { vipExpireAt: utils_2.formatHLSTime(user.vipExpireAt) }),
        });
        api_service_1.getVipInfo().then((res) => {
            const priceList = utils_1.dealWithVipPriceInfo(res.data);
            const vipRightInfo = utils_1.dealWithVipRightList(res.data);
            console.log(priceList);
            this.setData({
                BJ: priceList.BAIJIN,
                HT: priceList.HUANGTONG,
                rightList: vipRightInfo,
            });
            console.log(`=====vipRightInfo=====`, vipRightInfo);
        });
        if (user.vipType && user.vipType !== "platinum") {
            api_service_1.vipListInfo().then((res) => {
                if (res.code === 200) {
                    this.setData({
                        upgradeInfo: res.data.upgradeInfo,
                    });
                }
            });
        }
        this.checkStatus(this.data.currentRight);
    },
    adjustVipType(type) {
        if (type === "1") {
            this.setData({
                currentRight: 0
            });
        }
        else if (type === "2") {
            this.setData({
                currentRight: 1
            });
        }
        else if (type === "3") {
            this.setData({
                currentRight: 1
            });
        }
    },
    getVipInfo() { },
    goRecharge() {
        let payInfo = Object.assign({}, this.data.selectValue, { currentPrice: this.data.currentPrice });
        payInfo = JSON.stringify(payInfo);
        if (this.data.currentPrice === 0) {
            wx.showToast({
                title: "请选择会员充值方式",
                icon: "none",
                duration: 2000,
            });
            return;
        }
        wx.navigateTo({
            url: `../../../packageMyhome/pages/choosePay/choosePay?payInfo=${payInfo}`,
        });
    },
    swiperChange(e) {
        console.log(e.detail.current);
        this.checkStatus(e.detail.current);
    },
    checkStatus(currentRight) {
        const { userInfo } = this.data;
        this.data.HT.priceList.forEach((el) => {
            el.select = false;
        });
        this.data.BJ.priceList.forEach((el) => {
            el.select = false;
        });
        if (userInfo.vipType === "platinum" && currentRight === 0) {
            this.setData({
                payBarStatus: {
                    isShow: false,
                },
                currentPrice: 0,
                tipFlag: true,
                selectValue: {},
                HT: this.data.HT,
                BJ: this.data.BJ,
                upgradeFlag: false,
                currentRight: currentRight,
            });
            return;
        }
        else if ((userInfo.vipType === "platinum" && currentRight === 1) ||
            (userInfo.vipType === "bronze" && currentRight === 0)) {
            this.setData({
                payBarStatus: {
                    isShow: true,
                    content: "立即续费",
                },
                tipFlag: false,
                selectValue: {},
                currentPrice: 0,
                HT: this.data.HT,
                BJ: this.data.BJ,
                upgradeFlag: false,
                currentRight: currentRight,
            });
        }
        else if (userInfo.vipType === "bronze" && currentRight === 1) {
            this.setData({
                payBarStatus: {
                    isShow: true,
                    content: "立即升级",
                },
                currentPrice: this.data.upgradeInfo.totalPrice,
                upgradeFlag: true,
                HT: this.data.HT,
                BJ: this.data.BJ,
                selectValue: {},
                tipFlag: false,
                currentRight: currentRight,
            });
        }
    },
    selectPrice(e) {
        const { selectIndex, currentRight } = e.currentTarget.dataset;
        console.log(e.currentTarget.dataset);
        const { BJ, HT } = this.data;
        let currentPrice = 0;
        let selectValue = {};
        const priceList = currentRight === 0 ? HT.priceList : BJ.priceList;
        priceList.forEach((item, index) => {
            if (index === selectIndex) {
                item.select = true;
            }
            else {
                item.select = false;
            }
        });
        if (currentRight === 0) {
            HT.priceList = priceList;
            currentPrice = HT.priceList[selectIndex].value;
            selectValue = HT.priceList[selectIndex];
        }
        else {
            currentPrice = BJ.priceList[selectIndex].value;
            BJ.priceList = priceList;
            selectValue = BJ.priceList[selectIndex];
        }
        this.setData({
            BJ,
            HT,
            currentPrice,
            selectValue: Object.assign({}, selectValue, { vipType: currentRight === 0 ? "bronze" : "platinum" }),
        });
        console.log(this.data.HT.priceList);
        console.log(this.data.BJ.priceList);
        console.log(`vipCenter selectValue:`, selectValue);
    },
    formatVipExpiredAtDate: function (date) {
        console.log("-----come in -------");
        return utils_2.formatHLSTime(date);
    },
    onReady: function () { },
    onShow: function () { },
    onHide: function () { },
    onUnload: function () { },
    onPullDownRefresh: function () { },
    onReachBottom: function () { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlwQ2VudGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmlwQ2VudGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQW1FO0FBQ25FLDBDQUE0RTtBQUM1RSxnREFBcUQ7QUFDckQsOERBQXVFO0FBRXZFLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLEVBQUUsRUFBRSxtQkFBTTtRQUNWLEVBQUUsRUFBRSxzQkFBUztRQUNiLFNBQVMsRUFBRSxzQkFBUztRQUNwQixNQUFNLEVBQUU7WUFDTixhQUFhLEVBQUUsSUFBSTtZQUNuQixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLElBQUk7WUFDZCxRQUFRLEVBQUUsR0FBRztTQUNkO1FBQ0QsV0FBVyxFQUFFLEVBQVM7UUFDdEIsWUFBWSxFQUFFO1lBQ1osTUFBTSxFQUFFLElBQUk7WUFDWixPQUFPLEVBQUUsTUFBTTtTQUNoQjtRQUNELFFBQVEsRUFBRSxFQUFTO1FBQ25CLFlBQVksRUFBRSxDQUFDO1FBQ2YsWUFBWSxFQUFFLENBQUM7UUFDZixXQUFXLEVBQUUsS0FBSztRQUNsQixPQUFPLEVBQUUsS0FBSztRQUNkLFdBQVcsRUFBRSxFQUFTO0tBQ3ZCO0lBQ0QsTUFBTSxFQUFFLFVBQVUsTUFBVztRQUMzQixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV6QixNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixRQUFRLG9CQUNILElBQUksSUFDUCxX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LEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVELHNCQUFzQixFQUFFLFVBQVUsSUFBUztRQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDcEMsT0FBTyxxQkFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPLEVBQUUsY0FBYSxDQUFDO0lBRXZCLE1BQU0sRUFBRSxjQUFhLENBQUM7SUFFdEIsTUFBTSxFQUFFLGNBQWEsQ0FBQztJQUV0QixRQUFRLEVBQUUsY0FBYSxDQUFDO0lBRXhCLGlCQUFpQixFQUFFLGNBQWEsQ0FBQztJQUVqQyxhQUFhLEVBQUUsY0FBYSxDQUFDO0NBQzlCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJBSUpJTiwgSFVBTkdUT05HLCBSSUdIVExJU1QgfSBmcm9tIFwiLi9jb25maWcvdmlwU2VydmljZVwiO1xuaW1wb3J0IHsgZGVhbFdpdGhWaXBQcmljZUluZm8sIGRlYWxXaXRoVmlwUmlnaHRMaXN0IH0gZnJvbSBcIi4vY29uZmlnL3V0aWxzXCI7XG5pbXBvcnQgeyBmb3JtYXRITFNUaW1lIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3V0aWxzXCI7XG5pbXBvcnQgeyBnZXRWaXBJbmZvLCB2aXBMaXN0SW5mbyB9IGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlL2FwaS5zZXJ2aWNlXCI7XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgQko6IEJBSUpJTixcbiAgICBIVDogSFVBTkdUT05HLFxuICAgIHJpZ2h0TGlzdDogUklHSFRMSVNULFxuICAgIHN3aXBlcjoge1xuICAgICAgaW5kaWNhdG9yRG90czogdHJ1ZSxcbiAgICAgIHZlcnRpY2FsOiBmYWxzZSxcbiAgICAgIGF1dG9wbGF5OiBmYWxzZSxcbiAgICAgIGludGVydmFsOiAyMDAwLFxuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICB9LFxuICAgIHNlbGVjdFZhbHVlOiB7fSBhcyBhbnksXG4gICAgcGF5QmFyU3RhdHVzOiB7XG4gICAgICBpc1Nob3c6IHRydWUsXG4gICAgICBjb250ZW50OiBcIueri+WNs+aUr+S7mFwiLFxuICAgIH0sXG4gICAgdXNlckluZm86IHt9IGFzIGFueSxcbiAgICBjdXJyZW50UmlnaHQ6IDAsIC8vIDAtaHVhbmd0b25nIDEtYmFpamluXG4gICAgY3VycmVudFByaWNlOiAwLFxuICAgIHVwZ3JhZGVGbGFnOiBmYWxzZSxcbiAgICB0aXBGbGFnOiBmYWxzZSxcbiAgICB1cGdyYWRlSW5mbzoge30gYXMgYW55LFxuICB9LFxuICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb246IGFueSkge1xuICAgIGNvbnN0IHR5cGUgPSBvcHRpb24udHlwZTtcbiAgICBjb25zb2xlLmxvZyhgdmlwQ2VudGVyIHR5cGU6YCwgdHlwZSk7XG4gICAgdGhpcy5hZGp1c3RWaXBUeXBlKHR5cGUpO1xuICAgIC8vIOiOt+WPlueUqOaIt+S/oeaBr1xuICAgIGNvbnN0IHVzZXIgPSB3eC5nZXRTdG9yYWdlU3luYyhcInVzZXJJbmZvXCIpO1xuICAgIGNvbnNvbGUubG9nKFwidXNlckluZm9cIiwgdXNlcik7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICB1c2VySW5mbzoge1xuICAgICAgICAuLi51c2VyLFxuICAgICAgICB2aXBFeHBpcmVBdDogZm9ybWF0SExTVGltZSh1c2VyLnZpcEV4cGlyZUF0KSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyDojrflj5Z2aXDmnYPnm4pcbiAgICBnZXRWaXBJbmZvKCkudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IHByaWNlTGlzdCA9IGRlYWxXaXRoVmlwUHJpY2VJbmZvKHJlcy5kYXRhKTtcbiAgICAgIGNvbnN0IHZpcFJpZ2h0SW5mbyA9IGRlYWxXaXRoVmlwUmlnaHRMaXN0KHJlcy5kYXRhKTtcbiAgICAgIGNvbnNvbGUubG9nKHByaWNlTGlzdCk7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgQko6IHByaWNlTGlzdC5CQUlKSU4sXG4gICAgICAgIEhUOiBwcmljZUxpc3QuSFVBTkdUT05HLFxuICAgICAgICByaWdodExpc3Q6IHZpcFJpZ2h0SW5mbyxcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coYD09PT09dmlwUmlnaHRJbmZvPT09PT1gLCB2aXBSaWdodEluZm8pO1xuICAgIH0pO1xuXG4gICAgLy8g6I635Y+Wdmlw55qE5pu05paw5L+h5oGvXG4gICAgaWYgKHVzZXIudmlwVHlwZSAmJiB1c2VyLnZpcFR5cGUgIT09IFwicGxhdGludW1cIikge1xuICAgICAgdmlwTGlzdEluZm8oKS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgdXBncmFkZUluZm86IHJlcy5kYXRhLnVwZ3JhZGVJbmZvLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmNoZWNrU3RhdHVzKHRoaXMuZGF0YS5jdXJyZW50UmlnaHQpO1xuICB9LFxuXG4gIGFkanVzdFZpcFR5cGUodHlwZTogc3RyaW5nKSB7XG4gICAgaWYgKHR5cGUgPT09IFwiMVwiKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgY3VycmVudFJpZ2h0OiAwXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCIyXCIpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBjdXJyZW50UmlnaHQ6IDFcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcIjNcIikge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIGN1cnJlbnRSaWdodDogMVxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgZ2V0VmlwSW5mbygpOiBhbnkge30sXG5cbiAgLyoqIOWFheWAvCAqL1xuICBnb1JlY2hhcmdlKCk6IGFueSB7XG4gICAgbGV0IHBheUluZm86IGFueSA9IHtcbiAgICAgIC4uLnRoaXMuZGF0YS5zZWxlY3RWYWx1ZSxcbiAgICAgIGN1cnJlbnRQcmljZTogdGhpcy5kYXRhLmN1cnJlbnRQcmljZSxcbiAgICB9O1xuICAgIHBheUluZm8gPSBKU09OLnN0cmluZ2lmeShwYXlJbmZvKTtcbiAgICBpZiAodGhpcy5kYXRhLmN1cnJlbnRQcmljZSA9PT0gMCkge1xuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6IFwi6K+36YCJ5oup5Lya5ZGY5YWF5YC85pa55byPXCIsXG4gICAgICAgIGljb246IFwibm9uZVwiLFxuICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uLy4uLy4uL3BhY2thZ2VNeWhvbWUvcGFnZXMvY2hvb3NlUGF5L2Nob29zZVBheT9wYXlJbmZvPSR7cGF5SW5mb31gLFxuICAgIH0pO1xuICB9LFxuXG4gIHN3aXBlckNoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlLmRldGFpbC5jdXJyZW50KTtcbiAgICB0aGlzLmNoZWNrU3RhdHVzKGUuZGV0YWlsLmN1cnJlbnQpO1xuICB9LFxuXG4gIGNoZWNrU3RhdHVzKGN1cnJlbnRSaWdodDogYW55KSB7XG4gICAgY29uc3QgeyB1c2VySW5mbyB9ID0gdGhpcy5kYXRhO1xuICAgIHRoaXMuZGF0YS5IVC5wcmljZUxpc3QuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgIGVsLnNlbGVjdCA9IGZhbHNlO1xuICAgIH0pO1xuICAgIHRoaXMuZGF0YS5CSi5wcmljZUxpc3QuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgIGVsLnNlbGVjdCA9IGZhbHNlO1xuICAgIH0pO1xuICAgIGlmICh1c2VySW5mby52aXBUeXBlID09PSBcInBsYXRpbnVtXCIgJiYgY3VycmVudFJpZ2h0ID09PSAwKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcGF5QmFyU3RhdHVzOiB7XG4gICAgICAgICAgaXNTaG93OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgY3VycmVudFByaWNlOiAwLFxuICAgICAgICB0aXBGbGFnOiB0cnVlLFxuICAgICAgICBzZWxlY3RWYWx1ZToge30sXG4gICAgICAgIEhUOiB0aGlzLmRhdGEuSFQsXG4gICAgICAgIEJKOiB0aGlzLmRhdGEuQkosXG4gICAgICAgIHVwZ3JhZGVGbGFnOiBmYWxzZSxcbiAgICAgICAgY3VycmVudFJpZ2h0OiBjdXJyZW50UmlnaHQsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgKHVzZXJJbmZvLnZpcFR5cGUgPT09IFwicGxhdGludW1cIiAmJiBjdXJyZW50UmlnaHQgPT09IDEpIHx8XG4gICAgICAodXNlckluZm8udmlwVHlwZSA9PT0gXCJicm9uemVcIiAmJiBjdXJyZW50UmlnaHQgPT09IDApXG4gICAgKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcGF5QmFyU3RhdHVzOiB7XG4gICAgICAgICAgaXNTaG93OiB0cnVlLFxuICAgICAgICAgIGNvbnRlbnQ6IFwi56uL5Y2z57ut6LS5XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHRpcEZsYWc6IGZhbHNlLFxuICAgICAgICBzZWxlY3RWYWx1ZToge30sXG4gICAgICAgIGN1cnJlbnRQcmljZTogMCxcbiAgICAgICAgSFQ6IHRoaXMuZGF0YS5IVCxcbiAgICAgICAgQko6IHRoaXMuZGF0YS5CSixcbiAgICAgICAgdXBncmFkZUZsYWc6IGZhbHNlLFxuICAgICAgICBjdXJyZW50UmlnaHQ6IGN1cnJlbnRSaWdodCxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodXNlckluZm8udmlwVHlwZSA9PT0gXCJicm9uemVcIiAmJiBjdXJyZW50UmlnaHQgPT09IDEpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwYXlCYXJTdGF0dXM6IHtcbiAgICAgICAgICBpc1Nob3c6IHRydWUsXG4gICAgICAgICAgY29udGVudDogXCLnq4vljbPljYfnuqdcIixcbiAgICAgICAgfSxcbiAgICAgICAgY3VycmVudFByaWNlOiB0aGlzLmRhdGEudXBncmFkZUluZm8udG90YWxQcmljZSxcbiAgICAgICAgdXBncmFkZUZsYWc6IHRydWUsXG4gICAgICAgIEhUOiB0aGlzLmRhdGEuSFQsXG4gICAgICAgIEJKOiB0aGlzLmRhdGEuQkosXG4gICAgICAgIHNlbGVjdFZhbHVlOiB7fSxcbiAgICAgICAgdGlwRmxhZzogZmFsc2UsXG4gICAgICAgIGN1cnJlbnRSaWdodDogY3VycmVudFJpZ2h0LFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHNlbGVjdFByaWNlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgc2VsZWN0SW5kZXgsIGN1cnJlbnRSaWdodCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgY29uc29sZS5sb2coZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQpO1xuICAgIGNvbnN0IHsgQkosIEhUIH0gPSB0aGlzLmRhdGE7XG4gICAgbGV0IGN1cnJlbnRQcmljZSA9IDA7XG4gICAgbGV0IHNlbGVjdFZhbHVlOiBhbnkgPSB7fTtcblxuICAgIGNvbnN0IHByaWNlTGlzdCA9IGN1cnJlbnRSaWdodCA9PT0gMCA/IEhULnByaWNlTGlzdCA6IEJKLnByaWNlTGlzdDtcbiAgICBwcmljZUxpc3QuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChpbmRleCA9PT0gc2VsZWN0SW5kZXgpIHtcbiAgICAgICAgaXRlbS5zZWxlY3QgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbS5zZWxlY3QgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoY3VycmVudFJpZ2h0ID09PSAwKSB7XG4gICAgICBIVC5wcmljZUxpc3QgPSBwcmljZUxpc3Q7XG4gICAgICBjdXJyZW50UHJpY2UgPSBIVC5wcmljZUxpc3Rbc2VsZWN0SW5kZXhdLnZhbHVlO1xuICAgICAgc2VsZWN0VmFsdWUgPSBIVC5wcmljZUxpc3Rbc2VsZWN0SW5kZXhdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXJyZW50UHJpY2UgPSBCSi5wcmljZUxpc3Rbc2VsZWN0SW5kZXhdLnZhbHVlO1xuICAgICAgQkoucHJpY2VMaXN0ID0gcHJpY2VMaXN0O1xuICAgICAgc2VsZWN0VmFsdWUgPSBCSi5wcmljZUxpc3Rbc2VsZWN0SW5kZXhdO1xuICAgIH1cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIEJKLFxuICAgICAgSFQsXG4gICAgICBjdXJyZW50UHJpY2UsXG4gICAgICBzZWxlY3RWYWx1ZToge1xuICAgICAgICAuLi5zZWxlY3RWYWx1ZSxcbiAgICAgICAgdmlwVHlwZTogY3VycmVudFJpZ2h0ID09PSAwID8gXCJicm9uemVcIiA6IFwicGxhdGludW1cIixcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEuSFQucHJpY2VMaXN0KTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEuQkoucHJpY2VMaXN0KTtcbiAgICBjb25zb2xlLmxvZyhgdmlwQ2VudGVyIHNlbGVjdFZhbHVlOmAsIHNlbGVjdFZhbHVlKTtcbiAgfSxcblxuICBmb3JtYXRWaXBFeHBpcmVkQXREYXRlOiBmdW5jdGlvbiAoZGF0ZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coXCItLS0tLWNvbWUgaW4gLS0tLS0tLVwiKTtcbiAgICByZXR1cm4gZm9ybWF0SExTVGltZShkYXRlKTtcbiAgfSxcblxuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7fSxcblxuICBvblNob3c6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge30sXG5cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7fSxcblxuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7fSxcbn0pO1xuIl19
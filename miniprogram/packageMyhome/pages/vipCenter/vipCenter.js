"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vipService_1 = require("./config/vipService");
const utils_1 = require("./config/utils");
const utils_2 = require("../../../utils/utils");
const api_service_1 = require("../../../service/api.service");
Page({
    data: {
        BJ: vipService_1.BAIJIN,
        HT: vipService_1.HUANGTONG,
        rightList: vipService_1.RIGHTLIST,
        swiper: {
            indicatorDots: true,
            vertical: false,
            autoplay: false,
            interval: 2000,
            duration: 500,
        },
        selectValue: {},
        payBarStatus: {
            isShow: true,
            content: "立即支付",
        },
        userInfo: {},
        currentRight: 0,
        currentPrice: 0,
        upgradeFlag: false,
        tipFlag: false,
        upgradeInfo: {},
    },
    onLoad: function (option) {
        const type = option.type;
        console.log(`vipCenter type:`, type);
        this.adjustVipType(type);
        const user = wx.getStorageSync("userInfo");
        console.log("userInfo", user);
        this.setData({
            userInfo: Object.assign({}, user, { vipExpireAt: utils_2.formatHLSTime(user.vipExpireAt) }),
        });
        api_service_1.getVipInfo().then((res) => {
            const priceList = utils_1.dealWithVipPriceInfo(res.data);
            const vipRightInfo = utils_1.dealWithVipRightList(res.data);
            console.log(priceList);
            this.setData({
                BJ: priceList.BAIJIN,
                HT: priceList.HUANGTONG,
                rightList: vipRightInfo,
            });
            console.log(`=====vipRightInfo=====`, vipRightInfo);
        });
        if (user.vipType && user.vipType !== "platinum") {
            let _this = this;
            api_service_1.vipListInfo().then((res) => {
                if (res.code === 200) {
                    this.setData({
                        upgradeInfo: res.data.upgradeInfo,
                    });
                    _this.checkStatus(this.data.currentRight);
                }
            });
        }
        else {
            this.checkStatus(this.data.currentRight);
        }
        console.log('this.data.currentRight', this.data.currentRight);
    },
    adjustVipType(type) {
        if (type === "1") {
            this.setData({
                currentRight: 0
            });
        }
        else if (type === "2") {
            this.setData({
                currentRight: 1
            });
        }
        else if (type === "3") {
            this.setData({
                currentRight: 1
            });
        }
    },
    getVipInfo() { },
    goRecharge() {
        let payInfo = Object.assign({}, this.data.selectValue, { currentPrice: this.data.currentPrice });
        payInfo = JSON.stringify(payInfo);
        if (this.data.currentPrice === 0) {
            wx.showToast({
                title: "请选择会员充值方式",
                icon: "none",
                duration: 2000,
            });
            return;
        }
        wx.navigateTo({
            url: `../../../packageMyhome/pages/choosePay/choosePay?payInfo=${payInfo}`,
        });
    },
    swiperChange(e) {
        console.log(e.detail.current);
        this.checkStatus(e.detail.current);
    },
    checkStatus(currentRight) {
        const { userInfo } = this.data;
        this.data.HT.priceList.forEach((el) => {
            el.select = false;
        });
        this.data.BJ.priceList.forEach((el) => {
            el.select = false;
        });
        if (userInfo.vipType === "platinum" && currentRight === 0) {
            this.setData({
                payBarStatus: {
                    isShow: false,
                },
                currentPrice: 0,
                tipFlag: true,
                selectValue: {},
                HT: this.data.HT,
                BJ: this.data.BJ,
                upgradeFlag: false,
                currentRight: currentRight,
            });
            return;
        }
        else if ((userInfo.vipType === "platinum" && currentRight === 1) ||
            (userInfo.vipType === "bronze" && currentRight === 0)) {
            this.setData({
                payBarStatus: {
                    isShow: true,
                    content: "立即续费",
                },
                tipFlag: false,
                selectValue: {},
                currentPrice: 0,
                HT: this.data.HT,
                BJ: this.data.BJ,
                upgradeFlag: false,
                currentRight: currentRight,
            });
        }
        else if (userInfo.vipType === "bronze" && currentRight === 1) {
            this.setData({
                payBarStatus: {
                    isShow: true,
                    content: "立即升级",
                },
                currentPrice: this.data.upgradeInfo.totalPrice,
                upgradeFlag: true,
                HT: this.data.HT,
                BJ: this.data.BJ,
                selectValue: {},
                tipFlag: false,
                currentRight: currentRight,
            });
        }
    },
    selectPrice(e) {
        const { selectIndex, currentRight } = e.currentTarget.dataset;
        console.log(e.currentTarget.dataset);
        const { BJ, HT } = this.data;
        let currentPrice = 0;
        let selectValue = {};
        const priceList = currentRight === 0 ? HT.priceList : BJ.priceList;
        priceList.forEach((item, index) => {
            if (index === selectIndex) {
                item.select = true;
            }
            else {
                item.select = false;
            }
        });
        if (currentRight === 0) {
            HT.priceList = priceList;
            currentPrice = HT.priceList[selectIndex].value;
            selectValue = HT.priceList[selectIndex];
        }
        else {
            currentPrice = BJ.priceList[selectIndex].value;
            BJ.priceList = priceList;
            selectValue = BJ.priceList[selectIndex];
        }
        this.setData({
            BJ,
            HT,
            currentPrice,
            selectValue: Object.assign({}, selectValue, { vipType: currentRight === 0 ? "bronze" : "platinum" }),
        });
        console.log(this.data.HT.priceList);
        console.log(this.data.BJ.priceList);
        console.log(`vipCenter selectValue:`, selectValue);
    },
    formatVipExpiredAtDate: function (date) {
        console.log("-----come in -------");
        return utils_2.formatHLSTime(date);
    },
    onReady: function () { },
    onShow: function () { },
    onHide: function () { },
    onUnload: function () { },
    onPullDownRefresh: function () { },
    onReachBottom: function () { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlwQ2VudGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmlwQ2VudGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQW1FO0FBQ25FLDBDQUE0RTtBQUM1RSxnREFBcUQ7QUFDckQsOERBQXVFO0FBRXZFLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLEVBQUUsRUFBRSxtQkFBTTtRQUNWLEVBQUUsRUFBRSxzQkFBUztRQUNiLFNBQVMsRUFBRSxzQkFBUztRQUNwQixNQUFNLEVBQUU7WUFDTixhQUFhLEVBQUUsSUFBSTtZQUNuQixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLElBQUk7WUFDZCxRQUFRLEVBQUUsR0FBRztTQUNkO1FBQ0QsV0FBVyxFQUFFLEVBQVM7UUFDdEIsWUFBWSxFQUFFO1lBQ1osTUFBTSxFQUFFLElBQUk7WUFDWixPQUFPLEVBQUUsTUFBTTtTQUNoQjtRQUNELFFBQVEsRUFBRSxFQUFTO1FBQ25CLFlBQVksRUFBRSxDQUFDO1FBQ2YsWUFBWSxFQUFFLENBQUM7UUFDZixXQUFXLEVBQUUsS0FBSztRQUNsQixPQUFPLEVBQUUsS0FBSztRQUNkLFdBQVcsRUFBRSxFQUFTO0tBQ3ZCO0lBQ0QsTUFBTSxFQUFFLFVBQVUsTUFBVztRQUMzQixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV6QixNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixRQUFRLG9CQUNILElBQUksSUFDUCxX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QUM7UUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsc0JBQXNCLEVBQUUsVUFBVSxJQUFTO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNwQyxPQUFPLHFCQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELE9BQU8sRUFBRSxjQUFhLENBQUM7SUFFdkIsTUFBTSxFQUFFLGNBQWEsQ0FBQztJQUV0QixNQUFNLEVBQUUsY0FBYSxDQUFDO0lBRXRCLFFBQVEsRUFBRSxjQUFhLENBQUM7SUFFeEIsaUJBQWlCLEVBQUUsY0FBYSxDQUFDO0lBRWpDLGFBQWEsRUFBRSxjQUFhLENBQUM7Q0FDOUIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQkFJSklOLCBIVUFOR1RPTkcsIFJJR0hUTElTVCB9IGZyb20gXCIuL2NvbmZpZy92aXBTZXJ2aWNlXCI7XG5pbXBvcnQgeyBkZWFsV2l0aFZpcFByaWNlSW5mbywgZGVhbFdpdGhWaXBSaWdodExpc3QgfSBmcm9tIFwiLi9jb25maWcvdXRpbHNcIjtcbmltcG9ydCB7IGZvcm1hdEhMU1RpbWUgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvdXRpbHNcIjtcbmltcG9ydCB7IGdldFZpcEluZm8sIHZpcExpc3RJbmZvIH0gZnJvbSBcIi4uLy4uLy4uL3NlcnZpY2UvYXBpLnNlcnZpY2VcIjtcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBCSjogQkFJSklOLFxuICAgIEhUOiBIVUFOR1RPTkcsXG4gICAgcmlnaHRMaXN0OiBSSUdIVExJU1QsXG4gICAgc3dpcGVyOiB7XG4gICAgICBpbmRpY2F0b3JEb3RzOiB0cnVlLFxuICAgICAgdmVydGljYWw6IGZhbHNlLFxuICAgICAgYXV0b3BsYXk6IGZhbHNlLFxuICAgICAgaW50ZXJ2YWw6IDIwMDAsXG4gICAgICBkdXJhdGlvbjogNTAwLFxuICAgIH0sXG4gICAgc2VsZWN0VmFsdWU6IHt9IGFzIGFueSxcbiAgICBwYXlCYXJTdGF0dXM6IHtcbiAgICAgIGlzU2hvdzogdHJ1ZSxcbiAgICAgIGNvbnRlbnQ6IFwi56uL5Y2z5pSv5LuYXCIsXG4gICAgfSxcbiAgICB1c2VySW5mbzoge30gYXMgYW55LFxuICAgIGN1cnJlbnRSaWdodDogMCwgLy8gMC1odWFuZ3RvbmcgMS1iYWlqaW5cbiAgICBjdXJyZW50UHJpY2U6IDAsXG4gICAgdXBncmFkZUZsYWc6IGZhbHNlLFxuICAgIHRpcEZsYWc6IGZhbHNlLFxuICAgIHVwZ3JhZGVJbmZvOiB7fSBhcyBhbnksXG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbjogYW55KSB7XG4gICAgY29uc3QgdHlwZSA9IG9wdGlvbi50eXBlO1xuICAgIGNvbnNvbGUubG9nKGB2aXBDZW50ZXIgdHlwZTpgLCB0eXBlKTtcbiAgICB0aGlzLmFkanVzdFZpcFR5cGUodHlwZSk7XG4gICAgLy8g6I635Y+W55So5oi35L+h5oGvXG4gICAgY29uc3QgdXNlciA9IHd4LmdldFN0b3JhZ2VTeW5jKFwidXNlckluZm9cIik7XG4gICAgY29uc29sZS5sb2coXCJ1c2VySW5mb1wiLCB1c2VyKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHVzZXJJbmZvOiB7XG4gICAgICAgIC4uLnVzZXIsXG4gICAgICAgIHZpcEV4cGlyZUF0OiBmb3JtYXRITFNUaW1lKHVzZXIudmlwRXhwaXJlQXQpLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIOiOt+WPlnZpcOadg+ebilxuICAgIGdldFZpcEluZm8oKS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgY29uc3QgcHJpY2VMaXN0ID0gZGVhbFdpdGhWaXBQcmljZUluZm8ocmVzLmRhdGEpO1xuICAgICAgY29uc3QgdmlwUmlnaHRJbmZvID0gZGVhbFdpdGhWaXBSaWdodExpc3QocmVzLmRhdGEpO1xuICAgICAgY29uc29sZS5sb2cocHJpY2VMaXN0KTtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBCSjogcHJpY2VMaXN0LkJBSUpJTixcbiAgICAgICAgSFQ6IHByaWNlTGlzdC5IVUFOR1RPTkcsXG4gICAgICAgIHJpZ2h0TGlzdDogdmlwUmlnaHRJbmZvLFxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhgPT09PT12aXBSaWdodEluZm89PT09PWAsIHZpcFJpZ2h0SW5mbyk7XG4gICAgfSk7XG5cbiAgICAvLyDojrflj5Z2aXDnmoTmm7TmlrDkv6Hmga9cbiAgICBpZiAodXNlci52aXBUeXBlICYmIHVzZXIudmlwVHlwZSAhPT0gXCJwbGF0aW51bVwiKSB7XG4gICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgICAgdmlwTGlzdEluZm8oKS50aGVuKChyZXM6IGFueSkgPT4ge1xuICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgdXBncmFkZUluZm86IHJlcy5kYXRhLnVwZ3JhZGVJbmZvLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIF90aGlzLmNoZWNrU3RhdHVzKHRoaXMuZGF0YS5jdXJyZW50UmlnaHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuY2hlY2tTdGF0dXModGhpcy5kYXRhLmN1cnJlbnRSaWdodCk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCd0aGlzLmRhdGEuY3VycmVudFJpZ2h0JywgdGhpcy5kYXRhLmN1cnJlbnRSaWdodClcbiAgICBcbiAgfSxcblxuICBhZGp1c3RWaXBUeXBlKHR5cGU6IHN0cmluZykge1xuICAgIGlmICh0eXBlID09PSBcIjFcIikge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIGN1cnJlbnRSaWdodDogMFxuICAgICAgfSlcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiMlwiKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgY3VycmVudFJpZ2h0OiAxXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCIzXCIpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBjdXJyZW50UmlnaHQ6IDFcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIGdldFZpcEluZm8oKTogYW55IHt9LFxuXG4gIC8qKiDlhYXlgLwgKi9cbiAgZ29SZWNoYXJnZSgpOiBhbnkge1xuICAgIGxldCBwYXlJbmZvOiBhbnkgPSB7XG4gICAgICAuLi50aGlzLmRhdGEuc2VsZWN0VmFsdWUsXG4gICAgICBjdXJyZW50UHJpY2U6IHRoaXMuZGF0YS5jdXJyZW50UHJpY2UsXG4gICAgfTtcbiAgICBwYXlJbmZvID0gSlNPTi5zdHJpbmdpZnkocGF5SW5mbyk7XG4gICAgaWYgKHRoaXMuZGF0YS5jdXJyZW50UHJpY2UgPT09IDApIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiBcIuivt+mAieaLqeS8muWRmOWFheWAvOaWueW8j1wiLFxuICAgICAgICBpY29uOiBcIm5vbmVcIixcbiAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi8uLi8uLi9wYWNrYWdlTXlob21lL3BhZ2VzL2Nob29zZVBheS9jaG9vc2VQYXk/cGF5SW5mbz0ke3BheUluZm99YCxcbiAgICB9KTtcbiAgfSxcblxuICBzd2lwZXJDaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coZS5kZXRhaWwuY3VycmVudCk7XG4gICAgdGhpcy5jaGVja1N0YXR1cyhlLmRldGFpbC5jdXJyZW50KTtcbiAgfSxcblxuICBjaGVja1N0YXR1cyhjdXJyZW50UmlnaHQ6IGFueSkge1xuICAgIGNvbnN0IHsgdXNlckluZm8gfSA9IHRoaXMuZGF0YTtcbiAgICB0aGlzLmRhdGEuSFQucHJpY2VMaXN0LmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBlbC5zZWxlY3QgPSBmYWxzZTtcbiAgICB9KTtcbiAgICB0aGlzLmRhdGEuQkoucHJpY2VMaXN0LmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBlbC5zZWxlY3QgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBpZiAodXNlckluZm8udmlwVHlwZSA9PT0gXCJwbGF0aW51bVwiICYmIGN1cnJlbnRSaWdodCA9PT0gMCkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBheUJhclN0YXR1czoge1xuICAgICAgICAgIGlzU2hvdzogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIGN1cnJlbnRQcmljZTogMCxcbiAgICAgICAgdGlwRmxhZzogdHJ1ZSxcbiAgICAgICAgc2VsZWN0VmFsdWU6IHt9LFxuICAgICAgICBIVDogdGhpcy5kYXRhLkhULFxuICAgICAgICBCSjogdGhpcy5kYXRhLkJKLFxuICAgICAgICB1cGdyYWRlRmxhZzogZmFsc2UsXG4gICAgICAgIGN1cnJlbnRSaWdodDogY3VycmVudFJpZ2h0LFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChcbiAgICAgICh1c2VySW5mby52aXBUeXBlID09PSBcInBsYXRpbnVtXCIgJiYgY3VycmVudFJpZ2h0ID09PSAxKSB8fFxuICAgICAgKHVzZXJJbmZvLnZpcFR5cGUgPT09IFwiYnJvbnplXCIgJiYgY3VycmVudFJpZ2h0ID09PSAwKVxuICAgICkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBheUJhclN0YXR1czoge1xuICAgICAgICAgIGlzU2hvdzogdHJ1ZSxcbiAgICAgICAgICBjb250ZW50OiBcIueri+WNs+e7rei0uVwiLFxuICAgICAgICB9LFxuICAgICAgICB0aXBGbGFnOiBmYWxzZSxcbiAgICAgICAgc2VsZWN0VmFsdWU6IHt9LFxuICAgICAgICBjdXJyZW50UHJpY2U6IDAsXG4gICAgICAgIEhUOiB0aGlzLmRhdGEuSFQsXG4gICAgICAgIEJKOiB0aGlzLmRhdGEuQkosXG4gICAgICAgIHVwZ3JhZGVGbGFnOiBmYWxzZSxcbiAgICAgICAgY3VycmVudFJpZ2h0OiBjdXJyZW50UmlnaHQsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHVzZXJJbmZvLnZpcFR5cGUgPT09IFwiYnJvbnplXCIgJiYgY3VycmVudFJpZ2h0ID09PSAxKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcGF5QmFyU3RhdHVzOiB7XG4gICAgICAgICAgaXNTaG93OiB0cnVlLFxuICAgICAgICAgIGNvbnRlbnQ6IFwi56uL5Y2z5Y2H57qnXCIsXG4gICAgICAgIH0sXG4gICAgICAgIGN1cnJlbnRQcmljZTogdGhpcy5kYXRhLnVwZ3JhZGVJbmZvLnRvdGFsUHJpY2UsXG4gICAgICAgIHVwZ3JhZGVGbGFnOiB0cnVlLFxuICAgICAgICBIVDogdGhpcy5kYXRhLkhULFxuICAgICAgICBCSjogdGhpcy5kYXRhLkJKLFxuICAgICAgICBzZWxlY3RWYWx1ZToge30sXG4gICAgICAgIHRpcEZsYWc6IGZhbHNlLFxuICAgICAgICBjdXJyZW50UmlnaHQ6IGN1cnJlbnRSaWdodCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBzZWxlY3RQcmljZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IHNlbGVjdEluZGV4LCBjdXJyZW50UmlnaHQgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0O1xuICAgIGNvbnNvbGUubG9nKGUuY3VycmVudFRhcmdldC5kYXRhc2V0KTtcbiAgICBjb25zdCB7IEJKLCBIVCB9ID0gdGhpcy5kYXRhO1xuICAgIGxldCBjdXJyZW50UHJpY2UgPSAwO1xuICAgIGxldCBzZWxlY3RWYWx1ZTogYW55ID0ge307XG5cbiAgICBjb25zdCBwcmljZUxpc3QgPSBjdXJyZW50UmlnaHQgPT09IDAgPyBIVC5wcmljZUxpc3QgOiBCSi5wcmljZUxpc3Q7XG4gICAgcHJpY2VMaXN0LmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPT09IHNlbGVjdEluZGV4KSB7XG4gICAgICAgIGl0ZW0uc2VsZWN0ID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW0uc2VsZWN0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGN1cnJlbnRSaWdodCA9PT0gMCkge1xuICAgICAgSFQucHJpY2VMaXN0ID0gcHJpY2VMaXN0O1xuICAgICAgY3VycmVudFByaWNlID0gSFQucHJpY2VMaXN0W3NlbGVjdEluZGV4XS52YWx1ZTtcbiAgICAgIHNlbGVjdFZhbHVlID0gSFQucHJpY2VMaXN0W3NlbGVjdEluZGV4XTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmVudFByaWNlID0gQkoucHJpY2VMaXN0W3NlbGVjdEluZGV4XS52YWx1ZTtcbiAgICAgIEJKLnByaWNlTGlzdCA9IHByaWNlTGlzdDtcbiAgICAgIHNlbGVjdFZhbHVlID0gQkoucHJpY2VMaXN0W3NlbGVjdEluZGV4XTtcbiAgICB9XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBCSixcbiAgICAgIEhULFxuICAgICAgY3VycmVudFByaWNlLFxuICAgICAgc2VsZWN0VmFsdWU6IHtcbiAgICAgICAgLi4uc2VsZWN0VmFsdWUsXG4gICAgICAgIHZpcFR5cGU6IGN1cnJlbnRSaWdodCA9PT0gMCA/IFwiYnJvbnplXCIgOiBcInBsYXRpbnVtXCIsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2codGhpcy5kYXRhLkhULnByaWNlTGlzdCk7XG4gICAgY29uc29sZS5sb2codGhpcy5kYXRhLkJKLnByaWNlTGlzdCk7XG4gICAgY29uc29sZS5sb2coYHZpcENlbnRlciBzZWxlY3RWYWx1ZTpgLCBzZWxlY3RWYWx1ZSk7XG4gIH0sXG5cbiAgZm9ybWF0VmlwRXhwaXJlZEF0RGF0ZTogZnVuY3Rpb24gKGRhdGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKFwiLS0tLS1jb21lIGluIC0tLS0tLS1cIik7XG4gICAgcmV0dXJuIGZvcm1hdEhMU1RpbWUoZGF0ZSk7XG4gIH0sXG5cbiAgb25SZWFkeTogZnVuY3Rpb24gKCkge30sXG5cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7fSxcblxuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIG9uVW5sb2FkOiBmdW5jdGlvbiAoKSB7fSxcblxuICBvblB1bGxEb3duUmVmcmVzaDogZnVuY3Rpb24gKCkge30sXG5cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge30sXG59KTtcbiJdfQ==
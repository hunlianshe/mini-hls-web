"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const socket_service2_1 = require("../../service/socket.service2");
const utils_1 = require("../../utils/utils");
const Api = require("../../service/api.service");
Page({
    data: {
        openid: '',
        cid: '',
        me: {},
        host: '',
        toUser: {},
        userInfo: {},
        message: '',
        pagination: { pageSize: 50, pageToken: '' },
        messageList: [],
    },
    onLoad: function (options) {
        console.log("okkkk");
        let openid = options.openid;
        let cid = options.cid;
        this.setData({
            cid: cid
        });
        console.log("openid", openid);
        console.log("cid", cid);
        const user = wx.getStorageSync('user');
        console.log("user", user);
        this.setData({
            me: user
        });
        this.getToUserInfo(openid);
        this.getMessageList();
        this.receiveMessage();
    },
    getOpenid() {
        let openid = '';
        const user = wx.getStorageSync('user');
        openid = user.openid || '';
        return openid;
    },
    receiveMessage() {
        console.log("准备接收消息");
        let socket = socket_service2_1.getSocket();
        socket.on("privateChat", (msg) => {
            console.log("接收到的消息是", msg);
        });
    },
    getToUserInfo(openid) {
        Api.getUserInfo(openid).then((result) => {
            if (result) {
                const userInfo = result.data;
                console.log('userInfo:', userInfo);
                this.setData({
                    toUser: userInfo
                });
            }
            else {
                throw new Error("获取用户信息失败");
            }
        });
    },
    sendTap() {
        socket_service2_1.sendMessage({ cid: this.data.cid, msg: this.data.message, type: 1 });
        console.log('send message:', this.data.message);
    },
    inputTap(e) {
        console.log('input message:', e);
        this.setData({
            message: e.detail.detail.value
        });
    },
    uploadImage(e) {
        console.log('upload image:', e.detail);
        socket_service2_1.sendMessage({ cid: this.data.cid, msg: e.detail, type: 2 });
    },
    getMessageList() {
        Api.getMessageByCid(this.data.cid, this.data.pagination.pageSize, this.data.pagination.pageToken).then((result) => {
            console.log("result.data", result.data);
            this.setData({
                pagination: {
                    pageToken: result.data.pageToken
                }
            });
            let messageList = result.data.result;
            const dateAry = [];
            messageList.map((item) => {
                const date = utils_1.getDate(item.createdAt);
                if (dateAry.indexOf(date) == -1) {
                    item.date = date;
                    dateAry.push(date);
                }
                else {
                    item.date = '';
                }
                item.time = utils_1.getTime(item.createdAt);
                return item;
            });
            this.setData({
                messageList,
            });
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNoYXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtRUFBc0U7QUFDdEUsNkNBQXFEO0FBQ3JELGlEQUFpRDtBQUVqRCxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixNQUFNLEVBQUUsRUFBRTtRQUNWLEdBQUcsRUFBRSxFQUFFO1FBQ1AsRUFBRSxFQUFFLEVBQUU7UUFDTixJQUFJLEVBQUUsRUFBRTtRQUNSLE1BQU0sRUFBRSxFQUFFO1FBQ1YsUUFBUSxFQUFFLEVBQUU7UUFDWixPQUFPLEVBQUUsRUFBRTtRQUNYLFVBQVUsRUFBRSxFQUFDLFFBQVEsRUFBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBQztRQUMxQyxXQUFXLEVBQUUsRUFBRTtLQUNoQjtJQUVELE1BQU0sRUFBRSxVQUFVLE9BQVc7UUFFM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNwQixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQzVCLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFDdEIsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLEdBQUcsRUFBRSxHQUFHO1NBQ1QsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUMsTUFBTSxDQUFDLENBQUE7UUFDNUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUMsR0FBRyxDQUFDLENBQUE7UUFFdEIsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBQyxJQUFJLENBQUMsQ0FBQTtRQUd4QixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osRUFBRSxFQUFFLElBQUk7U0FDVCxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FB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SUFBSyxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUE7WUFDcEMsTUFBTSxPQUFPLEdBQVUsRUFBRSxDQUFDO1lBQzFCLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtnQkFDNUIsTUFBTSxJQUFJLEdBQUcsZUFBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDckMsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO29CQUMvQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztvQkFDakIsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDcEI7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7aUJBQ2hCO2dCQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsZUFBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDcEMsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxPQUFRLENBQUM7Z0JBQ1osV0FBVzthQUNaLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFBO0lBRUosQ0FBQztJQUtELE9BQU8sRUFBRTtJQUVULENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsTUFBTSxFQUFFO0lBRVIsQ0FBQztJQUtELFFBQVEsRUFBRTtJQUVWLENBQUM7SUFLRCxpQkFBaUIsRUFBRTtJQUVuQixDQUFDO0lBS0QsYUFBYSxFQUFFO0lBRWYsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Z2V0U29ja2V0LCBzZW5kTWVzc2FnZSB9IGZyb20gJy4uLy4uL3NlcnZpY2Uvc29ja2V0LnNlcnZpY2UyJztcbmltcG9ydCB7IGdldERhdGUsIGdldFRpbWUgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XG5pbXBvcnQgKiBhcyBBcGkgZnJvbSAnLi4vLi4vc2VydmljZS9hcGkuc2VydmljZSc7XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgb3BlbmlkOiAnJyxcbiAgICBjaWQ6ICcnLFxuICAgIG1lOiB7fSwgLy/miJHnmoTnlKjmiLfkv6Hmga9cbiAgICBob3N0OiAnJywgLy/miJHnmoTnlKjmiLfkv6Hmga9cbiAgICB0b1VzZXI6IHt9LCAvL+aOpeaUtuS6uueahOeUqOaIt+S/oeaBr1xuICAgIHVzZXJJbmZvOiB7fSwgLy8g55So5oi35L+h5oGvXG4gICAgbWVzc2FnZTogJycsICAvLyDnlKjmiLfovpPlhaXnmoTmtojmga9cbiAgICBwYWdpbmF0aW9uOiB7cGFnZVNpemUgOiA1MCwgcGFnZVRva2VuOiAnJ30sXG4gICAgbWVzc2FnZUxpc3Q6IFtdLFxuICB9LFxuXG4gIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnM6YW55KSB7XG4gICAgLy8gdGhpcy5nZXRVc2VySW5mbygpO1xuICAgIGNvbnNvbGUubG9nKFwib2tra2tcIilcbiAgICBsZXQgb3BlbmlkID0gb3B0aW9ucy5vcGVuaWQ7XG4gICAgbGV0IGNpZCA9IG9wdGlvbnMuY2lkO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgY2lkOiBjaWRcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhcIm9wZW5pZFwiLG9wZW5pZClcbiAgICBjb25zb2xlLmxvZyhcImNpZFwiLGNpZClcblxuICAgIGNvbnN0IHVzZXIgPSB3eC5nZXRTdG9yYWdlU3luYygndXNlcicpO1xuICAgIGNvbnNvbGUubG9nKFwidXNlclwiLHVzZXIpXG4gICAgLy8gb3BlbmlkID0gdXNlci5vcGVuaWQgfHwgJyc7XG4gICAgLy8gcmV0dXJuIG9wZW5pZDtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIG1lOiB1c2VyXG4gICAgfSk7XG5cbiAgICB0aGlzLmdldFRvVXNlckluZm8ob3BlbmlkKTtcbiAgICB0aGlzLmdldE1lc3NhZ2VMaXN0KCk7XG4gICAgdGhpcy5yZWNlaXZlTWVzc2FnZSgpO1xuICBcbiAgfSxcblxuICBnZXRPcGVuaWQoKSB7XG4gICAgbGV0IG9wZW5pZDogc3RyaW5nID0gJyc7XG4gICAgY29uc3QgdXNlciA9IHd4LmdldFN0b3JhZ2VTeW5jKCd1c2VyJyk7XG4gICAgb3BlbmlkID0gdXNlci5vcGVuaWQgfHwgJyc7XG4gICAgcmV0dXJuIG9wZW5pZDtcbiAgfSxcblxuXG5cbiAgcmVjZWl2ZU1lc3NhZ2UoKSB7XG4gICAgY29uc29sZS5sb2coXCLlh4blpIfmjqXmlLbmtojmga9cIilcbiAgIGxldCBzb2NrZXQgPSBnZXRTb2NrZXQoKVxuICAgc29ja2V0Lm9uKFwicHJpdmF0ZUNoYXRcIiwgKG1zZzphbnkpID0+IHtcbiAgICAgY29uc29sZS5sb2coXCLmjqXmlLbliLDnmoTmtojmga/mmK9cIixtc2cpXG4gICB9KVxuXG4gIH0sXG5cbiAgZ2V0VG9Vc2VySW5mbyhvcGVuaWQ6IHN0cmluZykge1xuICAgIEFwaS5nZXRVc2VySW5mbyhvcGVuaWQpLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IHVzZXJJbmZvID0gcmVzdWx0LmRhdGE7XG4gICAgICAgIGNvbnNvbGUubG9nKCd1c2VySW5mbzonLCB1c2VySW5mbylcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgdG9Vc2VyOiB1c2VySW5mb1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIuiOt+WPlueUqOaIt+S/oeaBr+Wksei0pVwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICAvKiog5Y+R6YCB5raI5oGv5LqL5Lu2ICovXG4gIHNlbmRUYXAoKSB7XG4gICAgLy8gVE9ET1xuICAgIC8vIHRvIGRvXG4gICAgc2VuZE1lc3NhZ2Uoe2NpZDogdGhpcy5kYXRhLmNpZCwgbXNnOiB0aGlzLmRhdGEubWVzc2FnZSwgdHlwZTogMX0pXG4gICAgY29uc29sZS5sb2coJ3NlbmQgbWVzc2FnZTonLCB0aGlzLmRhdGEubWVzc2FnZSk7XG4gIH0sXG5cbiAgLyoqIOi+k+WFpea2iOaBr+WGheWuuSAqL1xuICBpbnB1dFRhcChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygnaW5wdXQgbWVzc2FnZTonLCBlKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIG1lc3NhZ2U6IGUuZGV0YWlsLmRldGFpbC52YWx1ZSAvLyDojrflj5bovpPlhaXnmoTlgLxcbiAgICB9KVxuICB9LFxuXG4gICAvKiog6L6T5YWl5raI5oGv5YaF5a65ICovXG4gICB1cGxvYWRJbWFnZShlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygndXBsb2FkIGltYWdlOicsIGUuZGV0YWlsKTtcbiAgICBzZW5kTWVzc2FnZSh7Y2lkOiB0aGlzLmRhdGEuY2lkLCBtc2c6IGUuZGV0YWlsLCB0eXBlOiAyfSlcblxuICAgIC8vIHRoaXMuc2V0RGF0YSEoe1xuICAgIC8vICAgbWVzc2FnZTogZS5kZXRhaWwuZGV0YWlsLnZhbHVlIC8vIOiOt+WPlui+k+WFpeeahOWAvFxuICAgIC8vIH0pXG4gIH0sXG5cblxuICBnZXRNZXNzYWdlTGlzdCgpIHtcbiAgICAvLyBjb25zdCBtZXNzYWdlTGlzdDogYW55ID0gW1xuICAgIC8vICAge1xuICAgIC8vICAgICBcIl9pZFwiOiBcIjVmNjZlMmY4MjczNTI0OGMzMWI5N2JkOFwiLFxuICAgIC8vICAgICBcInR5cGVcIjogMSxcbiAgICAvLyAgICAgXCJjaWRcIjogXCI1ZjY2ZTAyNWJiOTczNTA5NDljNTJhOTdcIixcbiAgICAvLyAgICAgXCJtc2dcIjogXCJoZWxsbyBsaXNhXCIsXG4gICAgLy8gICAgIFwic3RhdHVzXCI6IFtcbiAgICAvLyAgICAgICB7XG4gICAgLy8gICAgICAgICBcIm1zZ1VuUmVhZFwiOiBmYWxzZSxcbiAgICAvLyAgICAgICAgIFwiX2lkXCI6IFwiNWY2NmUyZjgyNzM1MjQ4YzMxYjk3YmRhXCIsXG4gICAgLy8gICAgICAgICBcIm9wZW5pZFwiOiBcIm9IZ0I1NUxKMXdHbzJRcUVZeGdvOHRMTXhMNEFcIlxuICAgIC8vICAgICAgIH0sXG4gICAgLy8gICAgICAge1xuICAgIC8vICAgICAgICAgXCJtc2dVblJlYWRcIjogdHJ1ZSxcbiAgICAvLyAgICAgICAgIFwiX2lkXCI6IFwiNWY2NmUyZjgyNzM1MjQ4YzMxYjk3YmQ5XCIsXG4gICAgLy8gICAgICAgICBcIm9wZW5pZFwiOiBcIm9IZ0I1NUFsaEtxUjdhenI4NVlZQndmSUU5RVFcIlxuICAgIC8vICAgICAgIH1cbiAgICAvLyAgICAgXSxcbiAgICAvLyAgICAgXCJmcm9tXCI6IFwib0hnQjU1TEoxd0dvMlFxRVl4Z284dExNeEw0QVwiLFxuICAgIC8vICAgICBcInVwZGF0ZWRBdFwiOiBcIjIwMjAtMDktMjBUMDU6MDQ6NTYuNjg4WlwiLFxuICAgIC8vICAgICBcImNyZWF0ZWRBdFwiOiBcIjIwMjAtMDktMjBUMDU6MDQ6NTYuNjg4WlwiXG4gICAgLy8gICB9LFxuICAgIC8vICAge1xuICAgIC8vICAgICBcIl9pZFwiOiBcIjVmNjZlMmY4MjczNTI0OGMzMWI5N2JkOFwiLFxuICAgIC8vICAgICBcInR5cGVcIjogMSxcbiAgICAvLyAgICAgXCJjaWRcIjogXCI1ZjY2ZTAyNWJiOTczNTA5NDljNTJhOTdcIixcbiAgICAvLyAgICAgXCJtc2dcIjogXCLlkIPppa3kuoblkJdcIixcbiAgICAvLyAgICAgXCJzdGF0dXNcIjogW1xuICAgIC8vICAgICAgIHtcbiAgICAvLyAgICAgICAgIFwibXNnVW5SZWFkXCI6IGZhbHNlLFxuICAgIC8vICAgICAgICAgXCJfaWRcIjogXCI1ZjY2ZTJmODI3MzUyNDhjMzFiOTdiZGFcIixcbiAgICAvLyAgICAgICAgIFwib3BlbmlkXCI6IFwib0hnQjU1TEoxd0dvMlFxRVl4Z284dExNeEw0QVwiXG4gICAgLy8gICAgICAgfSxcbiAgICAvLyAgICAgICB7XG4gICAgLy8gICAgICAgICBcIm1zZ1VuUmVhZFwiOiB0cnVlLFxuICAgIC8vICAgICAgICAgXCJfaWRcIjogXCI1ZjY2ZTJmODI3MzUyNDhjMzFiOTdiZDlcIixcbiAgICAvLyAgICAgICAgIFwib3BlbmlkXCI6IFwib0hnQjU1QWxoS3FSN2F6cjg1WVlCd2ZJRTlFUVwiXG4gICAgLy8gICAgICAgfVxuICAgIC8vICAgICBdLFxuICAgIC8vICAgICBcImZyb21cIjogXCJvSGdCNTVBbGhLcVI3YXpyODVZWUJ3ZklFOUVRXCIsXG4gICAgLy8gICAgIFwidXBkYXRlZEF0XCI6IFwiMjAyMC0wOS0yMFQwNTowNDo1Ni42ODhaXCIsXG4gICAgLy8gICAgIFwiY3JlYXRlZEF0XCI6IFwiMjAyMC0wOS0yMFQwNTowNDo1Ni42ODhaXCJcbiAgICAvLyAgIH0sXG4gICAgLy8gXTtcbiAgICBBcGkuZ2V0TWVzc2FnZUJ5Q2lkKHRoaXMuZGF0YS5jaWQsIHRoaXMuZGF0YS5wYWdpbmF0aW9uLnBhZ2VTaXplLCB0aGlzLmRhdGEucGFnaW5hdGlvbi5wYWdlVG9rZW4pLnRoZW4oKHJlc3VsdDphbnkpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwicmVzdWx0LmRhdGFcIixyZXN1bHQuZGF0YSlcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgcGFnZVRva2VuOiByZXN1bHQuZGF0YS5wYWdlVG9rZW5cbiAgICAgICAgfS8vIOiOt+WPlui+k+WFpeeahOWAvFxuICAgICAgfSlcbiAgICAgbGV0ICBtZXNzYWdlTGlzdCA9IHJlc3VsdC5kYXRhLnJlc3VsdFxuICAgICAgY29uc3QgZGF0ZUFyeTogYW55W10gPSBbXTtcbiAgICAgIG1lc3NhZ2VMaXN0Lm1hcCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBnZXREYXRlKGl0ZW0uY3JlYXRlZEF0KTtcbiAgICAgICAgaWYgKGRhdGVBcnkuaW5kZXhPZihkYXRlKSA9PSAtMSkge1xuICAgICAgICAgIGl0ZW0uZGF0ZSA9IGRhdGU7XG4gICAgICAgICAgZGF0ZUFyeS5wdXNoKGRhdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW0uZGF0ZSA9ICcnO1xuICAgICAgICB9XG4gICAgICAgIGl0ZW0udGltZSA9IGdldFRpbWUoaXRlbS5jcmVhdGVkQXQpO1xuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIG1lc3NhZ2VMaXN0LFxuICAgICAgfSk7XG4gICAgfSlcbiAgXG4gIH0sXG4gIFxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcbiAgICovXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxuICAgKi9cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XG4gICAqL1xuICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouebuOWFs+S6i+S7tuWkhOeQhuWHveaVsC0t55uR5ZCs55So5oi35LiL5ouJ5Yqo5L2cXG4gICAqL1xuICBvblB1bGxEb3duUmVmcmVzaDogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG59KSJdfQ==
"use strict";
Page({
    data: {
        shopList: [],
        currShopList: [],
        dataAlready: false,
        currentCity: '',
        selectValue: '',
        currentQrcode: '',
        currentPhone: '',
        phone: '',
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
    },
    onLoad() {
    },
    goXzys() {
        wx.navigateTo({
            url: `../xzys/xzys`,
        });
    },
    goXlcsList() {
        wx.navigateTo({
            url: `../xlcsList/xlcsList`,
        });
    },
    doTest() {
        wx.navigateTo({
            url: `../xlcsDetail/xlcsDetail`,
        });
    },
    goMatch() {
        wx.navigateTo({
            url: `../matcheXz/matcheXz`,
        });
    },
    goCarDetail(e) {
        wx.navigateTo({
            url: `../carDetail/carDetail?id=${e.currentTarget.dataset.id}`,
        });
    },
    doSearch(e) {
        const keyword = e.detail.value;
        const params = {
            keyword,
            needLoading: '1',
        };
        this.getShopList(params);
        this.setData({
            keyword,
            pullDown: false,
            pullUp: false,
        });
    },
    getShopList(params) {
        const totalCount = this.data.totalCount;
        const pageSize = this.data.pageSize;
        let currentPage = this.data.currentPage;
        const pullDown = this.data.pullDown;
        const pullUp = this.data.pullUp;
        if (pullDown && !pullUp && currentPage > 1) {
            --currentPage;
        }
        else if (!pullDown && pullUp) {
            let totalSize = pageSize * (currentPage + 1);
            if (totalSize > totalCount && currentPage > 1) {
                console.log('total size:', pageSize * (currentPage + 1));
                return;
            }
            ++currentPage;
        }
        else {
            console.log('其他情况，视为重新加载');
            currentPage = 1;
        }
        let p = {
            city: this.data.currentCity,
            currentPage,
            limit: pageSize,
        };
        console.log('Object.assign(p, params): ', Object.assign(p, params));
    },
    popPicker() {
        let popHidden = this.data.popHidden;
        this.setData({
            popHidden: !popHidden,
        });
    },
    doSelect(e) {
        if (e.detail.name) {
            this.setData({
                popHidden: true,
                currentCity: e.detail.name,
                pullDown: false,
                pullUp: false,
                currentPage: 1,
            });
            let params = {
                city: e.detail.name,
                needLoading: '1',
            };
            this.getShopList(params);
            wx.setStorage({
                key: 'currentCity',
                data: e.detail.name,
            });
        }
        else {
            this.setData({
                popHidden: true,
            });
        }
    },
    popWechat(e) {
        const currentQrcode = e.currentTarget.dataset.qrcode;
        const currentPhone = e.currentTarget.dataset.phone;
        this.setData({
            currentQrcode,
            currentPhone,
            popWechat: true
        });
    },
    closeWechat() {
        this.setData({
            popWechat: false
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        this.setData({
            pullDown: true,
            pullUp: false
        });
        this.getShopList({ needLoading: '1' });
        wx.stopPullDownRefresh();
    },
    onReachBottom: function () {
        this.setData({
            pullDown: false,
            pullUp: true
        });
        this.getShopList({ needLoading: '1' });
    },
    onShareAppMessage: function (options) {
        console.log('onShareAppMessage options', options);
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhvbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVVBLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLFFBQVEsRUFBRSxFQUFFO1FBQ1osWUFBWSxFQUFFLEVBQUU7UUFDaEIsV0FBVyxFQUFFLEtBQUs7UUFDbEIsV0FBVyxFQUFFLEVBQUU7UUFDZixXQUFXLEVBQUUsRUFBRTtRQUNmLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLFlBQVksRUFBRSxFQUFFO1FBQ2hCLEtBQUssRUFBRSxFQUFFO1FBQ1QsU0FBUyxFQUFFLElBQUk7UUFDZixVQUFVLEVBQUUsS0FBSztRQUNqQixTQUFTLEVBQUUsS0FBSztRQUNoQixXQUFXLEVBQUUsQ0FBQztRQUNkLFFBQVEsRUFBRSxFQUFFO1FBQ1osVUFBVSxFQUFFLENBQUM7UUFDYixRQUFRLEVBQUUsS0FBSztRQUNmLE1BQU0sRUFBRSxLQUFLO0tBQ2Q7SUFFRCxNQUFNO0lBY04sQ0FBQztJQUlELE1BQU07UUFDSixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLGNBQWM7U0FDcEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELFVBQVU7UUFDUixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLHNCQUFzQjtTQUM1QixDQUFDLENBQUE7SUFDSixDQUFDO0lBR0QsTUFBTTtRQUNKLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsMEJBQTBCO1NBQ2hDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFHRCxPQUFPO1FBQ0wsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSxzQkFBc0I7U0FDNUIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELFdBQVcsQ0FBQyxDQUFNO1FBQ2hCLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsNkJBQTZCLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFD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RUFBRSxVQUFVLE9BQWlEO1FBQzVFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDbEQsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IHsgSU15QXBwIH0gZnJvbSAnLi4vLi4vYXBwJztcbi8vIGltcG9ydCAqIGFzIEFwaSBmcm9tICcuLi8uLi9zZXJ2aWNlL2FwaS5zZXJ2aWNlJztcbi8vIGNvbnN0IEFwaSA9IHJlcXVpcmUoJy4uLy4uL3NlcnZpY2UvYXBpL2FwaS1wcm9taXNpZnkuc2VydmljZScpO1xuLy8gY29uc3Qge1xuLy8gICBjaXR5UmVwbGFjZSxcbi8vICAgc2hvd01vZGFsLFxuLy8gfSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL3V0aWxzJyk7XG5cbi8vIGNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KCk7XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgc2hvcExpc3Q6IFtdLFxuICAgIGN1cnJTaG9wTGlzdDogW10sXG4gICAgZGF0YUFscmVhZHk6IGZhbHNlLFxuICAgIGN1cnJlbnRDaXR5OiAnJyxcbiAgICBzZWxlY3RWYWx1ZTogJycsXG4gICAgY3VycmVudFFyY29kZTogJycsXG4gICAgY3VycmVudFBob25lOiAnJyxcbiAgICBwaG9uZTogJycsXG4gICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgIHBhZ2VMb2FkZWQ6IGZhbHNlLFxuICAgIHBvcFdlY2hhdDogZmFsc2UsXG4gICAgY3VycmVudFBhZ2U6IDEsXG4gICAgcGFnZVNpemU6IDEwLFxuICAgIHRvdGFsQ291bnQ6IDAsXG4gICAgcHVsbERvd246IGZhbHNlLFxuICAgIHB1bGxVcDogZmFsc2UsXG4gIH0sXG5cbiAgb25Mb2FkICgpIHtcbiAgICAvLyBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIC8vIHd4LmdldFN0b3JhZ2Uoe1xuICAgIC8vICAga2V5OiAnY3VycmVudENpdHknLFxuICAgIC8vICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgLy8gICAgIF90aGlzLnNldERhdGEhKHtcbiAgICAvLyAgICAgICBjdXJyZW50Q2l0eTogcmVzLmRhdGEsXG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgfSxcbiAgICAvLyB9KTtcbiAgICAvLyB0aGlzLmdldFNob3BMaXN0KHtuZWVkTG9hZGluZzogJzEnfSk7XG4gICAgLy8gdGhpcy5zZXREYXRhISh7XG4gICAgLy8gICBwYWdlTG9hZGVkOiB0cnVlLFxuICAgIC8vIH0pXG4gIH0sXG4gIFxuICBcbiAgLyoqIOaYn+W6p+i/kOWKvyAqL1xuICBnb1h6eXMoKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi94enlzL3h6eXNgLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOW/g+eQhua1i+ivleWIl+ihqCAqL1xuICBnb1hsY3NMaXN0KCkge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiBgLi4veGxjc0xpc3QveGxjc0xpc3RgLFxuICAgIH0pXG4gIH0sXG4gIFxuICAvKiog5b+D55CG5rWL6K+VICovXG4gIGRvVGVzdCgpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uL3hsY3NEZXRhaWwveGxjc0RldGFpbGAsXG4gICAgfSlcbiAgfSxcblxuICAvKiog5pif5bqn5Yy56YWNICovXG4gIGdvTWF0Y2goKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi9tYXRjaGVYei9tYXRjaGVYemAsXG4gICAgfSlcbiAgfSxcblxuIC8qKiDmsb3ovabor6bmg4UgKi9cbiAgZ29DYXJEZXRhaWwoZTogYW55KSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi9jYXJEZXRhaWwvY2FyRGV0YWlsP2lkPSR7ZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWR9YCxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDpppbpobXmkJzntKIgKi9cbiAgZG9TZWFyY2goZTogYW55KSB7XG4gICAgY29uc3Qga2V5d29yZCA9IGUuZGV0YWlsLnZhbHVlOyBcbiAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICBrZXl3b3JkLFxuICAgICAgbmVlZExvYWRpbmc6ICcxJyxcbiAgICB9XG4gICAgdGhpcy5nZXRTaG9wTGlzdChwYXJhbXMpO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAga2V5d29yZCxcbiAgICAgIHB1bGxEb3duOiBmYWxzZSxcbiAgICAgIHB1bGxVcDogZmFsc2UsXG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog6I635Y+W5bqX6ZO65YiX6KGoIOWIhumhteWKoOi9vVxuICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIFxuICAgKi9cbiAgZ2V0U2hvcExpc3QocGFyYW1zOiBhbnkpIHtcbiAgICBjb25zdCB0b3RhbENvdW50ID0gdGhpcy5kYXRhLnRvdGFsQ291bnQ7XG4gICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLmRhdGEucGFnZVNpemU7XG4gICAgbGV0IGN1cnJlbnRQYWdlID0gdGhpcy5kYXRhLmN1cnJlbnRQYWdlO1xuICAgIC8vIGxldCBsYXN0UGFnZSA9IHRoaXMuZGF0YS5jdXJyZW50UGFnZTtcbiAgICBjb25zdCBwdWxsRG93biA9IHRoaXMuZGF0YS5wdWxsRG93bjtcbiAgICBjb25zdCBwdWxsVXAgPSB0aGlzLmRhdGEucHVsbFVwO1xuICAgIGlmIChwdWxsRG93biAmJiAhcHVsbFVwICYmIGN1cnJlbnRQYWdlID4gMSkgeyAvLyDkuIvmi4nliIbpobXliqDovb1cbiAgICAgIC0tY3VycmVudFBhZ2U7XG4gICAgfSBlbHNlIGlmICghcHVsbERvd24gJiYgcHVsbFVwICkgeyAgICAgICAgICAgIC8vIOS4iuaLieWKoOi9vVxuICAgICAgbGV0IHRvdGFsU2l6ZSA9IHBhZ2VTaXplICogKGN1cnJlbnRQYWdlICsgMSk7XG4gICAgICBpZiAodG90YWxTaXplID4gdG90YWxDb3VudCAmJiBjdXJyZW50UGFnZSA+IDEpIHsgXG4gICAgICAgIGNvbnNvbGUubG9nKCd0b3RhbCBzaXplOicsIHBhZ2VTaXplICogKGN1cnJlbnRQYWdlICsgMSkpOyBcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgKytjdXJyZW50UGFnZTtcbiAgICB9IGVsc2UgeyAgLy8g5YW25LuW5oOF5Ya177yM6KeG5Li66YeN5paw5Yqg6L29XG4gICAgICBjb25zb2xlLmxvZygn5YW25LuW5oOF5Ya177yM6KeG5Li66YeN5paw5Yqg6L29Jyk7XG4gICAgICBjdXJyZW50UGFnZSA9IDE7XG4gICAgfVxuICAgIGxldCBwID0ge1xuICAgICAgLy8ga2V5d29yZDogdGhpcy5kYXRhLmtleXdvcmQsXG4gICAgICBjaXR5OiB0aGlzLmRhdGEuY3VycmVudENpdHksXG4gICAgICBjdXJyZW50UGFnZSxcbiAgICAgIGxpbWl0OiBwYWdlU2l6ZSxcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ09iamVjdC5hc3NpZ24ocCwgcGFyYW1zKTogJywgT2JqZWN0LmFzc2lnbihwLCBwYXJhbXMpKTtcbiAgICAvLyBBcGkuZ2V0U2hvcExpc3QoT2JqZWN0LmFzc2lnbihwLCBwYXJhbXMpKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAvLyAgIGlmIChyZXN1bHQuY29kZSA9PT0gMjAwKSB7XG4gICAgLy8gICAgIGxldCBwcmVTaG9wTGlzdCA9IGxhc3RQYWdlID4gMSA/IHRoaXMuZGF0YS5jdXJyU2hvcExpc3QgOiBbXTtcbiAgICAvLyAgICAgbGV0IGRhdGFBbHJlYWR5ID0gdHJ1ZTtcbiAgICAvLyAgICAgbGV0IHNob3BMaXN0ID0gcmVzdWx0LmRhdGEucm93cztcbiAgICAvLyAgICAgbGV0IHRvdGFsQ291bnQgPSByZXN1bHQuZGF0YS5jb3VudDtcbiAgICAvLyAgICAgaWYgKHB1bGxEb3duKSB7XG4gICAgLy8gICAgICAgc2hvcExpc3QgPSBzaG9wTGlzdC5jb25jYXQocHJlU2hvcExpc3QpOyAgLy8g5pi+56S65LiK5LiA6aG15pWw5o2u5ZKM5b2T5YmN6aG15pWw5o2u77yI5YWx5Lik6aG177yJXG4gICAgLy8gICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgc2hvcExpc3QgPSBwcmVTaG9wTGlzdC5jb25jYXQoc2hvcExpc3QpOyAgLy8g5pi+56S65LiK5LiA6aG15pWw5o2u5ZKM5b2T5YmN6aG15pWw5o2u77yI5YWx5Lik6aG177yJXG4gICAgLy8gICAgIH1cbiAgICAvLyAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgLy8gICAgICAgZGF0YUFscmVhZHksXG4gICAgLy8gICAgICAgc2hvcExpc3QsXG4gICAgLy8gICAgICAgY3VyclNob3BMaXN0OiByZXN1bHQuZGF0YS5yb3dzLCAgLy8g5L+d55WZ5b2T5YmN6aG15pWw5o2uXG4gICAgLy8gICAgICAgdG90YWxDb3VudCxcbiAgICAvLyAgICAgICBjdXJyZW50UGFnZSxcbiAgICAvLyAgICAgfSk7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKHNob3BMaXN0Lmxlbmd0aCk7XG4gICAgLy8gICB9XG4gICAgLy8gfSkuY2F0Y2goKGVycikgPT4ge1xuICAgIC8vICAgY29uc29sZS5sb2coJ2dldCBTaG9wIExpc3QnLCBlcnIpO1xuICAgIC8vIH0pXG4gIH0sXG5cbiAgLyoqIOaOp+WItnBpY2tlciAqL1xuICBwb3BQaWNrZXIoKSB7XG4gICAgbGV0IHBvcEhpZGRlbiA9IHRoaXMuZGF0YS5wb3BIaWRkZW47XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwb3BIaWRkZW46ICFwb3BIaWRkZW4sXG4gICAgfSlcbiAgfSxcblxuICAvKiog6YCJ5oup5Z+O5biCICovXG4gIGRvU2VsZWN0KGU6IGFueSkge1xuICAgIGlmIChlLmRldGFpbC5uYW1lKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgICAgICBjdXJyZW50Q2l0eTogZS5kZXRhaWwubmFtZSxcbiAgICAgICAgcHVsbERvd246IGZhbHNlLFxuICAgICAgICBwdWxsVXA6IGZhbHNlLFxuICAgICAgICBjdXJyZW50UGFnZTogMSwgICAgwqAvLyDmm7TmjaLln47luIJcbiAgICAgIH0pXG4gICAgICBsZXQgcGFyYW1zID0ge1xuICAgICAgICBjaXR5OiBlLmRldGFpbC5uYW1lLFxuICAgICAgICBuZWVkTG9hZGluZzogJzEnLFxuICAgICAgfVxuICAgICAgdGhpcy5nZXRTaG9wTGlzdChwYXJhbXMpO1xuICAgICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICAgIGtleTogJ2N1cnJlbnRDaXR5JyxcbiAgICAgICAgZGF0YTogZS5kZXRhaWwubmFtZSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7ICAvLyDlj5bmtojmjInpkq5cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwb3BIaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuICAvKiog5omT5byA5b6u5L+h5LqM57u056CB5by55qGGICovXG4gIHBvcFdlY2hhdChlOiBhbnkpIHtcbiAgICBjb25zdCBjdXJyZW50UXJjb2RlID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQucXJjb2RlO1xuICAgIGNvbnN0IGN1cnJlbnRQaG9uZSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnBob25lO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgY3VycmVudFFyY29kZSxcbiAgICAgIGN1cnJlbnRQaG9uZSxcbiAgICAgIHBvcFdlY2hhdDogdHJ1ZVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOWFs+mXreW+ruS/oeS6jOe7tOeggeW8ueahhiAqL1xuICBjbG9zZVdlY2hhdCgpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHBvcFdlY2hhdDogZmFsc2VcbiAgICB9KVxuICB9LFxuXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuICAgIC8vIGNvbnN0IHsgcGFnZUxvYWRlZCB9ID0gdGhpcy5kYXRhO1xuICAgIC8vIGlmIChwYWdlTG9hZGVkKSB7XG4gICAgLy8gICB0aGlzLmdldFNob3BMaXN0KHt9LCAnMCcpO1xuICAgIC8vIH1cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XG4gICAqL1xuICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOS4i+aLieWIt+aWsFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHB1bGxEb3duOiB0cnVlLFxuICAgICAgcHVsbFVwOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuZ2V0U2hvcExpc3QoeyBuZWVkTG9hZGluZzogJzEnIH0pO1xuICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goKTtcbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgICBwdWxsVXA6IHRydWVcbiAgICB9KTtcbiAgICB0aGlzLmdldFNob3BMaXN0KHsgbmVlZExvYWRpbmc6ICcxJyB9KTtcbiAgfSxcblxuICAvKipcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAqL1xuICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKG9wdGlvbnM/OiBQYWdlLklTaGFyZUFwcE1lc3NhZ2VPcHRpb24gfCB1bmRlZmluZWQpOiBQYWdlLklDdXN0b21TaGFyZUNvbnRlbnQge1xuICAgIGNvbnNvbGUubG9nKCdvblNoYXJlQXBwTWVzc2FnZSBvcHRpb25zJywgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHt9O1xuICB9XG59KSJdfQ==
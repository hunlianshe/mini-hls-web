"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
Page({
    data: {
        psyTest: [],
        currShopList: [],
        dataAlready: false,
        currentCity: '',
        selectValue: '',
        currentQrcode: '',
        currentPhone: '',
        phone: '',
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
    },
    onLoad() {
        this.getPsyList();
    },
    goXzys() {
        wx.navigateTo({
            url: `../xzys/xzys`,
        });
    },
    goXlcsList() {
        wx.navigateTo({
            url: `../xlcsList/xlcsList`,
        });
    },
    doTest(e) {
        wx.navigateTo({
            url: `../xlcsDetail/xlcsDetail?id=${e.currentTarget.dataset.id}`,
        });
    },
    goMatch() {
        wx.navigateTo({
            url: `../matcheXz/matcheXz`,
        });
    },
    getPsyList() {
        Api.getPsyList().then((result) => {
            this.setData({
                psyTest: result.data,
            });
        });
    },
    doSearch(e) {
        const keyword = e.detail.value;
        const params = {
            keyword,
            needLoading: '1',
        };
        this.getShopList(params);
        this.setData({
            keyword,
            pullDown: false,
            pullUp: false,
        });
    },
    getShopList(params) {
        const totalCount = this.data.totalCount;
        const pageSize = this.data.pageSize;
        let currentPage = this.data.currentPage;
        const pullDown = this.data.pullDown;
        const pullUp = this.data.pullUp;
        if (pullDown && !pullUp && currentPage > 1) {
            --currentPage;
        }
        else if (!pullDown && pullUp) {
            let totalSize = pageSize * (currentPage + 1);
            if (totalSize > totalCount && currentPage > 1) {
                console.log('total size:', pageSize * (currentPage + 1));
                return;
            }
            ++currentPage;
        }
        else {
            console.log('其他情况，视为重新加载');
            currentPage = 1;
        }
        let p = {
            city: this.data.currentCity,
            currentPage,
            limit: pageSize,
        };
        console.log('Object.assign(p, params): ', Object.assign(p, params));
    },
    popPicker() {
        let popHidden = this.data.popHidden;
        this.setData({
            popHidden: !popHidden,
        });
    },
    doSelect(e) {
        if (e.detail.name) {
            this.setData({
                popHidden: true,
                currentCity: e.detail.name,
                pullDown: false,
                pullUp: false,
                currentPage: 1,
            });
            let params = {
                city: e.detail.name,
                needLoading: '1',
            };
            this.getShopList(params);
            wx.setStorage({
                key: 'currentCity',
                data: e.detail.name,
            });
        }
        else {
            this.setData({
                popHidden: true,
            });
        }
    },
    popWechat(e) {
        const currentQrcode = e.currentTarget.dataset.qrcode;
        const currentPhone = e.currentTarget.dataset.phone;
        this.setData({
            currentQrcode,
            currentPhone,
            popWechat: true
        });
    },
    closeWechat() {
        this.setData({
            popWechat: false
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        this.setData({
            pullDown: true,
            pullUp: false
        });
        this.getShopList({ needLoading: '1' });
        wx.stopPullDownRefresh();
    },
    onReachBottom: function () {
        this.setData({
            pullDown: false,
            pullUp: true
        });
        this.getShopList({ needLoading: '1' });
    },
    onShareAppMessage: function (options) {
        console.log('onShareAppMessage options', options);
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhvbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFFakQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLEVBQUU7UUFDWCxZQUFZLEVBQUUsRUFBRTtRQUNoQixXQUFXLEVBQUUsS0FBSztRQUNsQixXQUFXLEVBQUUsRUFBRTtRQUNmLFdBQVcsRUFBRSxFQUFFO1FBQ2YsYUFBYSxFQUFFLEVBQUU7UUFDakIsWUFBWSxFQUFFLEVBQUU7UUFDaEIsS0FBSyxFQUFFLEVBQUU7UUFDVCxTQUFTLEVBQUUsSUFBSTtRQUNmLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLFdBQVcsRUFBRSxDQUFDO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixVQUFVLEVBQUUsQ0FBQztRQUNiLFFBQVEsRUFBRSxLQUFLO1FBQ2YsTUFBTSxFQUFFLEtBQUs7S0FDZDtJQUVELE1BQU07UUFjSixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUlELE1BQU07UUFDSixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLGNBQWM7U0FDcEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELFVBQVU7UUFDUixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLHNCQUFzQjtTQUM1QixDQUFDLENBQUE7SUFDSixDQUFDO0lBR0QsTUFBTSxDQUFDLENBQU07UUFDWCxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLCtCQUErQixDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUU7U0FDakUsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELE9BQU87UUFDTCxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLHNCQUFzQjtTQUM1QixDQUFDLENBQUE7SUFDSixDQUFDO0lB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LFFBQVEsRUFBRSxLQUFLO1lBQ2YsTUFBTSxFQUFFLElBQUk7U0FDYixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUtELGlCQUFpQixFQUFFLFVBQVUsT0FBaUQ7UUFDNUUsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNsRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBcGkgZnJvbSAnLi4vLi4vc2VydmljZS9hcGkuc2VydmljZSc7XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgcHN5VGVzdDogW10sXG4gICAgY3VyclNob3BMaXN0OiBbXSxcbiAgICBkYXRhQWxyZWFkeTogZmFsc2UsXG4gICAgY3VycmVudENpdHk6ICcnLFxuICAgIHNlbGVjdFZhbHVlOiAnJyxcbiAgICBjdXJyZW50UXJjb2RlOiAnJyxcbiAgICBjdXJyZW50UGhvbmU6ICcnLFxuICAgIHBob25lOiAnJyxcbiAgICBwb3BIaWRkZW46IHRydWUsXG4gICAgcGFnZUxvYWRlZDogZmFsc2UsXG4gICAgcG9wV2VjaGF0OiBmYWxzZSxcbiAgICBjdXJyZW50UGFnZTogMSxcbiAgICBwYWdlU2l6ZTogMTAsXG4gICAgdG90YWxDb3VudDogMCxcbiAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgcHVsbFVwOiBmYWxzZSxcbiAgfSxcblxuICBvbkxvYWQgKCkge1xuICAgIC8vIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgLy8gd3guZ2V0U3RvcmFnZSh7XG4gICAgLy8gICBrZXk6ICdjdXJyZW50Q2l0eScsXG4gICAgLy8gICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAvLyAgICAgX3RoaXMuc2V0RGF0YSEoe1xuICAgIC8vICAgICAgIGN1cnJlbnRDaXR5OiByZXMuZGF0YSxcbiAgICAvLyAgICAgfSk7XG4gICAgLy8gICB9LFxuICAgIC8vIH0pO1xuICAgIC8vIHRoaXMuZ2V0U2hvcExpc3Qoe25lZWRMb2FkaW5nOiAnMSd9KTtcbiAgICAvLyB0aGlzLnNldERhdGEhKHtcbiAgICAvLyAgIHBhZ2VMb2FkZWQ6IHRydWUsXG4gICAgLy8gfSlcbiAgICB0aGlzLmdldFBzeUxpc3QoKTtcbiAgfSxcbiAgXG4gIFxuICAvKiog5pif5bqn6L+Q5Yq/ICovXG4gIGdvWHp5cygpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uL3h6eXMveHp5c2AsXG4gICAgfSlcbiAgfSxcblxuICAvKiog5b+D55CG5rWL6K+V5YiX6KGoICovXG4gIGdvWGxjc0xpc3QoKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi94bGNzTGlzdC94bGNzTGlzdGAsXG4gICAgfSlcbiAgfSxcbiAgXG4gIC8qKiDlv4PnkIbmtYvor5UgKi9cbiAgZG9UZXN0KGU6IGFueSkge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiBgLi4veGxjc0RldGFpbC94bGNzRGV0YWlsP2lkPSR7ZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWR9YCxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDmmJ/luqfljLnphY0gKi9cbiAgZ29NYXRjaCgpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uL21hdGNoZVh6L21hdGNoZVh6YCxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDojrflj5blv4PnkIbmtYvor5UgKi9cbiAgZ2V0UHN5TGlzdCgpIHtcbiAgICBBcGkuZ2V0UHN5TGlzdCgpLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcHN5VGVzdDogcmVzdWx0LmRhdGEsXG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG5cblxuICAvKiog6aaW6aG15pCc57SiICovXG4gIGRvU2VhcmNoKGU6IGFueSkge1xuICAgIGNvbnN0IGtleXdvcmQgPSBlLmRldGFpbC52YWx1ZTsgXG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAga2V5d29yZCxcbiAgICAgIG5lZWRMb2FkaW5nOiAnMScsXG4gICAgfVxuICAgIHRoaXMuZ2V0U2hvcExpc3QocGFyYW1zKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGtleXdvcmQsXG4gICAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgICBwdWxsVXA6IGZhbHNlLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOiOt+WPluW6l+mTuuWIl+ihqCDliIbpobXliqDovb1cbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBcbiAgICovXG4gIGdldFNob3BMaXN0KHBhcmFtczogYW55KSB7XG4gICAgY29uc3QgdG90YWxDb3VudCA9IHRoaXMuZGF0YS50b3RhbENvdW50O1xuICAgIGNvbnN0IHBhZ2VTaXplID0gdGhpcy5kYXRhLnBhZ2VTaXplO1xuICAgIGxldCBjdXJyZW50UGFnZSA9IHRoaXMuZGF0YS5jdXJyZW50UGFnZTtcbiAgICAvLyBsZXQgbGFzdFBhZ2UgPSB0aGlzLmRhdGEuY3VycmVudFBhZ2U7XG4gICAgY29uc3QgcHVsbERvd24gPSB0aGlzLmRhdGEucHVsbERvd247XG4gICAgY29uc3QgcHVsbFVwID0gdGhpcy5kYXRhLnB1bGxVcDtcbiAgICBpZiAocHVsbERvd24gJiYgIXB1bGxVcCAmJiBjdXJyZW50UGFnZSA+IDEpIHsgLy8g5LiL5ouJ5YiG6aG15Yqg6L29XG4gICAgICAtLWN1cnJlbnRQYWdlO1xuICAgIH0gZWxzZSBpZiAoIXB1bGxEb3duICYmIHB1bGxVcCApIHsgICAgICAgICAgICAvLyDkuIrmi4nliqDovb1cbiAgICAgIGxldCB0b3RhbFNpemUgPSBwYWdlU2l6ZSAqIChjdXJyZW50UGFnZSArIDEpO1xuICAgICAgaWYgKHRvdGFsU2l6ZSA+IHRvdGFsQ291bnQgJiYgY3VycmVudFBhZ2UgPiAxKSB7IFxuICAgICAgICBjb25zb2xlLmxvZygndG90YWwgc2l6ZTonLCBwYWdlU2l6ZSAqIChjdXJyZW50UGFnZSArIDEpKTsgXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgICsrY3VycmVudFBhZ2U7XG4gICAgfSBlbHNlIHsgIC8vIOWFtuS7luaDheWGte+8jOinhuS4uumHjeaWsOWKoOi9vVxuICAgICAgY29uc29sZS5sb2coJ+WFtuS7luaDheWGte+8jOinhuS4uumHjeaWsOWKoOi9vScpO1xuICAgICAgY3VycmVudFBhZ2UgPSAxO1xuICAgIH1cbiAgICBsZXQgcCA9IHtcbiAgICAgIC8vIGtleXdvcmQ6IHRoaXMuZGF0YS5rZXl3b3JkLFxuICAgICAgY2l0eTogdGhpcy5kYXRhLmN1cnJlbnRDaXR5LFxuICAgICAgY3VycmVudFBhZ2UsXG4gICAgICBsaW1pdDogcGFnZVNpemUsXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdPYmplY3QuYXNzaWduKHAsIHBhcmFtcyk6ICcsIE9iamVjdC5hc3NpZ24ocCwgcGFyYW1zKSk7XG4gICAgLy8gQXBpLmdldFNob3BMaXN0KE9iamVjdC5hc3NpZ24ocCwgcGFyYW1zKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgLy8gICBpZiAocmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgIC8vICAgICBsZXQgcHJlU2hvcExpc3QgPSBsYXN0UGFnZSA+IDEgPyB0aGlzLmRhdGEuY3VyclNob3BMaXN0IDogW107XG4gICAgLy8gICAgIGxldCBkYXRhQWxyZWFkeSA9IHRydWU7XG4gICAgLy8gICAgIGxldCBzaG9wTGlzdCA9IHJlc3VsdC5kYXRhLnJvd3M7XG4gICAgLy8gICAgIGxldCB0b3RhbENvdW50ID0gcmVzdWx0LmRhdGEuY291bnQ7XG4gICAgLy8gICAgIGlmIChwdWxsRG93bikge1xuICAgIC8vICAgICAgIHNob3BMaXN0ID0gc2hvcExpc3QuY29uY2F0KHByZVNob3BMaXN0KTsgIC8vIOaYvuekuuS4iuS4gOmhteaVsOaNruWSjOW9k+WJjemhteaVsOaNru+8iOWFseS4pOmhte+8iVxuICAgIC8vICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgIHNob3BMaXN0ID0gcHJlU2hvcExpc3QuY29uY2F0KHNob3BMaXN0KTsgIC8vIOaYvuekuuS4iuS4gOmhteaVsOaNruWSjOW9k+WJjemhteaVsOaNru+8iOWFseS4pOmhte+8iVxuICAgIC8vICAgICB9XG4gICAgLy8gICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgIC8vICAgICAgIGRhdGFBbHJlYWR5LFxuICAgIC8vICAgICAgIHNob3BMaXN0LFxuICAgIC8vICAgICAgIGN1cnJTaG9wTGlzdDogcmVzdWx0LmRhdGEucm93cywgIC8vIOS/neeVmeW9k+WJjemhteaVsOaNrlxuICAgIC8vICAgICAgIHRvdGFsQ291bnQsXG4gICAgLy8gICAgICAgY3VycmVudFBhZ2UsXG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgICBjb25zb2xlLmxvZyhzaG9wTGlzdC5sZW5ndGgpO1xuICAgIC8vICAgfVxuICAgIC8vIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAvLyAgIGNvbnNvbGUubG9nKCdnZXQgU2hvcCBMaXN0JywgZXJyKTtcbiAgICAvLyB9KVxuICB9LFxuXG4gIC8qKiDmjqfliLZwaWNrZXIgKi9cbiAgcG9wUGlja2VyKCkge1xuICAgIGxldCBwb3BIaWRkZW4gPSB0aGlzLmRhdGEucG9wSGlkZGVuO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgcG9wSGlkZGVuOiAhcG9wSGlkZGVuLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOmAieaLqeWfjuW4giAqL1xuICBkb1NlbGVjdChlOiBhbnkpIHtcbiAgICBpZiAoZS5kZXRhaWwubmFtZSkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBvcEhpZGRlbjogdHJ1ZSxcbiAgICAgICAgY3VycmVudENpdHk6IGUuZGV0YWlsLm5hbWUsXG4gICAgICAgIHB1bGxEb3duOiBmYWxzZSxcbiAgICAgICAgcHVsbFVwOiBmYWxzZSxcbiAgICAgICAgY3VycmVudFBhZ2U6IDEsICAgIMKgLy8g5pu05o2i5Z+O5biCXG4gICAgICB9KVxuICAgICAgbGV0IHBhcmFtcyA9IHtcbiAgICAgICAgY2l0eTogZS5kZXRhaWwubmFtZSxcbiAgICAgICAgbmVlZExvYWRpbmc6ICcxJyxcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2V0U2hvcExpc3QocGFyYW1zKTtcbiAgICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAgICBrZXk6ICdjdXJyZW50Q2l0eScsXG4gICAgICAgIGRhdGE6IGUuZGV0YWlsLm5hbWUsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgeyAgLy8g5Y+W5raI5oyJ6ZKuXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgLyoqIOaJk+W8gOW+ruS/oeS6jOe7tOeggeW8ueahhiAqL1xuICBwb3BXZWNoYXQoZTogYW55KSB7XG4gICAgY29uc3QgY3VycmVudFFyY29kZSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnFyY29kZTtcbiAgICBjb25zdCBjdXJyZW50UGhvbmUgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5waG9uZTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGN1cnJlbnRRcmNvZGUsXG4gICAgICBjdXJyZW50UGhvbmUsXG4gICAgICBwb3BXZWNoYXQ6IHRydWVcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDlhbPpl63lvq7kv6Hkuoznu7TnoIHlvLnmoYYgKi9cbiAgY2xvc2VXZWNoYXQoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwb3BXZWNoYXQ6IGZhbHNlXG4gICAgfSlcbiAgfSxcblxuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XG4gICAqL1xuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBjb25zdCB7IHBhZ2VMb2FkZWQgfSA9IHRoaXMuZGF0YTtcbiAgICAvLyBpZiAocGFnZUxvYWRlZCkge1xuICAgIC8vICAgdGhpcy5nZXRTaG9wTGlzdCh7fSwgJzAnKTtcbiAgICAvLyB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDkuIvmi4nliLfmlrBcbiAgICovXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwdWxsRG93bjogdHJ1ZSxcbiAgICAgIHB1bGxVcDogZmFsc2VcbiAgICB9KTtcbiAgICB0aGlzLmdldFNob3BMaXN0KHsgbmVlZExvYWRpbmc6ICcxJyB9KTtcbiAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgcHVsbERvd246IGZhbHNlLFxuICAgICAgcHVsbFVwOiB0cnVlXG4gICAgfSk7XG4gICAgdGhpcy5nZXRTaG9wTGlzdCh7IG5lZWRMb2FkaW5nOiAnMScgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xuICAgKi9cbiAgb25TaGFyZUFwcE1lc3NhZ2U6IGZ1bmN0aW9uIChvcHRpb25zPzogUGFnZS5JU2hhcmVBcHBNZXNzYWdlT3B0aW9uIHwgdW5kZWZpbmVkKTogUGFnZS5JQ3VzdG9tU2hhcmVDb250ZW50IHtcbiAgICBjb25zb2xlLmxvZygnb25TaGFyZUFwcE1lc3NhZ2Ugb3B0aW9ucycsIG9wdGlvbnMpO1xuICAgIHJldHVybiB7fTtcbiAgfVxufSkiXX0=
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const app = getApp();
Page({
    data: {
        userInfo: {},
        psyTest: [],
        currShopList: [],
        dataAlready: false,
        currentCity: '',
        selectValue: '',
        currentQrcode: '',
        currentPhone: '',
        phone: '',
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
        horoscopeData: {},
    },
    onLoad() {
        let _this = this;
        wx.getStorage({
            key: 'user',
            success: function (res) {
                app.globalData.userInfo = res.data;
                _this.setData({
                    userInfo: res.data,
                });
            },
        });
        this.setData({
            pageLoaded: true,
        });
        this.getPsyList();
        this.getHoroscopet(encodeURIComponent(this.data.userInfo.constellation || '白羊座'));
    },
    goXzys() {
        wx.navigateTo({
            url: `../xzys/xzys`,
        });
    },
    goXlcsList() {
        wx.navigateTo({
            url: `../xlcsList/xlcsList`,
        });
    },
    doTest(e) {
        wx.navigateTo({
            url: `../xlcsDetail/xlcsDetail?id=${e.currentTarget.dataset.id}`,
        });
    },
    goMatch() {
        wx.navigateTo({
            url: `../matcheXz/matcheXz`,
        });
    },
    getPsyList() {
        Api.getPsyList().then((result) => {
            this.setData({
                psyTest: result.data,
            });
        });
    },
    getHoroscopet(consName) {
        Api.getHoroscopet(consName, 'today').then((result) => {
            this.setData({
                horoscopeData: result.data,
            });
        });
    },
    doSearch(e) {
        const keyword = e.detail.value;
        const params = {
            keyword,
            needLoading: '1',
        };
        this.getShopList(params);
        this.setData({
            keyword,
            pullDown: false,
            pullUp: false,
        });
    },
    getShopList(params) {
        const totalCount = this.data.totalCount;
        const pageSize = this.data.pageSize;
        let currentPage = this.data.currentPage;
        const pullDown = this.data.pullDown;
        const pullUp = this.data.pullUp;
        if (pullDown && !pullUp && currentPage > 1) {
            --currentPage;
        }
        else if (!pullDown && pullUp) {
            let totalSize = pageSize * (currentPage + 1);
            if (totalSize > totalCount && currentPage > 1) {
                console.log('total size:', pageSize * (currentPage + 1));
                return;
            }
            ++currentPage;
        }
        else {
            console.log('其他情况，视为重新加载');
            currentPage = 1;
        }
        let p = {
            city: this.data.currentCity,
            currentPage,
            limit: pageSize,
        };
        console.log('Object.assign(p, params): ', Object.assign(p, params));
    },
    popPicker() {
        let popHidden = this.data.popHidden;
        this.setData({
            popHidden: !popHidden,
        });
    },
    doSelect(e) {
        if (e.detail.name) {
            this.setData({
                popHidden: true,
                currentCity: e.detail.name,
                pullDown: false,
                pullUp: false,
                currentPage: 1,
            });
            let params = {
                city: e.detail.name,
                needLoading: '1',
            };
            this.getShopList(params);
            wx.setStorage({
                key: 'currentCity',
                data: e.detail.name,
            });
        }
        else {
            this.setData({
                popHidden: true,
            });
        }
    },
    popWechat(e) {
        const currentQrcode = e.currentTarget.dataset.qrcode;
        const currentPhone = e.currentTarget.dataset.phone;
        this.setData({
            currentQrcode,
            currentPhone,
            popWechat: true
        });
    },
    closeWechat() {
        this.setData({
            popWechat: false
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        this.setData({
            pullDown: true,
            pullUp: false
        });
        this.getShopList({ needLoading: '1' });
        wx.stopPullDownRefresh();
    },
    onReachBottom: function () {
        this.setData({
            pullDown: false,
            pullUp: true
        });
        this.getShopList({ needLoading: '1' });
    },
    onShareAppMessage: function (options) {
        console.log('onShareAppMessage options', options);
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhvbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFFakQsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFVLENBQUM7QUFJN0IsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osUUFBUSxFQUFFLEVBQVM7UUFDbkIsT0FBTyxFQUFFLEVBQUU7UUFDWCxZQUFZLEVBQUUsRUFBRTtRQUNoQixXQUFXLEVBQUUsS0FBSztRQUNsQixXQUFXLEVBQUUsRUFBRTtRQUNmLFdBQVcsRUFBRSxFQUFFO1FBQ2YsYUFBYSxFQUFFLEVBQUU7UUFDakIsWUFBWSxFQUFFLEVBQUU7UUFDaEIsS0FBSyxFQUFFLEVBQUU7UUFDVCxTQUFTLEVBQUUsSUFBSTtRQUNmLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLFdBQVcsRUFBRSxDQUFDO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixVQUFVLEVBQUUsQ0FBQztRQUNiLFFBQVEsRUFBRSxLQUFLO1FBQ2YsTUFBTSxFQUFFLEtBQUs7UUFDYixhQUFhLEVBQUUsRUFBZTtLQUMvQjtJQUVELE1BQU07UUFDSixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDakIsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSxNQUFNO1lBQ1gsT0FBTyxFQUFFLFVBQVMsR0FBRztnQkFDbkIsR0FBRyxDQUFDLFVBQVUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDbkMsS0FBSyxDQUFDLE9BQVEsQ0FBQztvQkFDYixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUk7aUJBQ25CLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxD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QUM7UUFDbEQsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQXBpIGZyb20gJy4uLy4uL3NlcnZpY2UvYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgSU15QXBwIH0gZnJvbSAnLi4vLi4vYXBwJztcbmNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KCk7XG5cbmltcG9ydCBIb3Jvc2NvcGUgZnJvbSAnLi4vLi4vaW50ZXJmYWNlL2hvcm9zY29wZSc7XG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgdXNlckluZm86IHt9IGFzIGFueSxcbiAgICBwc3lUZXN0OiBbXSxcbiAgICBjdXJyU2hvcExpc3Q6IFtdLFxuICAgIGRhdGFBbHJlYWR5OiBmYWxzZSxcbiAgICBjdXJyZW50Q2l0eTogJycsXG4gICAgc2VsZWN0VmFsdWU6ICcnLFxuICAgIGN1cnJlbnRRcmNvZGU6ICcnLFxuICAgIGN1cnJlbnRQaG9uZTogJycsXG4gICAgcGhvbmU6ICcnLFxuICAgIHBvcEhpZGRlbjogdHJ1ZSxcbiAgICBwYWdlTG9hZGVkOiBmYWxzZSxcbiAgICBwb3BXZWNoYXQ6IGZhbHNlLFxuICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgIHBhZ2VTaXplOiAxMCxcbiAgICB0b3RhbENvdW50OiAwLFxuICAgIHB1bGxEb3duOiBmYWxzZSxcbiAgICBwdWxsVXA6IGZhbHNlLFxuICAgIGhvcm9zY29wZURhdGE6IHt9IGFzIEhvcm9zY29wZSxcbiAgfSxcblxuICBvbkxvYWQgKCkge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgd3guZ2V0U3RvcmFnZSh7XG4gICAgICBrZXk6ICd1c2VyJyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHJlcy5kYXRhO1xuICAgICAgICBfdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgdXNlckluZm86IHJlcy5kYXRhLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwYWdlTG9hZGVkOiB0cnVlLFxuICAgIH0pXG4gICAgdGhpcy5nZXRQc3lMaXN0KCk7XG4gICAgdGhpcy5nZXRIb3Jvc2NvcGV0KGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmRhdGEudXNlckluZm8uY29uc3RlbGxhdGlvbiB8fCAn55m9576K5bqnJykpO1xuICB9LFxuICBcbiAgXG4gIC8qKiDmmJ/luqfov5Dlir8gKi9cbiAgZ29YenlzKCkge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiBgLi4veHp5cy94enlzYCxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDlv4PnkIbmtYvor5XliJfooaggKi9cbiAgZ29YbGNzTGlzdCgpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uL3hsY3NMaXN0L3hsY3NMaXN0YCxcbiAgICB9KVxuICB9LFxuICBcbiAgLyoqIOW/g+eQhua1i+ivlSAqL1xuICBkb1Rlc3QoZTogYW55KSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi94bGNzRGV0YWlsL3hsY3NEZXRhaWw/aWQ9JHtlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pZH1gLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOaYn+W6p+WMuemFjSAqL1xuICBnb01hdGNoKCkge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiBgLi4vbWF0Y2hlWHovbWF0Y2hlWHpgLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOiOt+WPluW/g+eQhua1i+ivlSAqL1xuICBnZXRQc3lMaXN0KCkge1xuICAgIEFwaS5nZXRQc3lMaXN0KCkudGhlbigocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwc3lUZXN0OiByZXN1bHQuZGF0YSxcbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcblxuICBnZXRIb3Jvc2NvcGV0KGNvbnNOYW1lOiBzdHJpbmcpIHtcbiAgICBBcGkuZ2V0SG9yb3Njb3BldChjb25zTmFtZSwgJ3RvZGF5JykudGhlbigocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBob3Jvc2NvcGVEYXRhOiByZXN1bHQuZGF0YSxcbiAgICAgIH0pXG4gICAgfSk7XG4gIH0sXG5cblxuICAvKiog6aaW6aG15pCc57SiICovXG4gIGRvU2VhcmNoKGU6IGFueSkge1xuICAgIGNvbnN0IGtleXdvcmQgPSBlLmRldGFpbC52YWx1ZTsgXG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAga2V5d29yZCxcbiAgICAgIG5lZWRMb2FkaW5nOiAnMScsXG4gICAgfVxuICAgIHRoaXMuZ2V0U2hvcExpc3QocGFyYW1zKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGtleXdvcmQsXG4gICAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgICBwdWxsVXA6IGZhbHNlLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOiOt+WPluW6l+mTuuWIl+ihqCDliIbpobXliqDovb1cbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBcbiAgICovXG4gIGdldFNob3BMaXN0KHBhcmFtczogYW55KSB7XG4gICAgY29uc3QgdG90YWxDb3VudCA9IHRoaXMuZGF0YS50b3RhbENvdW50O1xuICAgIGNvbnN0IHBhZ2VTaXplID0gdGhpcy5kYXRhLnBhZ2VTaXplO1xuICAgIGxldCBjdXJyZW50UGFnZSA9IHRoaXMuZGF0YS5jdXJyZW50UGFnZTtcbiAgICAvLyBsZXQgbGFzdFBhZ2UgPSB0aGlzLmRhdGEuY3VycmVudFBhZ2U7XG4gICAgY29uc3QgcHVsbERvd24gPSB0aGlzLmRhdGEucHVsbERvd247XG4gICAgY29uc3QgcHVsbFVwID0gdGhpcy5kYXRhLnB1bGxVcDtcbiAgICBpZiAocHVsbERvd24gJiYgIXB1bGxVcCAmJiBjdXJyZW50UGFnZSA+IDEpIHsgLy8g5LiL5ouJ5YiG6aG15Yqg6L29XG4gICAgICAtLWN1cnJlbnRQYWdlO1xuICAgIH0gZWxzZSBpZiAoIXB1bGxEb3duICYmIHB1bGxVcCApIHsgICAgICAgICAgICAvLyDkuIrmi4nliqDovb1cbiAgICAgIGxldCB0b3RhbFNpemUgPSBwYWdlU2l6ZSAqIChjdXJyZW50UGFnZSArIDEpO1xuICAgICAgaWYgKHRvdGFsU2l6ZSA+IHRvdGFsQ291bnQgJiYgY3VycmVudFBhZ2UgPiAxKSB7IFxuICAgICAgICBjb25zb2xlLmxvZygndG90YWwgc2l6ZTonLCBwYWdlU2l6ZSAqIChjdXJyZW50UGFnZSArIDEpKTsgXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgICsrY3VycmVudFBhZ2U7XG4gICAgfSBlbHNlIHsgIC8vIOWFtuS7luaDheWGte+8jOinhuS4uumHjeaWsOWKoOi9vVxuICAgICAgY29uc29sZS5sb2coJ+WFtuS7luaDheWGte+8jOinhuS4uumHjeaWsOWKoOi9vScpO1xuICAgICAgY3VycmVudFBhZ2UgPSAxO1xuICAgIH1cbiAgICBsZXQgcCA9IHtcbiAgICAgIC8vIGtleXdvcmQ6IHRoaXMuZGF0YS5rZXl3b3JkLFxuICAgICAgY2l0eTogdGhpcy5kYXRhLmN1cnJlbnRDaXR5LFxuICAgICAgY3VycmVudFBhZ2UsXG4gICAgICBsaW1pdDogcGFnZVNpemUsXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdPYmplY3QuYXNzaWduKHAsIHBhcmFtcyk6ICcsIE9iamVjdC5hc3NpZ24ocCwgcGFyYW1zKSk7XG4gICAgLy8gQXBpLmdldFNob3BMaXN0KE9iamVjdC5hc3NpZ24ocCwgcGFyYW1zKSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgLy8gICBpZiAocmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgIC8vICAgICBsZXQgcHJlU2hvcExpc3QgPSBsYXN0UGFnZSA+IDEgPyB0aGlzLmRhdGEuY3VyclNob3BMaXN0IDogW107XG4gICAgLy8gICAgIGxldCBkYXRhQWxyZWFkeSA9IHRydWU7XG4gICAgLy8gICAgIGxldCBzaG9wTGlzdCA9IHJlc3VsdC5kYXRhLnJvd3M7XG4gICAgLy8gICAgIGxldCB0b3RhbENvdW50ID0gcmVzdWx0LmRhdGEuY291bnQ7XG4gICAgLy8gICAgIGlmIChwdWxsRG93bikge1xuICAgIC8vICAgICAgIHNob3BMaXN0ID0gc2hvcExpc3QuY29uY2F0KHByZVNob3BMaXN0KTsgIC8vIOaYvuekuuS4iuS4gOmhteaVsOaNruWSjOW9k+WJjemhteaVsOaNru+8iOWFseS4pOmhte+8iVxuICAgIC8vICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgIHNob3BMaXN0ID0gcHJlU2hvcExpc3QuY29uY2F0KHNob3BMaXN0KTsgIC8vIOaYvuekuuS4iuS4gOmhteaVsOaNruWSjOW9k+WJjemhteaVsOaNru+8iOWFseS4pOmhte+8iVxuICAgIC8vICAgICB9XG4gICAgLy8gICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgIC8vICAgICAgIGRhdGFBbHJlYWR5LFxuICAgIC8vICAgICAgIHNob3BMaXN0LFxuICAgIC8vICAgICAgIGN1cnJTaG9wTGlzdDogcmVzdWx0LmRhdGEucm93cywgIC8vIOS/neeVmeW9k+WJjemhteaVsOaNrlxuICAgIC8vICAgICAgIHRvdGFsQ291bnQsXG4gICAgLy8gICAgICAgY3VycmVudFBhZ2UsXG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgICBjb25zb2xlLmxvZyhzaG9wTGlzdC5sZW5ndGgpO1xuICAgIC8vICAgfVxuICAgIC8vIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAvLyAgIGNvbnNvbGUubG9nKCdnZXQgU2hvcCBMaXN0JywgZXJyKTtcbiAgICAvLyB9KVxuICB9LFxuXG4gIC8qKiDmjqfliLZwaWNrZXIgKi9cbiAgcG9wUGlja2VyKCkge1xuICAgIGxldCBwb3BIaWRkZW4gPSB0aGlzLmRhdGEucG9wSGlkZGVuO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgcG9wSGlkZGVuOiAhcG9wSGlkZGVuLFxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOmAieaLqeWfjuW4giAqL1xuICBkb1NlbGVjdChlOiBhbnkpIHtcbiAgICBpZiAoZS5kZXRhaWwubmFtZSkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBvcEhpZGRlbjogdHJ1ZSxcbiAgICAgICAgY3VycmVudENpdHk6IGUuZGV0YWlsLm5hbWUsXG4gICAgICAgIHB1bGxEb3duOiBmYWxzZSxcbiAgICAgICAgcHVsbFVwOiBmYWxzZSxcbiAgICAgICAgY3VycmVudFBhZ2U6IDEsICAgIMKgLy8g5pu05o2i5Z+O5biCXG4gICAgICB9KVxuICAgICAgbGV0IHBhcmFtcyA9IHtcbiAgICAgICAgY2l0eTogZS5kZXRhaWwubmFtZSxcbiAgICAgICAgbmVlZExvYWRpbmc6ICcxJyxcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2V0U2hvcExpc3QocGFyYW1zKTtcbiAgICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAgICBrZXk6ICdjdXJyZW50Q2l0eScsXG4gICAgICAgIGRhdGE6IGUuZGV0YWlsLm5hbWUsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgeyAgLy8g5Y+W5raI5oyJ6ZKuXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgLyoqIOaJk+W8gOW+ruS/oeS6jOe7tOeggeW8ueahhiAqL1xuICBwb3BXZWNoYXQoZTogYW55KSB7XG4gICAgY29uc3QgY3VycmVudFFyY29kZSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnFyY29kZTtcbiAgICBjb25zdCBjdXJyZW50UGhvbmUgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5waG9uZTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGN1cnJlbnRRcmNvZGUsXG4gICAgICBjdXJyZW50UGhvbmUsXG4gICAgICBwb3BXZWNoYXQ6IHRydWVcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDlhbPpl63lvq7kv6Hkuoznu7TnoIHlvLnmoYYgKi9cbiAgY2xvc2VXZWNoYXQoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwb3BXZWNoYXQ6IGZhbHNlXG4gICAgfSlcbiAgfSxcblxuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XG4gICAqL1xuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBjb25zdCB7IHBhZ2VMb2FkZWQgfSA9IHRoaXMuZGF0YTtcbiAgICAvLyBpZiAocGFnZUxvYWRlZCkge1xuICAgIC8vICAgdGhpcy5nZXRTaG9wTGlzdCh7fSwgJzAnKTtcbiAgICAvLyB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDkuIvmi4nliLfmlrBcbiAgICovXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwdWxsRG93bjogdHJ1ZSxcbiAgICAgIHB1bGxVcDogZmFsc2VcbiAgICB9KTtcbiAgICB0aGlzLmdldFNob3BMaXN0KHsgbmVlZExvYWRpbmc6ICcxJyB9KTtcbiAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgcHVsbERvd246IGZhbHNlLFxuICAgICAgcHVsbFVwOiB0cnVlXG4gICAgfSk7XG4gICAgdGhpcy5nZXRTaG9wTGlzdCh7IG5lZWRMb2FkaW5nOiAnMScgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xuICAgKi9cbiAgb25TaGFyZUFwcE1lc3NhZ2U6IGZ1bmN0aW9uIChvcHRpb25zPzogUGFnZS5JU2hhcmVBcHBNZXNzYWdlT3B0aW9uIHwgdW5kZWZpbmVkKTogUGFnZS5JQ3VzdG9tU2hhcmVDb250ZW50IHtcbiAgICBjb25zb2xlLmxvZygnb25TaGFyZUFwcE1lc3NhZ2Ugb3B0aW9ucycsIG9wdGlvbnMpO1xuICAgIHJldHVybiB7fTtcbiAgfVxufSkiXX0=
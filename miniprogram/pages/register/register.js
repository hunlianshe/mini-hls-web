"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const utils = require("../../utils/utils");
const jobJson_1 = require("../../public/json/jobJson");
const app = getApp();
Page({
    data: {
        userInfo: { openid: '' },
        nickName: '',
        gender: '',
        birth: '',
        height: '',
        salary: '',
        workCity: '',
        workProvince: '',
        workRegion: '',
        isMarriage: '',
        education: '',
        hasChild: '',
        wantChild: '',
        jobGeneral: '',
        jobDetail: '',
        haveHouse: '',
        genderIndex: 0,
        salaryIndex: 0,
        dateNow: '',
        submitDisable: false,
        isMarriageArray: ['未婚', '离婚'],
        genderArray: ['男', '女'],
        salaryArray: [
            '5千以下', '5千～1万', '1万～2万', '2万～5万', '5万以上'
        ],
        educationArray: [
            '小学', '初中', '高中', '大专', '大学本科', '硕士', '博士'
        ],
        hasChildArray: ['是', '否'],
        wantChildArray: ['是', '否'],
        haveHouseArray: ['已买房', '未买房'],
        multiIndex: [,],
        multiArray: [[], []],
        jobJson: jobJson_1.default,
    },
    onLoad: function () {
        const multiArray = [[], []];
        jobJson_1.default.data.forEach((item) => {
            multiArray[0].push(item.name);
        });
        jobJson_1.default.data[0].data.forEach((item) => {
            multiArray[1].push(item.name);
        });
        console.log(multiArray);
        this.setData({
            multiArray,
            dateNow: this.getYMD(new Date())
        });
        this.getUserInfo();
    },
    getUserInfo() {
        const openid = app.globalData.userInfo.openid;
        Api.getUserInfo(openid || '').then((result) => {
            if (result) {
                this.setData({
                    userInfo: result.data,
                    nickName: result.data.nickName,
                    gender: result.data.gender,
                    birth: this.getYMD(result.data.birth),
                    height: result.data.height,
                    salary: result.data.salary,
                    workProvince: result.data.workProvince,
                    workCity: result.data.workCity,
                    workRegion: result.data.workRegion,
                    isMarriage: result.data.isMarriage,
                    education: result.data.education,
                    hasChild: result.data.hasChild,
                    wantChild: result.data.wantChild,
                    jobGeneral: result.data.jobGeneral,
                    jobDetail: result.data.jobDetail,
                    haveHouse: result.data.haveHouse,
                });
                console.log('data', this.data);
            }
        });
    },
    getYMD(dateStr) {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        let month = date.getMonth() + 1;
        let monthStr = month <= 9 ? `0${month}` : month;
        let day = date.getDate();
        let dayStr = day <= 9 ? `0${day}` : day;
        return `${year}-${monthStr}-${dayStr}`;
    },
    onSubmit(e) {
        let that = this;
        const value = e.detail.value;
        if (!utils.validateEmpty(value.nickName, '请输入昵称') ||
            !utils.validateEmpty(value.gender, '请选择性别') ||
            !utils.validateEmpty(value.birth, '请选择生日') ||
            !utils.validateEmpty(value.height, '请输入身高') ||
            !utils.validateEmpty(value.salary, '请选择收入') ||
            !utils.validateEmpty(this.data.workProvince, '请选择工作所在地') ||
            !utils.validateEmpty(this.data.education, '请选择学历') ||
            !utils.validateEmpty(this.data.isMarriage, '请选择婚姻状况') ||
            !utils.validateEmpty(this.data.hasChild, '请选择是否有孩子') ||
            !utils.validateEmpty(this.data.wantChild, '请选择是否想要孩子') ||
            !utils.validateEmpty(this.data.haveHouse, '请选择买房情况')) {
            return false;
        }
        that.doSubmit(e);
    },
    doSubmit(e) {
        const params = e.detail.value;
        console.log(e.detail.value);
        const { userInfo } = this.data;
        const dataParams = {
            workProvince: this.data.workProvince,
            workCity: this.data.workCity,
            workRegion: this.data.workRegion,
            jobGeneral: this.data.jobGeneral,
            jobDetail: this.data.jobDetail,
        };
        this.setData({
            submitDisable: true
        });
        console.log(Object.assign(userInfo, params, dataParams));
        Api.updateUser(Object.assign(userInfo, params, dataParams)).then((result) => {
            wx.hideLoading();
            this.setData({
                submitDisable: true
            });
            if (result.code === 200) {
                wx.showToast({
                    title: '更新成功',
                    icon: 'success',
                    duration: 1000,
                    mask: true
                });
                setTimeout(() => {
                    wx.switchTab({
                        url: `../myHome/myHome`,
                    });
                }, 1000);
            }
            else {
                utils.showModal('系统异常，请稍后再试');
            }
        });
    },
    bindBirthChange(e) {
        this.setData({
            birth: e.detail.value
        });
    },
    bindEducationChange(e) {
        const { educationArray } = this.data;
        this.setData({
            education: educationArray[e.detail.value]
        });
    },
    bindMarriageChange(e) {
        const { isMarriageArray } = this.data;
        this.setData({
            isMarriage: isMarriageArray[e.detail.value]
        });
    },
    bindHasChildChange(e) {
        const { hasChildArray } = this.data;
        this.setData({
            hasChild: hasChildArray[e.detail.value]
        });
    },
    bindWantChildChange(e) {
        const { wantChildArray } = this.data;
        this.setData({
            wantChild: wantChildArray[e.detail.value]
        });
    },
    bindHaveHouseChange(e) {
        const { haveHouseArray } = this.data;
        this.setData({
            haveHouse: haveHouseArray[e.detail.value]
        });
    },
    bindGenderChange(e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        this.setData({
            gender: parseInt(e.detail.value) + 1
        });
        console.log('parseInt(e.detail.value)', (parseInt(e.detail.value) + 1));
    },
    bindSalaryChange(e) {
        const { salaryArray } = this.data;
        this.setData({
            salary: salaryArray[e.detail.value]
        });
    },
    bindRegionChange: function (e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        let region = e.detail.value;
        this.setData({
            workProvince: region[0],
            workCity: region[1],
            workRegion: region[2],
        });
    },
    bindMultiPickerChange: function (e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        const { multiArray } = this.data;
        let multiIndex = e.detail.value;
        this.setData({
            multiIndex,
            jobGeneral: multiArray[0][multiIndex[0]],
            jobDetail: multiArray[1][multiIndex[1]],
        });
    },
    bindMultiPickerColumnChange: function (e) {
        console.log('修改的列为', e.detail.column, '，值为', e.detail.value);
        const { multiArray, multiIndex } = this.data;
        multiIndex[e.detail.column] = e.detail.value;
        if (e.detail.column === 0) {
            multiArray[1] = [];
            console.log(jobJson_1.default.data[multiIndex[0] || 0].data);
            jobJson_1.default.data[multiIndex[0] || 0].data.forEach((item) => {
                multiArray[1].push(item.name);
            });
        }
        this.setData({
            multiArray,
        });
    },
    bindDateChange: function (e) {
        console.log('picker发送选择改变，携带值为', e.detail.value);
        this.setData({
            date: e.detail.value
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZWdpc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLGlEQUFpRDtBQUNqRCwyQ0FBMkM7QUFDM0MsdURBQWdEO0FBRWhELE1BQU0sR0FBRyxHQUFHLE1BQU0sRUFBVSxDQUFDO0FBRTdCLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLFFBQVEsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUU7UUFDeEIsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsRUFBRTtRQUNWLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLEVBQUU7UUFDVixNQUFNLEVBQUUsRUFBRTtRQUNWLFFBQVEsRUFBRSxFQUFFO1FBQ1osWUFBWSxFQUFFLEVBQUU7UUFDaEIsVUFBVSxFQUFFLEVBQUU7UUFDZCxVQUFVLEVBQUUsRUFBRTtRQUNkLFNBQVMsRUFBRSxFQUFFO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixTQUFTLEVBQUUsRUFBRTtRQUNiLFVBQVUsRUFBRSxFQUFFO1FBQ2QsU0FBUyxFQUFFLEVBQUU7UUFDYixTQUFTLEVBQUUsRUFBRTtRQUNiLFdBQVcsRUFBRSxDQUFDO1FBQ2QsV0FBVyxFQUFFLENBQUM7UUFDZCxPQUFPLEVBQUUsRUFBRTtRQUNYLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGVBQWUsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDN0IsV0FBVyxFQUFFLENBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQztRQUN0QixXQUFXLEVBQUU7WUFDWCxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTTtTQUMxQztRQUNELGNBQWMsRUFBRTtZQUNkLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUk7U0FDM0M7UUFDRCxhQUFhLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ3pCLGNBQWMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7UUFDMUIsY0FBYyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztRQUM5QixVQUFVLEVBQUUsQ0FBQyxFQUFHO1FBQ2hCLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBQyxFQUFFLENBQVE7UUFDMUIsT0FBTyxFQUFFLGlCQUFPO0tBQ2pCO0lBRUQsTUFBTSxFQUFFO1FBQ04sTUFBTSxVQUFVLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFRLENBQUM7UUFDbkMsaUJBQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDakMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxpQkFBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDekMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixVQUFVO1lBQ1YsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztTQUNqQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUdELFdBQVc7UUFDVCxNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDOUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDakQsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsSUFBSSxDQUFDLE9BQVEsQ0FBQztvQkFDWixRQUFRLEVBQUUsTUFBTSxDQUFDLElBQUk7b0JBQ3JCLFFBQVEsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVE7b0JBQzlCLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU07b0JBQzFCLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO29CQUNyQyxNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNO29CQUMxQixNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNO29CQUMxQixZQUFZLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZO29CQUN0QyxRQUFRLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRO29CQUM5QixVQUFVLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVO29CQUNsQyxVQUFVLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVO29CQUNsQyxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTO29CQUNoQyxRQUFRLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRO29CQUM5QixTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTO29CQUNoQyxVQUFVLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVO29CQUNsQyxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTO29CQUNoQyxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTO2lCQUNqQyxDQUFDLENBQUM7Z0JBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2hDO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQVk7UUFDakIsTUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxRQUFRLEdBQUcsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2hELElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN6QixJQUFJLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDeEMsT0FBTyxHQUFHLElBQUksSUFBSSxRQUFRLElBQUksTUFBTSxFQUFFLENBQUE7SUFDeEMsQ0FBQztJQUdELFFBQVEsQ0FBQyxDQUFNO1FBQ2IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBRTdCLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDO1lBQy9DLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztZQUMzQyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7WUFDMUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDO1lBQzNDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztZQUMzQyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDO1lBQ3hELENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUM7WUFDbEQsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQztZQUNyRCxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDO1lBQ3BELENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUM7WUFFdEQsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxFQUFFO1lBRXRELE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFHRCxRQUFRLENBQUMsQ0FBTTtRQUNiLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QixNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUMvQixNQUFNLFVBQVUsR0FBRztZQUNqQixZQUFZLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZO1lBQ3BDLFFBQVEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFDNUIsVUFBVSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUNoQyxVQUFVLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVO1lBQ2hDLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7U0FDL0IsQ0FBQTtRQUNELElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixhQUFhLEVBQUUsSUFBSTtTQUNwQixDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQ3pELEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDL0UsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxPQUFRLENBQUM7Z0JBQ1osYUFBYSxFQUFFLElBQUk7YUFDcEIsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLEdBQUcsRUFBRTtnQkFDdkIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsTUFBTTtvQkFDYixJQUFJLEVBQUUsU0FBUztvQkFDZixRQUFRLEVBQUUsSUFBSTtvQkFDZCxJQUFJLEVBQUUsSUFBSTtpQkFDWCxDQUFDLENBQUE7Z0JBQ0YsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDZCxFQUFFLENBQUMsU0FBUyxDQUFDO3dCQUNYLEdBQUcsRUFBRSxrQkFBa0I7cUJBQ3hCLENBQUMsQ0FBQztnQkFDTCxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDVjtpQkFBTTtnQkFDTCxLQUFLLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBR0QsZUFBZSxDQUFDLENBQU07UUFDcEIsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUs7U0FDdEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELG1CQUFtQixDQUFDLENBQU07UUFDeEIsTUFBTSxFQUFFLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDMUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELGtCQUFrQixDQUFDLENBQU07UUFDdkIsTUFBTSxFQUFFLGVBQWUsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDckMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDNUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELGtCQUFrQixDQUFDLENBQU07UUFDdkIsTUFBTSxFQUFFLGFBQWEsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDbkMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDeEMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELG1CQUFtQixDQUFDLENBQU07UUFDeEIsTUFBTSxFQUFFLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDMUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELG1CQUFtQixDQUFDLENBQU07UUFDeEIsTUFBTSxFQUFFLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7UUFDcEMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDMUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUdELGdCQUFnQixDQUFDLENBQU07UUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ2hELElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztTQUNyQyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUN6RSxDQUFDO0lBR0QsZ0JBQWdCLENBQUMsQ0FBTTtRQUNyQixNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQTtRQUNqQyxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztTQUNwQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBR0QsZ0JBQWdCLEVBQUUsVUFBVSxDQUFLO1FBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNoRCxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUM1QixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDdkIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDbkIsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7U0FDdEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHFCQUFxQixFQUFFLFVBQVUsQ0FBTTtRQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakQsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDakMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDaEMsSUFBSSxDQUFDLE9BQVEsQ0FBQztZQUNaLFVBQVU7WUFDVixVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN4QyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsMkJBQTJCLEVBQUUsVUFBVSxDQUFNO1FBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdELE1BQU0sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM3QyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUM3QyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN6QixVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25ELGlCQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7Z0JBQzFELFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osVUFBVTtTQUVYLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRCxjQUFjLEVBQUUsVUFBVSxDQUFLO1FBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNoRCxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSztTQUNyQixDQUFDLENBQUE7SUFDSixDQUFDO0NBRUYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBBcGkgZnJvbSAnLi4vLi4vc2VydmljZS9hcGkuc2VydmljZSc7XG5pbXBvcnQgKiBhcyB1dGlscyBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XG5pbXBvcnQgam9iSnNvbiBmcm9tICcuLi8uLi9wdWJsaWMvanNvbi9qb2JKc29uJztcbmltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uL2FwcCc7XG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHVzZXJJbmZvOiB7IG9wZW5pZDogJycgfSxcbiAgICBuaWNrTmFtZTogJycsXG4gICAgZ2VuZGVyOiAnJywgXG4gICAgYmlydGg6ICcnLCAgICAgICAgICAgIC8vIOeUn+aXpVxuICAgIGhlaWdodDogJycsICAgICAgICAgICAvLyDouqvpq5hcbiAgICBzYWxhcnk6ICcnLCBcbiAgICB3b3JrQ2l0eTogJycsXG4gICAgd29ya1Byb3ZpbmNlOiAnJyxcbiAgICB3b3JrUmVnaW9uOiAnJyxcbiAgICBpc01hcnJpYWdlOiAnJyxcbiAgICBlZHVjYXRpb246ICcnLCBcbiAgICBoYXNDaGlsZDogJycsIFxuICAgIHdhbnRDaGlsZDogJycsIFxuICAgIGpvYkdlbmVyYWw6ICcnLFxuICAgIGpvYkRldGFpbDogJycsXG4gICAgaGF2ZUhvdXNlOiAnJywgICBcbiAgICBnZW5kZXJJbmRleDogMCxcbiAgICBzYWxhcnlJbmRleDogMCxcbiAgICBkYXRlTm93OiAnJyxcbiAgICBzdWJtaXREaXNhYmxlOiBmYWxzZSxcbiAgICBpc01hcnJpYWdlQXJyYXk6IFsn5pyq5amaJywgJ+emu+WpmiddLFxuICAgIGdlbmRlckFycmF5OiBbJ+eUtycsJ+WlsyddLFxuICAgIHNhbGFyeUFycmF5OiBbXG4gICAgICAnNeWNg+S7peS4iycsICc15Y2D772eMeS4hycsICcx5LiH772eMuS4hycsICcy5LiH772eNeS4hycsICc15LiH5Lul5LiKJ1xuICAgIF0sXG4gICAgZWR1Y2F0aW9uQXJyYXk6IFtcbiAgICAgICflsI/lraYnLCAn5Yid5LitJywgJ+mrmOS4rScsICflpKfkuJMnLCAn5aSn5a2m5pys56eRJywgJ+ehleWjqycsICfljZrlo6snXG4gICAgXSxcbiAgICBoYXNDaGlsZEFycmF5OiBbJ+aYrycsICflkKYnXSxcbiAgICB3YW50Q2hpbGRBcnJheTogWyfmmK8nLCAn5ZCmJ10sXG4gICAgaGF2ZUhvdXNlQXJyYXk6IFsn5bey5Lmw5oi/JywgJ+acquS5sOaIvyddLFxuICAgIG11bHRpSW5kZXg6IFssIF0sXG4gICAgbXVsdGlBcnJheTogW1tdLFtdXSBhcyBhbnksXG4gICAgam9iSnNvbjogam9iSnNvbixcbiAgfSxcblxuICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBtdWx0aUFycmF5ID0gW1tdLCBbXV0gYXMgYW55O1xuICAgIGpvYkpzb24uZGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICAgIG11bHRpQXJyYXlbMF0ucHVzaChpdGVtLm5hbWUpO1xuICAgIH0pO1xuICAgIGpvYkpzb24uZGF0YVswXS5kYXRhLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xuICAgICAgbXVsdGlBcnJheVsxXS5wdXNoKGl0ZW0ubmFtZSk7XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2cobXVsdGlBcnJheSk7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBtdWx0aUFycmF5LFxuICAgICAgZGF0ZU5vdzogdGhpcy5nZXRZTUQobmV3IERhdGUoKSlcbiAgICB9KTtcbiAgICB0aGlzLmdldFVzZXJJbmZvKCk7XG4gIH0sXG5cbiAgLyoqIOeUqOaIt+ivpuaDhSAqL1xuICBnZXRVc2VySW5mbygpIHtcbiAgICBjb25zdCBvcGVuaWQgPSBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby5vcGVuaWQ7XG4gICAgQXBpLmdldFVzZXJJbmZvKG9wZW5pZCB8fCAnJykudGhlbigocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgdXNlckluZm86IHJlc3VsdC5kYXRhLFxuICAgICAgICAgIG5pY2tOYW1lOiByZXN1bHQuZGF0YS5uaWNrTmFtZSxcbiAgICAgICAgICBnZW5kZXI6IHJlc3VsdC5kYXRhLmdlbmRlcixcbiAgICAgICAgICBiaXJ0aDogdGhpcy5nZXRZTUQocmVzdWx0LmRhdGEuYmlydGgpLCAgICAgICAgLy8g55Sf5pelXG4gICAgICAgICAgaGVpZ2h0OiByZXN1bHQuZGF0YS5oZWlnaHQsICAgICAgICAgICAgICAgICAgIC8vIOi6q+mrmFxuICAgICAgICAgIHNhbGFyeTogcmVzdWx0LmRhdGEuc2FsYXJ5LFxuICAgICAgICAgIHdvcmtQcm92aW5jZTogcmVzdWx0LmRhdGEud29ya1Byb3ZpbmNlLFxuICAgICAgICAgIHdvcmtDaXR5OiByZXN1bHQuZGF0YS53b3JrQ2l0eSxcbiAgICAgICAgICB3b3JrUmVnaW9uOiByZXN1bHQuZGF0YS53b3JrUmVnaW9uLCAgICAgICAgXG4gICAgICAgICAgaXNNYXJyaWFnZTogcmVzdWx0LmRhdGEuaXNNYXJyaWFnZSwgICAgICAgICAgIC8vIOWpmuWnu+eKtuWGtVxuICAgICAgICAgIGVkdWNhdGlvbjogcmVzdWx0LmRhdGEuZWR1Y2F0aW9uLCAgICAgICAgICAgICAvLyDmlZnogrJcbiAgICAgICAgICBoYXNDaGlsZDogcmVzdWx0LmRhdGEuaGFzQ2hpbGQsXG4gICAgICAgICAgd2FudENoaWxkOiByZXN1bHQuZGF0YS53YW50Q2hpbGQsXG4gICAgICAgICAgam9iR2VuZXJhbDogcmVzdWx0LmRhdGEuam9iR2VuZXJhbCxcbiAgICAgICAgICBqb2JEZXRhaWw6IHJlc3VsdC5kYXRhLmpvYkRldGFpbCxcbiAgICAgICAgICBoYXZlSG91c2U6IHJlc3VsdC5kYXRhLmhhdmVIb3VzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdkYXRhJywgdGhpcy5kYXRhKTtcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIGdldFlNRChkYXRlU3RyOiBhbnkpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cik7XG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICBsZXQgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICAgIGxldCBtb250aFN0ciA9IG1vbnRoIDw9IDkgPyBgMCR7bW9udGh9YCA6IG1vbnRoO1xuICAgIGxldCBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICBsZXQgZGF5U3RyID0gZGF5IDw9IDkgPyBgMCR7ZGF5fWAgOiBkYXk7XG4gICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGhTdHJ9LSR7ZGF5U3RyfWBcbiAgfSxcblxuICAvKiog5YeG5aSH5o+Q5LqkICovXG4gIG9uU3VibWl0KGU6IGFueSk6IGFueSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHZhbHVlID0gZS5kZXRhaWwudmFsdWU7XG5cbiAgICBpZiAoIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUubmlja05hbWUsICfor7fovpPlhaXmmLXnp7AnKSB8fFxuICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUuZ2VuZGVyLCAn6K+36YCJ5oup5oCn5YirJykgfHxcbiAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHZhbHVlLmJpcnRoLCAn6K+36YCJ5oup55Sf5pelJykgfHxcbiAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHZhbHVlLmhlaWdodCwgJ+ivt+i+k+WFpei6q+mrmCcpIHx8XG4gICAgICAhdXRpbHMudmFsaWRhdGVFbXB0eSh2YWx1ZS5zYWxhcnksICfor7fpgInmi6nmlLblhaUnKSB8fFxuICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodGhpcy5kYXRhLndvcmtQcm92aW5jZSwgJ+ivt+mAieaLqeW3peS9nOaJgOWcqOWcsCcpIHx8XG4gICAgICAhdXRpbHMudmFsaWRhdGVFbXB0eSh0aGlzLmRhdGEuZWR1Y2F0aW9uLCAn6K+36YCJ5oup5a2m5Y6GJykgfHxcbiAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHRoaXMuZGF0YS5pc01hcnJpYWdlLCAn6K+36YCJ5oup5ama5ae754q25Ya1JykgfHxcbiAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHRoaXMuZGF0YS5oYXNDaGlsZCwgJ+ivt+mAieaLqeaYr+WQpuacieWtqeWtkCcpIHx8XG4gICAgICAhdXRpbHMudmFsaWRhdGVFbXB0eSh0aGlzLmRhdGEud2FudENoaWxkLCAn6K+36YCJ5oup5piv5ZCm5oOz6KaB5a2p5a2QJykgfHxcbiAgICAgIC8vICF1dGlscy52YWxpZGF0ZUVtcHR5KHRoaXMuZGF0YS5qb2JHZW5lcmFsLCAn6K+36YCJ5oup6IGM5LiaJykgfHxcbiAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHRoaXMuZGF0YS5oYXZlSG91c2UsICfor7fpgInmi6nkubDmiL/mg4XlhrUnKSkge1xuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhhdC5kb1N1Ym1pdChlKTtcbiAgfSxcblxuICAvKiogdXBkYXRlICovXG4gIGRvU3VibWl0KGU6IGFueSkge1xuICAgIGNvbnN0IHBhcmFtcyA9IGUuZGV0YWlsLnZhbHVlO1xuICAgIGNvbnNvbGUubG9nKGUuZGV0YWlsLnZhbHVlKTtcbiAgICBjb25zdCB7IHVzZXJJbmZvIH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgZGF0YVBhcmFtcyA9IHtcbiAgICAgIHdvcmtQcm92aW5jZTogdGhpcy5kYXRhLndvcmtQcm92aW5jZSxcbiAgICAgIHdvcmtDaXR5OiB0aGlzLmRhdGEud29ya0NpdHksXG4gICAgICB3b3JrUmVnaW9uOiB0aGlzLmRhdGEud29ya1JlZ2lvbixcbiAgICAgIGpvYkdlbmVyYWw6IHRoaXMuZGF0YS5qb2JHZW5lcmFsLFxuICAgICAgam9iRGV0YWlsOiB0aGlzLmRhdGEuam9iRGV0YWlsLFxuICAgIH1cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHN1Ym1pdERpc2FibGU6IHRydWVcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyhPYmplY3QuYXNzaWduKHVzZXJJbmZvLCBwYXJhbXMsIGRhdGFQYXJhbXMpKTtcbiAgICBBcGkudXBkYXRlVXNlcihPYmplY3QuYXNzaWduKHVzZXJJbmZvLCBwYXJhbXMsIGRhdGFQYXJhbXMpKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKTsgXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgc3VibWl0RGlzYWJsZTogdHJ1ZVxuICAgICAgfSk7ICAgICBcbiAgICAgIGlmIChyZXN1bHQuY29kZSA9PT0gMjAwKSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6ICfmm7TmlrDmiJDlip8nLFxuICAgICAgICAgIGljb246ICdzdWNjZXNzJyxcbiAgICAgICAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAgICAgICBtYXNrOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHd4LnN3aXRjaFRhYih7XG4gICAgICAgICAgICB1cmw6IGAuLi9teUhvbWUvbXlIb21lYCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1dGlscy5zaG93TW9kYWwoJ+ezu+e7n+W8guW4uO+8jOivt+eojeWQjuWGjeivlScpO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOeUn+aXpSAqL1xuICBiaW5kQmlydGhDaGFuZ2UoZTogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBiaXJ0aDogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuXG4gIGJpbmRFZHVjYXRpb25DaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc3QgeyBlZHVjYXRpb25BcnJheSB9ID0gdGhpcy5kYXRhXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBlZHVjYXRpb246IGVkdWNhdGlvbkFycmF5W2UuZGV0YWlsLnZhbHVlXVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOWpmuWnuyAqL1xuICBiaW5kTWFycmlhZ2VDaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc3QgeyBpc01hcnJpYWdlQXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaXNNYXJyaWFnZTogaXNNYXJyaWFnZUFycmF5W2UuZGV0YWlsLnZhbHVlXVxuICAgIH0pXG4gIH0sXG5cbiAgYmluZEhhc0NoaWxkQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgaGFzQ2hpbGRBcnJheSB9ID0gdGhpcy5kYXRhXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBoYXNDaGlsZDogaGFzQ2hpbGRBcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIGJpbmRXYW50Q2hpbGRDaGFuZ2UoZTogYW55KSB7XG4gICAgY29uc3QgeyB3YW50Q2hpbGRBcnJheSB9ID0gdGhpcy5kYXRhXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICB3YW50Q2hpbGQ6IHdhbnRDaGlsZEFycmF5W2UuZGV0YWlsLnZhbHVlXVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOS5sOaIvyAqL1xuICBiaW5kSGF2ZUhvdXNlQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgaGF2ZUhvdXNlQXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaGF2ZUhvdXNlOiBoYXZlSG91c2VBcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIC8qKiDmgKfliKsgKi9cbiAgYmluZEdlbmRlckNoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygncGlja2Vy5Y+R6YCB6YCJ5oup5pS55Y+Y77yM5pC65bim5YC85Li6JywgZS5kZXRhaWwudmFsdWUpXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBnZW5kZXI6IHBhcnNlSW50KGUuZGV0YWlsLnZhbHVlKSArIDFcbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZygncGFyc2VJbnQoZS5kZXRhaWwudmFsdWUpJywgKHBhcnNlSW50KGUuZGV0YWlsLnZhbHVlKSArIDEpKVxuICB9LFxuXG4gIC8qKiDmnIjmlLblhaUgKi9cbiAgYmluZFNhbGFyeUNoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IHNhbGFyeUFycmF5IH0gPSB0aGlzLmRhdGFcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHNhbGFyeTogc2FsYXJ5QXJyYXlbZS5kZXRhaWwudmFsdWVdXG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqIOW3peS9nOWcsOWMuiAqL1xuICBiaW5kUmVnaW9uQ2hhbmdlOiBmdW5jdGlvbiAoZTphbnkpIHtcbiAgICBjb25zb2xlLmxvZygncGlja2Vy5Y+R6YCB6YCJ5oup5pS55Y+Y77yM5pC65bim5YC85Li6JywgZS5kZXRhaWwudmFsdWUpXG4gICAgbGV0IHJlZ2lvbiA9IGUuZGV0YWlsLnZhbHVlO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgd29ya1Byb3ZpbmNlOiByZWdpb25bMF0sXG4gICAgICB3b3JrQ2l0eTogcmVnaW9uWzFdLFxuICAgICAgd29ya1JlZ2lvbjogcmVnaW9uWzJdLFxuICAgIH0pO1xuICB9LFxuXG4gIGJpbmRNdWx0aVBpY2tlckNoYW5nZTogZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKCdwaWNrZXLlj5HpgIHpgInmi6nmlLnlj5jvvIzmkLrluKblgLzkuLonLCBlLmRldGFpbC52YWx1ZSk7XG4gICAgY29uc3QgeyBtdWx0aUFycmF5IH0gPSB0aGlzLmRhdGE7XG4gICAgbGV0IG11bHRpSW5kZXggPSBlLmRldGFpbC52YWx1ZTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIG11bHRpSW5kZXgsXG4gICAgICBqb2JHZW5lcmFsOiBtdWx0aUFycmF5WzBdW211bHRpSW5kZXhbMF1dLFxuICAgICAgam9iRGV0YWlsOiBtdWx0aUFycmF5WzFdW211bHRpSW5kZXhbMV1dLFxuICAgIH0pXG4gIH0sXG5cbiAgYmluZE11bHRpUGlja2VyQ29sdW1uQ2hhbmdlOiBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coJ+S/ruaUueeahOWIl+S4uicsIGUuZGV0YWlsLmNvbHVtbiwgJ++8jOWAvOS4uicsIGUuZGV0YWlsLnZhbHVlKTtcbiAgICBjb25zdCB7IG11bHRpQXJyYXksIG11bHRpSW5kZXggfSA9IHRoaXMuZGF0YTtcbiAgICBtdWx0aUluZGV4W2UuZGV0YWlsLmNvbHVtbl0gPSBlLmRldGFpbC52YWx1ZTtcbiAgICBpZiAoZS5kZXRhaWwuY29sdW1uID09PSAwKSB7XG4gICAgICBtdWx0aUFycmF5WzFdID0gW107XG4gICAgICBjb25zb2xlLmxvZyhqb2JKc29uLmRhdGFbbXVsdGlJbmRleFswXSB8fCAwXS5kYXRhKTtcbiAgICAgIGpvYkpzb24uZGF0YVttdWx0aUluZGV4WzBdIHx8IDBdLmRhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIG11bHRpQXJyYXlbMV0ucHVzaChpdGVtLm5hbWUpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgbXVsdGlBcnJheSxcbiAgICAgIC8vIG11bHRpSW5kZXgsXG4gICAgfSk7XG4gIH0sXG4gIGJpbmREYXRlQ2hhbmdlOiBmdW5jdGlvbiAoZTphbnkpIHtcbiAgICBjb25zb2xlLmxvZygncGlja2Vy5Y+R6YCB6YCJ5oup5pS55Y+Y77yM5pC65bim5YC85Li6JywgZS5kZXRhaWwudmFsdWUpXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBkYXRlOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gXG59KSJdfQ==
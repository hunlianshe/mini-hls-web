"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const apiServicePro = require("../../service/api.service");
const oss_1 = require("../../utils/oss");
const config_1 = require("../../config");
const utils = require("../../utils/utils");
Page({
    data: {
        user: { openid: '' },
        carId: '',
        shopId: '',
        brand: '',
        brandDetail: '',
        price: '',
        birthday: '',
        height: '',
        transfersNumber: '',
        isMarriage: '未婚',
        sex: '',
        education: '',
        hasChild: '',
        wantChild: '',
        job: '',
        house: '',
        sexIndex: 0,
        note: '',
        leftLenth: 300,
        indexImage: '',
        uploadIndexPath: '',
        oldImages: [],
        uploadImgs: [],
        count: 9,
        city: '',
        selectValue: '',
        cityList: [],
        hotCityList: [],
        popHidden: true,
        brandList: [],
        hotBrandList: [],
        dateNow: '',
        popHiddenBrand: true,
        submitDisable: false,
        isMarriageArray: ['未婚', '离异'],
        sexArray: ['男', '女'],
        salaryArray: [
            '5千以下', '5千～1万', '1万～2万', '2万～5万', '5万以上'
        ],
        educationArray: [
            '小学', '初中', '高中', '大专', '大学本科', '硕士', '博士'
        ],
        hasChildArray: ['是', '否'],
        wantChildArray: ['是', '否'],
        houseArray: ['已买', '未买'],
    },
    onLoad: function (options) {
        let _this = this;
        wx.getStorage({
            key: 'user',
            success: function (res) {
                _this.setData({
                    user: res.data
                });
            },
        });
        if (options.carId) {
            _this.getCarDetail(options.carId);
        }
        _this.setData({
            shopId: options.shopId,
            carId: options.carId || ''
        });
        this.setData({
            dateNow: this.getYMD(new Date())
        });
    },
    getCarDetail(id) {
        apiServicePro.getUserDetail(id).then((result) => {
            if (result) {
                this.setData({
                    brand: result.data.brand,
                    brandDetail: result.data.brandDetail,
                    city: result.data.city,
                    price: result.data.price,
                    birthday: this.getYMD(result.data.birthday),
                    height: result.data.height,
                    transfersNumber: result.data.transfersNumber,
                    isMarriage: result.data.isMarriage,
                    education: result.data.education,
                    sex: result.data.sex,
                    note: result.data.note,
                    indexImage: result.data.indexImage,
                    oldImages: result.data.images,
                });
            }
        });
    },
    getYMD(dateStr) {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        let month = date.getMonth() + 1;
        let monthStr = month <= 9 ? `0${month}` : month;
        let day = date.getDate();
        let dayStr = day <= 9 ? `0${day}` : day;
        return `${year}-${monthStr}-${dayStr}`;
    },
    onSubmit(e) {
        let that = this;
        const value = e.detail.value;
        const openid = this.data.user.openid;
        const aliyunServerURL = config_1.default.uploadImageUrl;
        if (!utils.validateEmpty(value.brand, '请选择品牌车系') ||
            !utils.validateEmpty(value.birthday, '请选择上牌日期') ||
            !utils.validateEmpty(value.height, '请输入行驶里程') ||
            !utils.validateEmpty(value.city, '请输选择牌照所在地') ||
            !utils.validateEmpty(value.price, '请输入价格') ||
            !utils.validateEmpty(value.transfersNumber, '请输入过户次数') ||
            !utils.validateEmpty(value.sex, '请选择车况') ||
            !utils.validateEmpty(this.data.indexImage, '请上传汽车首页照片') ||
            !utils.validateImages(this.data.oldImages.concat(this.data.uploadImgs), '请上传汽车照片')) {
            return false;
        }
        let indexImage = this.data.indexImage;
        let uploadIndexPath = this.data.uploadIndexPath;
        if (uploadIndexPath !== '') {
            oss_1.default({
                filePath: indexImage,
                dir: `images/shop/${openid}/` + indexImage.replace('http://tmp/', ''),
                success: function (res) {
                    indexImage = `${aliyunServerURL}/${res}`;
                    that.uploadAndSubmit(e, indexImage);
                },
                fail: function () {
                    that.uploadAndSubmit(e, indexImage);
                }
            });
        }
        else {
            that.uploadAndSubmit(e, indexImage);
        }
    },
    uploadAndSubmit(e, indexImage) {
        const openid = this.data.user.openid;
        const aliyunServerURL = config_1.default.uploadImageUrl;
        let that = this;
        let count = 0;
        let images = [];
        const uploadImgs = this.data.uploadImgs;
        wx.showLoading({
            title: '',
        });
        if (uploadImgs.length > 0) {
            for (let i = 0; i < uploadImgs.length; i++) {
                let filePath = uploadImgs[i];
                oss_1.default({
                    filePath: filePath,
                    dir: `images/shop/${openid}/` + filePath.replace('http://tmp/', ''),
                    success: function (res) {
                        count++;
                        images.push(`${aliyunServerURL}/${res}`);
                        if (count === uploadImgs.length) {
                            if (that.data.carId !== '') {
                                images = images.concat(that.data.oldImages);
                                that.updateCar(e, indexImage, images, that.data.carId);
                            }
                            else {
                                that.doSubmit(e, indexImage, images);
                            }
                        }
                        else {
                        }
                    },
                    fail: function () {
                        wx.hideLoading();
                    }
                });
            }
        }
        else {
            if (that.data.carId !== '') {
                images = images.concat(that.data.oldImages);
                that.updateCar(e, indexImage, images, that.data.carId);
            }
            else {
                that.doSubmit(e, indexImage, images);
            }
            wx.hideLoading();
        }
    },
    doSubmit(e, indexImage, images) {
        const params = e.detail.value;
        this.setData({
            submitDisable: true
        });
        apiServicePro.register(Object.assign({ images, indexImage }, params)).then((result) => {
            wx.hideLoading();
            this.setData({
                submitDisable: true
            });
            if (result.code === 200) {
                wx.navigateTo({
                    url: `../carDetail/carDetail?id=${result.data.id}&from=creatCarPage`,
                });
            }
            else if (result.code === 1202) {
                utils.showModal('信息校验不通过，请核对汽车信息');
            }
            else {
                utils.showModal();
            }
        });
    },
    updateCar(e, indexImage, images, carId) {
        const value = e.detail.value;
        const params = Object.assign(value, { 'id': carId });
        this.setData({
            submitDisable: true
        });
        apiServicePro.updateUser(Object.assign({ images, indexImage }, params)).then((result) => {
            wx.hideLoading();
            this.setData({
                submitDisable: true
            });
            if (result.code === 200) {
                wx.navigateTo({
                    url: `../carDetail/carDetail?id=${result.data.id}&from=creatCarPage`,
                });
            }
            else if (result.code === 1202) {
                utils.showModal('信息校验不通过，请核对汽车信息');
            }
            else {
                utils.showModal();
            }
        });
    },
    delImage(e) {
        const array = e.currentTarget.dataset.array;
        const index = e.currentTarget.dataset.index;
        if (array === 'oldImages') {
            const oldImages = this.data.oldImages;
            oldImages.splice(index, 1);
            this.setData({
                oldImages
            });
        }
        else {
            const uploadImgs = this.data.uploadImgs;
            uploadImgs.splice(index, 1);
            this.setData({
                uploadImgs
            });
        }
    },
    chooseIndexImage() {
        this.chooseImage(1, 'one');
    },
    chooseOtherImage(e) {
        const selectPictureNum = e.target.dataset.num;
        let count = 99 - selectPictureNum;
        this.chooseImage(count, 'multi');
    },
    chooseImage(count, type) {
        const that = this;
        wx.chooseImage({
            count: count,
            sizeType: ['original', 'compressed'],
            sourceType: ['album', 'camera'],
            success: function (res) {
                let uploadImgs = that.data.uploadImgs;
                if (type === 'multi') {
                    that.setData({
                        uploadImgs: uploadImgs.concat(res.tempFilePaths),
                    });
                }
                else {
                    that.setData({
                        uploadIndexPath: res.tempFilePaths[0],
                        indexImage: res.tempFilePaths[0],
                    });
                }
            },
        });
    },
    popPicker() {
        let popHidden = this.data.popHidden;
        this.setData({
            popHidden: !popHidden,
        });
    },
    doSelect(e) {
        if (e.detail.name) {
            this.setData({
                popHidden: true,
                city: e.detail.name,
            });
            wx.setStorage({
                key: 'city',
                data: e.detail.name,
            });
        }
        else {
            this.setData({
                popHidden: true,
            });
        }
    },
    popBrand() {
        let popHiddenBrand = this.data.popHiddenBrand;
        this.setData({
            popHiddenBrand: !popHiddenBrand,
        });
    },
    doSelectBrand(e) {
        if (e.detail.brand) {
            this.setData({
                popHiddenBrand: true,
                brand: e.detail.brand,
                brandDetail: e.detail.brandDetail,
            });
            wx.setStorage({
                key: 'brand',
                data: e.detail.brand,
            });
        }
        else {
            this.setData({
                popHiddenBrand: true,
            });
        }
    },
    bindDateChange(e) {
        this.setData({
            birthday: e.detail.value
        });
    },
    bindEducationChange(e) {
        const { educationArray } = this.data;
        this.setData({
            education: educationArray[e.detail.value]
        });
    },
    bindMarriageChange(e) {
        const { isMarriageArray } = this.data;
        this.setData({
            isMarriage: isMarriageArray[e.detail.value]
        });
    },
    bindHasChildChange(e) {
        const { hasChildArray } = this.data;
        this.setData({
            hasChild: hasChildArray[e.detail.value]
        });
    },
    bindWantChildChange(e) {
        const { wantChildArray } = this.data;
        this.setData({
            hasChild: wantChildArray[e.detail.value]
        });
    },
    bindHouseChange(e) {
        const { houseArray } = this.data;
        this.setData({
            house: houseArray[e.detail.value]
        });
    },
    bindSexChange(e) {
        const { sexArray } = this.data;
        this.setData({
            sex: sexArray[e.detail.value]
        });
    },
    bindSalaryChange(e) {
        const { salaryArray } = this.data;
        this.setData({
            salary: salaryArray[e.detail.value]
        });
    },
    inputNote(e) {
        const leftLenth = (300 - e.detail.value.length);
        this.setData({
            leftLenth: leftLenth > 0 ? leftLenth : 0
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZWdpc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDJEQUEyRDtBQUMzRCx5Q0FBMkM7QUFDM0MseUNBQStCO0FBQy9CLDJDQUEyQztBQUUzQyxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1FBQ3BCLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLEVBQUU7UUFDVixLQUFLLEVBQUUsRUFBRTtRQUNULFdBQVcsRUFBRSxFQUFFO1FBQ2YsS0FBSyxFQUFFLEVBQUU7UUFDVCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU0sRUFBRSxFQUFFO1FBQ1YsZUFBZSxFQUFFLEVBQUU7UUFDbkIsVUFBVSxFQUFFLElBQUk7UUFDaEIsR0FBRyxFQUFFLEVBQUU7UUFDUCxTQUFTLEVBQUUsRUFBRTtRQUNiLFFBQVEsRUFBRSxFQUFFO1FBQ1osU0FBUyxFQUFFLEVBQUU7UUFDYixHQUFHLEVBQUUsRUFBRTtRQUNQLEtBQUssRUFBRSxFQUFFO1FBQ1QsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLFNBQVMsRUFBRSxHQUFHO1FBQ2QsVUFBVSxFQUFFLEVBQUU7UUFDZCxlQUFlLEVBQUUsRUFBRTtRQUNuQixTQUFTLEVBQUUsRUFBRTtRQUNiLFVBQVUsRUFBRSxFQUFFO1FBQ2QsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLEVBQUUsRUFBRTtRQUVSLFdBQVcsRUFBRSxFQUFFO1FBQ2YsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLFNBQVMsRUFBRSxJQUFJO1FBQ2YsU0FBUyxFQUFFLEVBQUU7UUFDYixZQUFZLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsRUFBRTtRQUNYLGNBQWMsRUFBRSxJQUFJO1FBQ3BCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGVBQWUs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RCxhQUFhLENBQUMsQ0FBTTtRQUNsQixNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQTtRQUM5QixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztTQUM5QixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsZ0JBQWdCLENBQUMsQ0FBTTtRQUNyQixNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQTtRQUNqQyxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztTQUNwQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsU0FBUyxDQUFDLENBQU07UUFDZCxNQUFNLFNBQVMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoRCxJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1osU0FBUyxFQUFFLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN6QyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBS0QsT0FBTyxFQUFFO0lBRVQsQ0FBQztJQUtELE1BQU0sRUFBRTtJQUNSLENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsUUFBUSxFQUFFO0lBRVYsQ0FBQztJQUtELGlCQUFpQixFQUFFO0lBRW5CLENBQUM7SUFLRCxhQUFhLEVBQUU7SUFFZixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvY3JlYXRlQ2FyL2NyZWF0ZUNhci5qc1xuaW1wb3J0ICogYXMgYXBpU2VydmljZVBybyBmcm9tICcuLi8uLi9zZXJ2aWNlL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB1cGxvYWRJbWFnZSAgZnJvbSAnLi4vLi4vdXRpbHMvb3NzJztcbmltcG9ydCBlbnYgZnJvbSAnLi4vLi4vY29uZmlnJztcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICB1c2VyOiB7IG9wZW5pZDogJycgfSxcbiAgICBjYXJJZDogJycsXG4gICAgc2hvcElkOiAnJyxcbiAgICBicmFuZDogJycsICAgICAgICAgICAgLy8g5ZOB54mMXG4gICAgYnJhbmREZXRhaWw6ICcnLCAgICAgIC8vIOS6jOe6p+i9puezu1xuICAgIHByaWNlOiAnJywgICAgICAgICAgICAvLyDku7fmoLxcbiAgICBiaXJ0aGRheTogJycsICAgICAgICAgLy8g5LiK54mM5pe26Ze0XG4gICAgaGVpZ2h0OiAnJywgICAgICAgIC8vIOihjOmptumHjOeoi1xuICAgIHRyYW5zZmVyc051bWJlcjogJycsICAvLyDov4fmiLfmrKHmlbBcbiAgICBpc01hcnJpYWdlOiAn5pyq5amaJyxcbiAgICBzZXg6ICcnLCBcbiAgICBlZHVjYXRpb246ICcnLCBcbiAgICBoYXNDaGlsZDogJycsIFxuICAgIHdhbnRDaGlsZDogJycsIFxuICAgIGpvYjogJycsXG4gICAgaG91c2U6ICcnLCAgIFxuICAgIHNleEluZGV4OiAwLFxuICAgIG5vdGU6ICcnLFxuICAgIGxlZnRMZW50aDogMzAwLFxuICAgIGluZGV4SW1hZ2U6ICcnLFxuICAgIHVwbG9hZEluZGV4UGF0aDogJycsXG4gICAgb2xkSW1hZ2VzOiBbXSwgICAgICAgIC8vIOabtOaWsOaxvei9puWbvueJh1xuICAgIHVwbG9hZEltZ3M6IFtdLCAgICAgICAvLyDlm77niYdcbiAgICBjb3VudDogOSxcbiAgICBjaXR5OiAnJywgICAgICAgICAgICAgLy8g5LiK54mM5Zyw54K5XG4gICAgLy8gY2l0eUlkOiAnJyxcbiAgICBzZWxlY3RWYWx1ZTogJycsXG4gICAgY2l0eUxpc3Q6IFtdLFxuICAgIGhvdENpdHlMaXN0OiBbXSxcbiAgICBwb3BIaWRkZW46IHRydWUsXG4gICAgYnJhbmRMaXN0OiBbXSxcbiAgICBob3RCcmFuZExpc3Q6IFtdLFxuICAgIGRhdGVOb3c6ICcnLFxuICAgIHBvcEhpZGRlbkJyYW5kOiB0cnVlLFxuICAgIHN1Ym1pdERpc2FibGU6IGZhbHNlLFxuICAgIGlzTWFycmlhZ2VBcnJheTogWyfmnKrlqZonLCAn56a75byCJ10sXG4gICAgc2V4QXJyYXk6IFsn55S3Jywn5aWzJ10sXG4gICAgc2FsYXJ5QXJyYXk6IFtcbiAgICAgICc15Y2D5Lul5LiLJywgJzXljYPvvZ4x5LiHJywgJzHkuIfvvZ4y5LiHJywgJzLkuIfvvZ415LiHJywgJzXkuIfku6XkuIonXG4gICAgXSxcbiAgICBlZHVjYXRpb25BcnJheTogW1xuICAgICAgJ+Wwj+WtpicsICfliJ3kuK0nLCAn6auY5LitJywgJ+Wkp+S4kycsICflpKflrabmnKznp5EnLCAn56GV5aOrJywgJ+WNmuWjqydcbiAgICBdLFxuICAgIGhhc0NoaWxkQXJyYXk6IFsn5pivJywgJ+WQpiddLFxuICAgIHdhbnRDaGlsZEFycmF5OiBbJ+aYrycsICflkKYnXSxcbiAgICBob3VzZUFycmF5OiBbJ+W3suS5sCcsICfmnKrkubAnXSxcbiAgfSxcblxuICAvKipcbiAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAqL1xuICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zOiBhbnkpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIHd4LmdldFN0b3JhZ2Uoe1xuICAgICAga2V5OiAndXNlcicsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIF90aGlzLnNldERhdGEhKHtcbiAgICAgICAgICB1c2VyOiByZXMuZGF0YVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICB9KTsgIFxuICAgIGlmIChvcHRpb25zLmNhcklkKSB7XG4gICAgICBfdGhpcy5nZXRDYXJEZXRhaWwob3B0aW9ucy5jYXJJZCk7XG4gICAgfVxuICAgIF90aGlzLnNldERhdGEhKHtcbiAgICAgIHNob3BJZDogb3B0aW9ucy5zaG9wSWQsXG4gICAgICBjYXJJZDogb3B0aW9ucy5jYXJJZCB8fCAnJ1xuICAgIH0pO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgZGF0ZU5vdzogdGhpcy5nZXRZTUQobmV3IERhdGUoKSlcbiAgICB9KTtcbiAgfSxcblxuICAvKiog5rG96L2m6K+m5oOFICovXG4gIGdldENhckRldGFpbChpZDogYW55KSB7XG4gICAgYXBpU2VydmljZVByby5nZXRVc2VyRGV0YWlsKGlkKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICBicmFuZDogcmVzdWx0LmRhdGEuYnJhbmQsXG4gICAgICAgICAgYnJhbmREZXRhaWw6IHJlc3VsdC5kYXRhLmJyYW5kRGV0YWlsLCAgICAgICAgIC8vIOS6jOe6p+i9puezu1xuICAgICAgICAgIGNpdHk6IHJlc3VsdC5kYXRhLmNpdHksXG4gICAgICAgICAgcHJpY2U6IHJlc3VsdC5kYXRhLnByaWNlLCAgICAgICAgICAgICAgICAgICAgIC8vIOS7t+agvFxuICAgICAgICAgIGJpcnRoZGF5OiB0aGlzLmdldFlNRChyZXN1bHQuZGF0YS5iaXJ0aGRheSksICAvLyDnlJ/ml6VcbiAgICAgICAgICBoZWlnaHQ6IHJlc3VsdC5kYXRhLmhlaWdodCwgICAgICAgICAgICAgICAgICAgLy8g6Lqr6auYXG4gICAgICAgICAgdHJhbnNmZXJzTnVtYmVyOiByZXN1bHQuZGF0YS50cmFuc2ZlcnNOdW1iZXIsIC8vIOi/h+aIt+asoeaVsFxuICAgICAgICAgIGlzTWFycmlhZ2U6IHJlc3VsdC5kYXRhLmlzTWFycmlhZ2UsICAgICAgICAgICAvLyDlqZrlp7vnirblhrVcbiAgICAgICAgICBlZHVjYXRpb246IHJlc3VsdC5kYXRhLmVkdWNhdGlvbiwgICAgICAgICAgICAgLy8g5pWZ6IKyXG4gICAgICAgICAgc2V4OiByZXN1bHQuZGF0YS5zZXgsICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaAp+WIq1xuICAgICAgICAgIG5vdGU6IHJlc3VsdC5kYXRhLm5vdGUsICAgICAgICAgICAgICAgICAgICAgICAvLyDooaXlhYVcbiAgICAgICAgICBpbmRleEltYWdlOiByZXN1bHQuZGF0YS5pbmRleEltYWdlLFxuICAgICAgICAgIG9sZEltYWdlczogcmVzdWx0LmRhdGEuaW1hZ2VzLCAgICAgICAgICAgICAgICAvLyDlm77niYdcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuXG4gIGdldFlNRChkYXRlU3RyOiBhbnkpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cik7XG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICBsZXQgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICAgIGxldCBtb250aFN0ciA9IG1vbnRoIDw9IDkgPyBgMCR7bW9udGh9YCA6IG1vbnRoO1xuICAgIGxldCBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICBsZXQgZGF5U3RyID0gZGF5IDw9IDkgPyBgMCR7ZGF5fWAgOiBkYXk7XG4gICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGhTdHJ9LSR7ZGF5U3RyfWBcbiAgfSxcblxuICAvKiog5YeG5aSH5o+Q5LqkICovXG4gIG9uU3VibWl0KGU6IGFueSk6IGFueSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHZhbHVlID0gZS5kZXRhaWwudmFsdWU7XG4gICAgY29uc3Qgb3BlbmlkID0gdGhpcy5kYXRhLnVzZXIub3BlbmlkO1xuICAgIGNvbnN0IGFsaXl1blNlcnZlclVSTCA9IGVudi51cGxvYWRJbWFnZVVybDtcblxuICAgIGlmICghdXRpbHMudmFsaWRhdGVFbXB0eSh2YWx1ZS5icmFuZCwgJ+ivt+mAieaLqeWTgeeJjOi9puezuycpIHx8XG4gICAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHZhbHVlLmJpcnRoZGF5LCAn6K+36YCJ5oup5LiK54mM5pel5pyfJykgfHxcbiAgICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUuaGVpZ2h0LCAn6K+36L6T5YWl6KGM6am26YeM56iLJykgfHxcbiAgICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUuY2l0eSwgJ+ivt+i+k+mAieaLqeeJjOeFp+aJgOWcqOWcsCcpIHx8XG4gICAgICAgICF1dGlscy52YWxpZGF0ZUVtcHR5KHZhbHVlLnByaWNlLCAn6K+36L6T5YWl5Lu35qC8JykgfHxcbiAgICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUudHJhbnNmZXJzTnVtYmVyLCAn6K+36L6T5YWl6L+H5oi35qyh5pWwJykgfHxcbiAgICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodmFsdWUuc2V4LCAn6K+36YCJ5oup6L2m5Ya1JykgfHxcbiAgICAgICAgIXV0aWxzLnZhbGlkYXRlRW1wdHkodGhpcy5kYXRhLmluZGV4SW1hZ2UsICfor7fkuIrkvKDmsb3ovabpppbpobXnhafniYcnKSB8fFxuICAgICAgICAhdXRpbHMudmFsaWRhdGVJbWFnZXModGhpcy5kYXRhLm9sZEltYWdlcy5jb25jYXQodGhpcy5kYXRhLnVwbG9hZEltZ3MpLCAn6K+35LiK5Lyg5rG96L2m54Wn54mHJykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBsZXQgaW5kZXhJbWFnZSA9IHRoaXMuZGF0YS5pbmRleEltYWdlO1xuICAgIGxldCB1cGxvYWRJbmRleFBhdGggPSB0aGlzLmRhdGEudXBsb2FkSW5kZXhQYXRoO1xuICAgIGlmICh1cGxvYWRJbmRleFBhdGggIT09ICcnKSB7XG4gICAgICB1cGxvYWRJbWFnZSh7XG4gICAgICAgIGZpbGVQYXRoOiBpbmRleEltYWdlLFxuICAgICAgICBkaXI6IGBpbWFnZXMvc2hvcC8ke29wZW5pZH0vYCArIGluZGV4SW1hZ2UucmVwbGFjZSgnaHR0cDovL3RtcC8nLCAnJyksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXM6IGFueSkge1xuICAgICAgICAgIGluZGV4SW1hZ2UgPSBgJHthbGl5dW5TZXJ2ZXJVUkx9LyR7cmVzfWA7XG4gICAgICAgICAgdGhhdC51cGxvYWRBbmRTdWJtaXQoZSwgaW5kZXhJbWFnZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aGF0LnVwbG9hZEFuZFN1Ym1pdChlLCBpbmRleEltYWdlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoYXQudXBsb2FkQW5kU3VibWl0KGUsIGluZGV4SW1hZ2UpO1xuICAgIH1cbiAgfSxcblxuICB1cGxvYWRBbmRTdWJtaXQoZTogYW55LCBpbmRleEltYWdlOiBhbnkpIHtcbiAgICBjb25zdCBvcGVuaWQgPSB0aGlzLmRhdGEudXNlci5vcGVuaWQ7XG4gICAgY29uc3QgYWxpeXVuU2VydmVyVVJMID0gZW52LnVwbG9hZEltYWdlVXJsO1xuICAgIGxldCB0aGF0ID0gdGhpcztcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIGxldCBpbWFnZXM6IGFueVtdID0gW107XG4gICAgY29uc3QgdXBsb2FkSW1ncyA9IHRoaXMuZGF0YS51cGxvYWRJbWdzO1xuICAgIHd4LnNob3dMb2FkaW5nKHtcbiAgICAgIHRpdGxlOiAnJyxcbiAgICB9KVxuICAgIGlmICh1cGxvYWRJbWdzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXBsb2FkSW1ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgZmlsZVBhdGg6IGFueSA9IHVwbG9hZEltZ3NbaV07XG4gICAgICAgIHVwbG9hZEltYWdlKHtcbiAgICAgICAgICBmaWxlUGF0aDogZmlsZVBhdGgsXG4gICAgICAgICAgZGlyOiBgaW1hZ2VzL3Nob3AvJHtvcGVuaWR9L2AgKyBmaWxlUGF0aC5yZXBsYWNlKCdodHRwOi8vdG1wLycsICcnKSxcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzOiBhbnkpIHtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICBpbWFnZXMucHVzaChgJHthbGl5dW5TZXJ2ZXJVUkx9LyR7cmVzfWApO1xuICAgICAgICAgICAgaWYgKGNvdW50ID09PSB1cGxvYWRJbWdzLmxlbmd0aCkge1xuICAgICAgICAgICAgICBpZiAodGhhdC5kYXRhLmNhcklkICE9PSAnJykge1xuICAgICAgICAgICAgICAgIGltYWdlcyA9IGltYWdlcy5jb25jYXQodGhhdC5kYXRhLm9sZEltYWdlcyk7XG4gICAgICAgICAgICAgICAgdGhhdC51cGRhdGVDYXIoZSwgaW5kZXhJbWFnZSwgaW1hZ2VzLCB0aGF0LmRhdGEuY2FySWQpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQuZG9TdWJtaXQoZSwgaW5kZXhJbWFnZSwgaW1hZ2VzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoYXQuZGF0YS5jYXJJZCAhPT0gJycpIHtcbiAgICAgICAgaW1hZ2VzID0gaW1hZ2VzLmNvbmNhdCh0aGF0LmRhdGEub2xkSW1hZ2VzKTsgIC8vIOWQiOW5tue8lui+keS5i+WJjeeahOaxvei9puWbvueJh1xuICAgICAgICB0aGF0LnVwZGF0ZUNhcihlLCBpbmRleEltYWdlLCBpbWFnZXMsIHRoYXQuZGF0YS5jYXJJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGF0LmRvU3VibWl0KGUsIGluZGV4SW1hZ2UsIGltYWdlcyk7XG4gICAgICB9XG4gICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgIH1cbiAgfSxcblxuICAvKiog5Yib5bu65rG96L2mICovXG4gIGRvU3VibWl0KGU6IGFueSwgaW5kZXhJbWFnZTogYW55LCBpbWFnZXM6IGFueSkge1xuICAgIGNvbnN0IHBhcmFtcyA9IGUuZGV0YWlsLnZhbHVlO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc3VibWl0RGlzYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIGFwaVNlcnZpY2VQcm8ucmVnaXN0ZXIoT2JqZWN0LmFzc2lnbih7IGltYWdlcywgaW5kZXhJbWFnZSB9LCBwYXJhbXMpKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKTsgXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgc3VibWl0RGlzYWJsZTogdHJ1ZVxuICAgICAgfSk7ICAgICBcbiAgICAgIGlmIChyZXN1bHQuY29kZSA9PT0gMjAwKSB7XG4gICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICAgIHVybDogYC4uL2NhckRldGFpbC9jYXJEZXRhaWw/aWQ9JHtyZXN1bHQuZGF0YS5pZH0mZnJvbT1jcmVhdENhclBhZ2VgLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAocmVzdWx0LmNvZGUgPT09IDEyMDIpIHtcbiAgICAgICAgdXRpbHMuc2hvd01vZGFsKCfkv6Hmga/moKHpqozkuI3pgJrov4fvvIzor7fmoLjlr7nmsb3ovabkv6Hmga8nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHV0aWxzLnNob3dNb2RhbCgpO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqIOabtOaWsOaxvei9piAqL1xuICB1cGRhdGVDYXIoZTogYW55LCBpbmRleEltYWdlOiBhbnksIGltYWdlczogYW55LCBjYXJJZDogYW55KSB7XG4gICAgY29uc3QgdmFsdWUgPSBlLmRldGFpbC52YWx1ZTtcbiAgICBjb25zdCBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHZhbHVlLCB7J2lkJzogY2FySWR9KTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHN1Ym1pdERpc2FibGU6IHRydWVcbiAgICB9KTtcbiAgICBhcGlTZXJ2aWNlUHJvLnVwZGF0ZVVzZXIoT2JqZWN0LmFzc2lnbih7IGltYWdlcywgaW5kZXhJbWFnZSB9LCBwYXJhbXMpKS50aGVuKChyZXN1bHQ6YW55KSA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHN1Ym1pdERpc2FibGU6IHRydWVcbiAgICAgIH0pO1xuICAgICAgaWYgKHJlc3VsdC5jb2RlID09PSAyMDApIHtcbiAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgdXJsOiBgLi4vY2FyRGV0YWlsL2NhckRldGFpbD9pZD0ke3Jlc3VsdC5kYXRhLmlkfSZmcm9tPWNyZWF0Q2FyUGFnZWAsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChyZXN1bHQuY29kZSA9PT0gMTIwMikge1xuICAgICAgICB1dGlscy5zaG93TW9kYWwoJ+S/oeaBr+agoemqjOS4jemAmui/h++8jOivt+aguOWvueaxvei9puS/oeaBrycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXRpbHMuc2hvd01vZGFsKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICAvKiog5Yig6Zmk5LiK5Lyg54Wn54mHICovXG4gIGRlbEltYWdlKGU6IGFueSkge1xuICAgIGNvbnN0IGFycmF5ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuYXJyYXk7XG4gICAgY29uc3QgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcbiAgICBpZiAoYXJyYXkgPT09ICdvbGRJbWFnZXMnKSB7XG4gICAgICBjb25zdCBvbGRJbWFnZXMgPSB0aGlzLmRhdGEub2xkSW1hZ2VzO1xuICAgICAgb2xkSW1hZ2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgb2xkSW1hZ2VzXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdXBsb2FkSW1ncyA9IHRoaXMuZGF0YS51cGxvYWRJbWdzO1xuICAgICAgdXBsb2FkSW1ncy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHVwbG9hZEltZ3NcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBjaG9vc2VJbmRleEltYWdlKCkge1xuICAgIHRoaXMuY2hvb3NlSW1hZ2UoMSwgJ29uZScpO1xuICB9LFxuXG4gIGNob29zZU90aGVySW1hZ2UoZTogYW55KSB7XG4gICAgY29uc3Qgc2VsZWN0UGljdHVyZU51bSA9IGUudGFyZ2V0LmRhdGFzZXQubnVtO1xuICAgIGxldCBjb3VudCA9IDk5IC0gc2VsZWN0UGljdHVyZU51bVxuICAgIHRoaXMuY2hvb3NlSW1hZ2UoY291bnQsICdtdWx0aScpO1xuICB9LFxuXG4gIC8qKiDpgInmi6nlm77niYdcbiAgICogIEB0eXBlIG11bHRpLeWkmuW8oOWbvueJhyBvbmUt5LiA5byg5Zu+54mHXG4gICAqL1xuICBjaG9vc2VJbWFnZShjb3VudDogYW55LCB0eXBlOiBhbnkpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICB3eC5jaG9vc2VJbWFnZSh7XG4gICAgICBjb3VudDogY291bnQsXG4gICAgICBzaXplVHlwZTogWydvcmlnaW5hbCcsICdjb21wcmVzc2VkJ10sIC8vIOWPr+S7peaMh+WumuaYr+WOn+Wbvui/mOaYr+WOi+e8qeWbvu+8jOm7mOiupOS6jOiAhemDveaciVxuICAgICAgc291cmNlVHlwZTogWydhbGJ1bScsICdjYW1lcmEnXSwgLy8g5Y+v5Lul5oyH5a6a5p2l5rqQ5piv55u45YaM6L+Y5piv55u45py677yM6buY6K6k5LqM6ICF6YO95pyJXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzOiBhbnkpIHtcbiAgICAgICAgbGV0IHVwbG9hZEltZ3MgPSB0aGF0LmRhdGEudXBsb2FkSW1ncztcbiAgICAgICAgaWYgKHR5cGUgPT09ICdtdWx0aScpIHtcbiAgICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICAgIHVwbG9hZEltZ3M6IHVwbG9hZEltZ3MuY29uY2F0KHJlcy50ZW1wRmlsZVBhdGhzKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICAgIHVwbG9hZEluZGV4UGF0aDogcmVzLnRlbXBGaWxlUGF0aHNbMF0sXG4gICAgICAgICAgICBpbmRleEltYWdlOiByZXMudGVtcEZpbGVQYXRoc1swXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDmjqfliLZwaWNrZXJDaXR5ICovXG4gIHBvcFBpY2tlcigpIHtcbiAgICBsZXQgcG9wSGlkZGVuID0gdGhpcy5kYXRhLnBvcEhpZGRlbjtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHBvcEhpZGRlbjogIXBvcEhpZGRlbixcbiAgICB9KVxuICB9LFxuXG4gIC8qKiDpgInmi6nln47luIIgKi9cbiAgZG9TZWxlY3QoZTogYW55KSB7XG4gICAgaWYgKGUuZGV0YWlsLm5hbWUpIHtcbiAgICAgIC8vIGNvbnN0IGNpdHlJZCA9IHRoaXMuZ2V0Q2l0eUlkKGUuZGV0YWlsLm5hbWUpO1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHBvcEhpZGRlbjogdHJ1ZSxcbiAgICAgICAgY2l0eTogZS5kZXRhaWwubmFtZSxcbiAgICAgICAgLy8gY2l0eUlkLFxuICAgICAgfSlcbiAgICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAgICBrZXk6ICdjaXR5JyxcbiAgICAgICAgZGF0YTogZS5kZXRhaWwubmFtZSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7ICAvLyDlj5bmtojmjInpkq5cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwb3BIaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuXG4gIC8qKiDmjqfliLZwaWNrQnJhbmQgKi9cbiAgcG9wQnJhbmQoKSB7XG4gICAgbGV0IHBvcEhpZGRlbkJyYW5kID0gdGhpcy5kYXRhLnBvcEhpZGRlbkJyYW5kO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgcG9wSGlkZGVuQnJhbmQ6ICFwb3BIaWRkZW5CcmFuZCxcbiAgICB9KTtcbiAgfSxcblxuICAvKiog6YCJ5oup5Z+O5biCICovXG4gIGRvU2VsZWN0QnJhbmQoZTogYW55KSB7XG4gICAgaWYgKGUuZGV0YWlsLmJyYW5kKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgcG9wSGlkZGVuQnJhbmQ6IHRydWUsXG4gICAgICAgIGJyYW5kOiBlLmRldGFpbC5icmFuZCxcbiAgICAgICAgYnJhbmREZXRhaWw6IGUuZGV0YWlsLmJyYW5kRGV0YWlsLFxuICAgICAgfSk7XG4gICAgICB3eC5zZXRTdG9yYWdlKHtcbiAgICAgICAga2V5OiAnYnJhbmQnLFxuICAgICAgICBkYXRhOiBlLmRldGFpbC5icmFuZCxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7ICAvLyDlj5bmtojmjInpkq5cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwb3BIaWRkZW5CcmFuZDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICAvKiog5LiK54mM5pe26Ze0ICovXG4gIGJpbmREYXRlQ2hhbmdlKGU6IGFueSkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgYmlydGhkYXk6IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuICBiaW5kRWR1Y2F0aW9uQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgZWR1Y2F0aW9uQXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgZWR1Y2F0aW9uOiBlZHVjYXRpb25BcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIC8qKiDlqZrlp7sgKi9cbiAgYmluZE1hcnJpYWdlQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgaXNNYXJyaWFnZUFycmF5IH0gPSB0aGlzLmRhdGFcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGlzTWFycmlhZ2U6IGlzTWFycmlhZ2VBcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIGJpbmRIYXNDaGlsZENoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IGhhc0NoaWxkQXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaGFzQ2hpbGQ6IGhhc0NoaWxkQXJyYXlbZS5kZXRhaWwudmFsdWVdXG4gICAgfSlcbiAgfSxcblxuICBiaW5kV2FudENoaWxkQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgd2FudENoaWxkQXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaGFzQ2hpbGQ6IHdhbnRDaGlsZEFycmF5W2UuZGV0YWlsLnZhbHVlXVxuICAgIH0pXG4gIH0sXG5cbiAgYmluZEhvdXNlQ2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgaG91c2VBcnJheSB9ID0gdGhpcy5kYXRhXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBob3VzZTogaG91c2VBcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIC8qKiDmgKfliKsgKi9cbiAgYmluZFNleENoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IHNleEFycmF5IH0gPSB0aGlzLmRhdGFcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHNleDogc2V4QXJyYXlbZS5kZXRhaWwudmFsdWVdXG4gICAgfSlcbiAgfSxcbiAgLyoqIOaciOaUtuWFpSAqL1xuICBiaW5kU2FsYXJ5Q2hhbmdlKGU6IGFueSkge1xuICAgIGNvbnN0IHsgc2FsYXJ5QXJyYXkgfSA9IHRoaXMuZGF0YVxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2FsYXJ5OiBzYWxhcnlBcnJheVtlLmRldGFpbC52YWx1ZV1cbiAgICB9KVxuICB9LFxuXG4gIGlucHV0Tm90ZShlOiBhbnkpIHtcbiAgICBjb25zdCBsZWZ0TGVudGggPSAoMzAwIC0gZS5kZXRhaWwudmFsdWUubGVuZ3RoKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGxlZnRMZW50aDogbGVmdExlbnRoID4gMCA/IGxlZnRMZW50aCA6IDBcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcbiAgICovXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxuICAgKi9cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcbiAgICovXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHtcblxuICB9LFxufSkiXX0=
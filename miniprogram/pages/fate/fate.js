"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const utils_1 = require("../../utils/utils");
const topMenuList_1 = require("./topMenuList");
const app = getApp();
Page({
    data: {
        userInfo: {},
        userList: [],
        curruserList: [],
        dataAlready: false,
        currentCity: "",
        selectValue: "",
        currentQrcode: "",
        currentPhone: "",
        phone: "",
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
        showDialog: false,
        topMenuContent: {
            ageArray: topMenuList_1.getAgeMenuList(),
            heightArray: topMenuList_1.getHeightMenuList(),
            salaryArray: ["5千以下", "5千～1万", "1万～2万", "2万～5万", "5万以上"],
        },
    },
    onLoad() {
        let _this = this;
        wx.getStorage({
            key: "user",
            success: function (res) {
                _this.setData({
                    userInfo: res.data,
                });
            },
        });
        this.getUserList("");
        this.setData({
            pageLoaded: true,
        });
    },
    userDetail(e) {
        const { openid } = e.currentTarget.dataset;
        wx.navigateTo({
            url: `../userDetail/userDetail?openid=${openid}`,
        });
    },
    getUserList(objectId) {
        const params = { objectId };
        Api.getUserList(params)
            .then((result) => {
            if (result.code === 200) {
                let dataList = objectId ? this.data.userList : [];
                dataList = dataList.concat(result.data);
                dataList.map((data) => {
                    if (data.age && !data.age.toString().includes("岁")) {
                        data.age = data.age + "岁";
                    }
                });
                dataList.map((item) => {
                    if (item.photos && item.photos.length === 0) {
                        item.photos.push(item.avatarUrl);
                    }
                    item.intro = [];
                    if (item.age) {
                        item.intro.push(item.age);
                    }
                    if (item.jobGeneral) {
                        item.intro.push(item.jobGeneral);
                    }
                    if (item.jobDetail) {
                        item.intro.push(item.jobDetail);
                    }
                    if (item.education) {
                        item.intro.push(item.education);
                    }
                    item.intro = item.intro.join(" | ");
                });
                const { currentPage } = this.data;
                this.setData({
                    userList: dataList,
                    currentPage: currentPage + 1,
                });
            }
        })
            .catch((err) => {
            console.log("get user List", err);
        });
    },
    goMatch() {
        let rightType = "fateMatch";
        if (utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType);
        let userInfo = app.globalData.userInfo;
        if (userInfo && userInfo.phone) {
            wx.navigateTo({
                url: "../matching/matching",
            });
        }
        else {
            wx.navigateTo({
                url: "../registerXz/registerXz",
            });
        }
    },
    onShow: function () {
        const { pageLoaded } = this.data;
        if (pageLoaded) {
            this.getUserList("");
        }
    },
    onPullDownRefresh: function () { },
    onReachBottom: function () {
        let rightType = "fateWatch";
        const { userList, currentPage, pageSize } = this.data;
        if (currentPage > 2 && utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType, currentPage * pageSize);
        const lastId = userList.length > 0 ? userList[userList.length - 1]._id : "";
        this.getUserList(lastId);
    },
    closeDialog() {
        this.setData({
            showDialog: false,
        });
    },
    dealWithRequestParameter() {
        const ageSelection = "";
        const heightSelection = "";
        const salarySelection = "";
        const reqParams = {};
        if (ageSelection) {
            reqParams.age = topMenuList_1.ageMenuList[ageSelection];
        }
        if (heightSelection) {
            reqParams.height = topMenuList_1.heightMenuList[heightSelection];
        }
        if (salarySelection) {
            reqParams.salary = salarySelection;
        }
        return reqParams;
    },
    onShareAppMessage: function (options) {
        console.log("onShareAppMessage options", options);
        return {};
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFDakQsNkNBQXdFO0FBRXhFLCtDQUE0RjtBQUM1RixNQUFNLEdBQUcsR0FBRyxNQUFNLEVBQVUsQ0FBQztBQUU3QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixRQUFRLEVBQUUsRUFBRTtRQUNaLFFBQVEsRUFBRSxFQUFXO1FBQ3JCLFlBQVksRUFBRSxFQUFFO1FBQ2hCLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLFdBQVcsRUFBRSxFQUFFO1FBQ2YsV0FBVyxFQUFFLEVBQUU7UUFDZixhQUFhLEVBQUUsRUFBRTtRQUNqQixZQUFZLEVBQUUsRUFBRTtRQUNoQixLQUFLLEVBQUUsRUFBRTtRQUNULFNBQVMsRUFBRSxJQUFJO1FBQ2YsVUFBVSxFQUFFLEtBQUs7UUFDakIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsV0FBVyxFQUFFLENBQUM7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLFVBQVUsRUFBRSxDQUFDO1FBQ2IsUUFBUSxFQUFFLEtBQUs7UUFDZixNQUFNLEVBQUUsS0FBSztRQUNiLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLGNBQWMsRUFBRTtZQUNkLFFBQVEsRUFBRSw0QkFBYyxFQUFFO1lBQzFCLFdBQVcsRUFBRSwrQkFBaUIsRUFBRTtZQUNoQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDO1NBQ3pEO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsTUFBTTtZQUNYLE9BQU8sRUFBRSxVQUFVLEdBQUc7Z0JBQ3BCLEtBQUssQ0FBQyxPQUFRLENBQUM7b0JBQ2IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJO2lCQUNuQixDQUFDLENB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ZXJ2aWNlL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IGRlYWxSaWdodEludGVyY2VwdCwgc2V0UmlnaHRTdG9yYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgSU15QXBwIH0gZnJvbSAnLi4vLi4vYXBwJztcbmltcG9ydCB7Z2V0QWdlTWVudUxpc3QsIGdldEhlaWdodE1lbnVMaXN0LCBhZ2VNZW51TGlzdCwgaGVpZ2h0TWVudUxpc3R9IGZyb20gJy4vdG9wTWVudUxpc3QnXG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHVzZXJJbmZvOiB7fSxcbiAgICB1c2VyTGlzdDogW10gYXMgYW55W10sXG4gICAgY3VycnVzZXJMaXN0OiBbXSxcbiAgICBkYXRhQWxyZWFkeTogZmFsc2UsXG4gICAgY3VycmVudENpdHk6IFwiXCIsXG4gICAgc2VsZWN0VmFsdWU6IFwiXCIsXG4gICAgY3VycmVudFFyY29kZTogXCJcIixcbiAgICBjdXJyZW50UGhvbmU6IFwiXCIsXG4gICAgcGhvbmU6IFwiXCIsXG4gICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgIHBhZ2VMb2FkZWQ6IGZhbHNlLFxuICAgIHBvcFdlY2hhdDogZmFsc2UsXG4gICAgY3VycmVudFBhZ2U6IDEsXG4gICAgcGFnZVNpemU6IDEwLCAvLyBkZWZhdWx0XG4gICAgdG90YWxDb3VudDogMCxcbiAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgcHVsbFVwOiBmYWxzZSxcbiAgICBzaG93RGlhbG9nOiBmYWxzZSxcbiAgICB0b3BNZW51Q29udGVudDoge1xuICAgICAgYWdlQXJyYXk6IGdldEFnZU1lbnVMaXN0KCksXG4gICAgICBoZWlnaHRBcnJheTogZ2V0SGVpZ2h0TWVudUxpc3QoKSxcbiAgICAgIHNhbGFyeUFycmF5OiBbXCI15Y2D5Lul5LiLXCIsIFwiNeWNg++9njHkuIdcIiwgXCIx5LiH772eMuS4h1wiLCBcIjLkuIfvvZ415LiHXCIsIFwiNeS4h+S7peS4ilwiXSxcbiAgICB9LFxuICB9LFxuXG4gIG9uTG9hZCgpIHtcbiAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIHd4LmdldFN0b3JhZ2Uoe1xuICAgICAga2V5OiBcInVzZXJcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgX3RoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIHVzZXJJbmZvOiByZXMuZGF0YSxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMuZ2V0VXNlckxpc3QoXCJcIik7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwYWdlTG9hZGVkOiB0cnVlLFxuICAgIH0pO1xuICB9LFxuXG4gIC8qKiDor6bmg4UgKi9cbiAgdXNlckRldGFpbChlOiBhbnkpIHtcbiAgICBjb25zdCB7IG9wZW5pZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi91c2VyRGV0YWlsL3VzZXJEZXRhaWw/b3BlbmlkPSR7b3BlbmlkfWAsXG4gICAgfSk7XG4gICAgLy8gd3gubmF2aWdhdGVUbyh7XG4gICAgLy8gICB1cmw6ICcuLi9yZWdpc3RlclBob25lL3JlZ2lzdGVyUGhvbmUnLFxuICAgIC8vIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3RJZFxuICAgKiBwYWdlU2l6ZSDpu5jorqQgMTBcbiAgICovXG4gIGdldFVzZXJMaXN0KG9iamVjdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBwYXJhbXMgPSB7IG9iamVjdElkIH07XG4gICAgQXBpLmdldFVzZXJMaXN0KHBhcmFtcylcbiAgICAgIC50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0LmNvZGUgPT09IDIwMCkge1xuICAgICAgICAgIGxldCBkYXRhTGlzdCA9IG9iamVjdElkID8gdGhpcy5kYXRhLnVzZXJMaXN0IDogW107XG4gICAgICAgICAgZGF0YUxpc3QgPSBkYXRhTGlzdC5jb25jYXQocmVzdWx0LmRhdGEpO1xuICAgICAgICAgIGRhdGFMaXN0Lm1hcCgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgaWYgKGRhdGEuYWdlICYmICFkYXRhLmFnZS50b1N0cmluZygpLmluY2x1ZGVzKFwi5bKBXCIpKSB7XG4gICAgICAgICAgICAgIGRhdGEuYWdlID0gZGF0YS5hZ2UgKyBcIuWygVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRhdGFMaXN0Lm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0ucGhvdG9zICYmIGl0ZW0ucGhvdG9zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICBpdGVtLnBob3Rvcy5wdXNoKGl0ZW0uYXZhdGFyVXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW0uaW50cm8gPSBbXTtcbiAgICAgICAgICAgIGlmIChpdGVtLmFnZSkge1xuICAgICAgICAgICAgICBpdGVtLmludHJvLnB1c2goaXRlbS5hZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uam9iR2VuZXJhbCkge1xuICAgICAgICAgICAgICBpdGVtLmludHJvLnB1c2goaXRlbS5qb2JHZW5lcmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmpvYkRldGFpbCkge1xuICAgICAgICAgICAgICBpdGVtLmludHJvLnB1c2goaXRlbS5qb2JEZXRhaWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uZWR1Y2F0aW9uKSB7XG4gICAgICAgICAgICAgIGl0ZW0uaW50cm8ucHVzaChpdGVtLmVkdWNhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtLmludHJvID0gaXRlbS5pbnRyby5qb2luKFwiIHwgXCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHsgY3VycmVudFBhZ2UgfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgIHVzZXJMaXN0OiBkYXRhTGlzdCxcbiAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBjdXJyZW50UGFnZSArIDEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcImdldCB1c2VyIExpc3RcIiwgZXJyKTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIGdvTWF0Y2goKSB7XG4gICAgbGV0IHJpZ2h0VHlwZSA9IFwiZmF0ZU1hdGNoXCI7IC8vIOe8mOWIhuWMuemFjVxuICAgIGlmIChkZWFsUmlnaHRJbnRlcmNlcHQocmlnaHRUeXBlKSkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHNob3dEaWFsb2c6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0UmlnaHRTdG9yYWdlKHJpZ2h0VHlwZSk7XG5cbiAgICBsZXQgdXNlckluZm8gPSBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbztcbiAgICBpZiAodXNlckluZm8gJiYgdXNlckluZm8ucGhvbmUpIHtcbiAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICB1cmw6IFwiLi4vbWF0Y2hpbmcvbWF0Y2hpbmdcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgdXJsOiBcIi4uL3JlZ2lzdGVyWHovcmVnaXN0ZXJYelwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHsgcGFnZUxvYWRlZCB9ID0gdGhpcy5kYXRhO1xuICAgIGlmIChwYWdlTG9hZGVkKSB7XG4gICAgICB0aGlzLmdldFVzZXJMaXN0KFwiXCIpO1xuICAgIH1cbiAgfSxcblxuICBvblB1bGxEb3duUmVmcmVzaDogZnVuY3Rpb24gKCkge30sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuICAgIGxldCByaWdodFR5cGUgPSBcImZhdGVXYXRjaFwiOyAvLyDnvJjliIbkuIvmu5Hmn6XnnIvpmZDliLZcbiAgICBjb25zdCB7IHVzZXJMaXN0LCBjdXJyZW50UGFnZSwgcGFnZVNpemUgfSA9IHRoaXMuZGF0YTtcbiAgICBpZiAoY3VycmVudFBhZ2UgPiAyICYmIGRlYWxSaWdodEludGVyY2VwdChyaWdodFR5cGUpKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgc2hvd0RpYWxvZzogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZXRSaWdodFN0b3JhZ2UocmlnaHRUeXBlLCBjdXJyZW50UGFnZSAqIHBhZ2VTaXplKTtcbiAgICBjb25zdCBsYXN0SWQgPSB1c2VyTGlzdC5sZW5ndGggPiAwID8gdXNlckxpc3RbdXNlckxpc3QubGVuZ3RoIC0gMV0uX2lkIDogXCJcIjtcbiAgICB0aGlzLmdldFVzZXJMaXN0KGxhc3RJZCk7XG4gIH0sXG5cbiAgY2xvc2VEaWFsb2coKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBzaG93RGlhbG9nOiBmYWxzZSxcbiAgICB9KTtcbiAgfSxcblxuICAvKlxuICAgIOagueaNrumAieaLqeeahOW5tOm+hCwg6Lqr6auYLCDmlLblhaXojIPlm7QsIOi9rOaNouaIkOWvueW6lOivt+axguWPguaVsFxuICAgIFRvRG86XG4gICAgICDpobXpnaLkuIrlubTpvoQsIOi6q+mrmCwg5pS25YWl6IyD5Zu06YCJ5oupXG4gICovXG4gIGRlYWxXaXRoUmVxdWVzdFBhcmFtZXRlcigpIHtcbiAgICAvLyBnZXQgc2VsZWN0T3B0aW9ucyBmcm9tIHRoaXMuZGF0YVxuICAgIGNvbnN0IGFnZVNlbGVjdGlvbiA9IFwiXCI7XG4gICAgY29uc3QgaGVpZ2h0U2VsZWN0aW9uID0gXCJcIjtcbiAgICBjb25zdCBzYWxhcnlTZWxlY3Rpb24gPSBcIlwiO1xuICAgIGNvbnN0IHJlcVBhcmFtczogYW55ID0ge307XG4gICAgaWYgKGFnZVNlbGVjdGlvbikge1xuICAgICByZXFQYXJhbXMuYWdlID0gYWdlTWVudUxpc3RbYWdlU2VsZWN0aW9uXTtcbiAgICB9XG4gICAgaWYgKGhlaWdodFNlbGVjdGlvbikge1xuICAgICAgcmVxUGFyYW1zLmhlaWdodCA9IGhlaWdodE1lbnVMaXN0W2hlaWdodFNlbGVjdGlvbl1cbiAgICB9XG4gICAgaWYgKHNhbGFyeVNlbGVjdGlvbikge1xuICAgICAgcmVxUGFyYW1zLnNhbGFyeSA9IHNhbGFyeVNlbGVjdGlvbjtcbiAgICB9XG4gICAgcmV0dXJuIHJlcVBhcmFtcztcbiAgfSxcblxuICAvKipcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAqL1xuICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKFxuICAgIG9wdGlvbnM/OiBQYWdlLklTaGFyZUFwcE1lc3NhZ2VPcHRpb24gfCB1bmRlZmluZWRcbiAgKTogUGFnZS5JQ3VzdG9tU2hhcmVDb250ZW50IHtcbiAgICBjb25zb2xlLmxvZyhcIm9uU2hhcmVBcHBNZXNzYWdlIG9wdGlvbnNcIiwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHt9O1xuICB9LFxufSk7Il19
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const utils_1 = require("../../utils/utils");
const topMenuList_1 = require("./topMenuList");
const app = getApp();
Page({
    data: {
        userInfo: {},
        userList: [],
        curruserList: [],
        dataAlready: false,
        currentCity: "",
        selectValue: "",
        currentQrcode: "",
        currentPhone: "",
        phone: "",
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
        showDialog: false,
        topMenuContent: {
            ageArray: topMenuList_1.getAgeMenuList(),
            heightArray: topMenuList_1.getHeightMenuList(),
            salaryArray: ["5千以下", "5千～1万", "1万～2万", "2万～5万", "5万以上"],
        },
        showSelect: false,
        optionType: '',
        selection: '',
    },
    onLoad() {
        let _this = this;
        wx.getStorage({
            key: "user",
            success: function (res) {
                _this.setData({
                    userInfo: res.data,
                });
            },
        });
        this.getUserList({});
        this.setData({
            pageLoaded: true,
        });
    },
    userDetail(e) {
        const { openid } = e.currentTarget.dataset;
        wx.navigateTo({
            url: `../userDetail/userDetail?openid=${openid}`,
        });
    },
    getUserList(params) {
        wx.showLoading({ title: '' });
        const { objectId } = params;
        Api.getUserList(params)
            .then((result) => {
            wx.hideLoading();
            this.setData({
                dataAlready: true,
            });
            if (result.code === 200) {
                let dataList = objectId ? this.data.userList : [];
                dataList = dataList.concat(result.data);
                dataList.map((data) => {
                    if (data.age && !data.age.toString().includes("岁")) {
                        data.age = data.age + "岁";
                    }
                });
                dataList.map((item) => {
                    if (item.photos && item.photos.length === 0) {
                        item.photos.push(item.avatarUrl);
                    }
                    item.intro = [];
                    if (item.age) {
                        item.intro.push(item.age);
                    }
                    if (item.jobGeneral) {
                        item.intro.push(item.jobGeneral);
                    }
                    if (item.jobDetail) {
                        item.intro.push(item.jobDetail);
                    }
                    if (item.education) {
                        item.intro.push(item.education);
                    }
                    item.intro = item.intro.join(" | ");
                });
                const { currentPage } = this.data;
                this.setData({
                    userList: dataList,
                    currentPage: currentPage + 1,
                });
            }
        })
            .catch((err) => {
            wx.hideLoading();
            console.log("get user List", err);
        });
    },
    goMatch() {
        let rightType = "fateMatch";
        if (utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType);
        let userInfo = app.globalData.userInfo;
        if (userInfo && userInfo.phone) {
            wx.navigateTo({
                url: "../matching/matching",
            });
        }
        else {
            wx.navigateTo({
                url: "../registerXz/registerXz",
            });
        }
    },
    onShow: function () {
        const { pageLoaded } = this.data;
        if (pageLoaded) {
            this.getUserList({});
        }
    },
    onPullDownRefresh: function () { },
    onReachBottom: function () {
        let rightType = "fateWatch";
        const { userList, currentPage, pageSize } = this.data;
        if (currentPage > 2 && utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType, currentPage * pageSize);
        const lastId = userList.length > 0 ? userList[userList.length - 1]._id : "";
        const { optionType, selection } = this.data;
        const params = this.dealWithRequestParameter(optionType, selection);
        params.objectId = lastId;
        this.getUserList(params);
    },
    closeDialog() {
        this.setData({
            showDialog: false,
        });
    },
    openSelect(e) {
        const optionTypedata = e.target.dataset.optionType;
        const { optionType } = this.data;
        if (optionTypedata === optionType) {
            this.setData({
                showSelect: false,
                optionType: '',
            });
            return;
        }
        this.setData({
            showSelect: true,
            optionType: optionTypedata,
        });
    },
    chooseTap(e) {
        const selectionData = e.target.dataset.selection;
        const selectionInit = this.data.selection;
        this.setData({
            selection: selectionData === selectionInit ? '' : selectionData,
        });
        const { optionType, selection } = this.data;
        const params = this.dealWithRequestParameter(optionType, selection);
        this.getUserList(params);
    },
    dealWithRequestParameter(optionType, selection) {
        const reqParams = {};
        switch (optionType) {
            case 'ageArray':
                reqParams.age = topMenuList_1.ageMenuList[selection];
                break;
            case 'heightArray':
                reqParams.height = topMenuList_1.heightMenuList[selection];
                break;
            case 'salaryArray':
                reqParams.salary = selection;
                break;
        }
        return reqParams;
    },
    onShareAppMessage: function (options) {
        console.log("onShareAppMessage options", options);
        return {};
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFDakQsNkNBQXdFO0FBRXhFLCtDQUE0RjtBQUM1RixNQUFNLEdBQUcsR0FBRyxNQUFNLEVBQVUsQ0FBQztBQUU3QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixRQUFRLEVBQUUsRUFBRTtRQUNaLFFBQVEsRUFBRSxFQUFXO1FBQ3JCLFlBQVksRUFBRSxFQUFFO1FBQ2hCLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLFdBQVcsRUFBRSxFQUFFO1FBQ2YsV0FBVyxFQUFFLEVBQUU7UUFDZixhQUFhLEVBQUUsRUFBRTtRQUNqQixZQUFZLEVBQUUsRUFBRTtRQUNoQixLQUFLLEVBQUUsRUFBRTtRQUNULFNBQVMsRUFBRSxJQUFJO1FBQ2YsVUFBVSxFQUFFLEtBQUs7UUFDakIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsV0FBVyxFQUFFLENBQUM7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLFVBQVUsRUFBRSxDQUFDO1FBQ2IsUUFBUSxFQUFFLEtBQUs7UUFDZixNQUFNLEVBQUUsS0FBSztRQUNiLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLGNBQWMsRUFBRTtZQUNkLFFBQVEsRUFBRSw0QkFBYyxFQUFFO1lBQzFCLFdBQVcsRUFBRSwrQkFBaUIsRUFBRTtZQUNoQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDO1NBQ3pEO1FBQ0QsVUFBVSxFQUFFLEtBQUs7UUFDakIsVUFBVSxFQUFFLEVBQUU7UUFDZCxTQUFTLEVBQUUsRUFBRTtLQUNkO0lBRUQsTUFBTTtRQUNKLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztRQUNqQixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLE1BQU07WUFDWCxPQUFPLEVBQUUsVUFBVSxHQUFHO2dCQUNwQixLQUFL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LE1BQU0sR0FBRyxTQUFTLENBQUM7Z0JBQzdCLE1BQU07U0FDVDtRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFLRCxpQkFBaUIsRUFBRSxVQUNqQixPQUFpRDtRQUVqRCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2xELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFwaSBmcm9tICcuLi8uLi9zZXJ2aWNlL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IGRlYWxSaWdodEludGVyY2VwdCwgc2V0UmlnaHRTdG9yYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgSU15QXBwIH0gZnJvbSAnLi4vLi4vYXBwJztcbmltcG9ydCB7Z2V0QWdlTWVudUxpc3QsIGdldEhlaWdodE1lbnVMaXN0LCBhZ2VNZW51TGlzdCwgaGVpZ2h0TWVudUxpc3R9IGZyb20gJy4vdG9wTWVudUxpc3QnXG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHVzZXJJbmZvOiB7fSxcbiAgICB1c2VyTGlzdDogW10gYXMgYW55W10sXG4gICAgY3VycnVzZXJMaXN0OiBbXSxcbiAgICBkYXRhQWxyZWFkeTogZmFsc2UsXG4gICAgY3VycmVudENpdHk6IFwiXCIsXG4gICAgc2VsZWN0VmFsdWU6IFwiXCIsXG4gICAgY3VycmVudFFyY29kZTogXCJcIixcbiAgICBjdXJyZW50UGhvbmU6IFwiXCIsXG4gICAgcGhvbmU6IFwiXCIsXG4gICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgIHBhZ2VMb2FkZWQ6IGZhbHNlLFxuICAgIHBvcFdlY2hhdDogZmFsc2UsXG4gICAgY3VycmVudFBhZ2U6IDEsXG4gICAgcGFnZVNpemU6IDEwLCAvLyBkZWZhdWx0XG4gICAgdG90YWxDb3VudDogMCxcbiAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgcHVsbFVwOiBmYWxzZSxcbiAgICBzaG93RGlhbG9nOiBmYWxzZSxcbiAgICB0b3BNZW51Q29udGVudDoge1xuICAgICAgYWdlQXJyYXk6IGdldEFnZU1lbnVMaXN0KCksXG4gICAgICBoZWlnaHRBcnJheTogZ2V0SGVpZ2h0TWVudUxpc3QoKSxcbiAgICAgIHNhbGFyeUFycmF5OiBbXCI15Y2D5Lul5LiLXCIsIFwiNeWNg++9njHkuIdcIiwgXCIx5LiH772eMuS4h1wiLCBcIjLkuIfvvZ415LiHXCIsIFwiNeS4h+S7peS4ilwiXSxcbiAgICB9LFxuICAgIHNob3dTZWxlY3Q6IGZhbHNlLFxuICAgIG9wdGlvblR5cGU6ICcnLFxuICAgIHNlbGVjdGlvbjogJycsXG4gIH0sXG5cbiAgb25Mb2FkKCkge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgd3guZ2V0U3RvcmFnZSh7XG4gICAgICBrZXk6IFwidXNlclwiLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICBfdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgdXNlckluZm86IHJlcy5kYXRhLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5nZXRVc2VyTGlzdCh7fSk7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBwYWdlTG9hZGVkOiB0cnVlLFxuICAgIH0pO1xuICB9LFxuXG4gIC8qKiDor6bmg4UgKi9cbiAgdXNlckRldGFpbChlOiBhbnkpIHtcbiAgICBjb25zdCB7IG9wZW5pZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IGAuLi91c2VyRGV0YWlsL3VzZXJEZXRhaWw/b3BlbmlkPSR7b3BlbmlkfWAsXG4gICAgfSk7XG4gICAgLy8gd3gubmF2aWdhdGVUbyh7XG4gICAgLy8gICB1cmw6ICcuLi9yZWdpc3RlclBob25lL3JlZ2lzdGVyUGhvbmUnLFxuICAgIC8vIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvYmplY3RJZFxuICAgKiBwYWdlU2l6ZSDpu5jorqQgMTBcbiAgICovXG4gIGdldFVzZXJMaXN0KHBhcmFtczogYW55KSB7XG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJyd9KTtcbiAgICBjb25zdCB7IG9iamVjdElkIH0gPSBwYXJhbXM7XG4gICAgQXBpLmdldFVzZXJMaXN0KHBhcmFtcylcbiAgICAgIC50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICBkYXRhQWxyZWFkeTogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgICAgaWYgKHJlc3VsdC5jb2RlID09PSAyMDApIHtcbiAgICAgICAgICBsZXQgZGF0YUxpc3QgPSBvYmplY3RJZCA/IHRoaXMuZGF0YS51c2VyTGlzdCA6IFtdO1xuICAgICAgICAgIGRhdGFMaXN0ID0gZGF0YUxpc3QuY29uY2F0KHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICBkYXRhTGlzdC5tYXAoKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRhLmFnZSAmJiAhZGF0YS5hZ2UudG9TdHJpbmcoKS5pbmNsdWRlcyhcIuWygVwiKSkge1xuICAgICAgICAgICAgICBkYXRhLmFnZSA9IGRhdGEuYWdlICsgXCLlsoFcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkYXRhTGlzdC5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLnBob3RvcyAmJiBpdGVtLnBob3Rvcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgaXRlbS5waG90b3MucHVzaChpdGVtLmF2YXRhclVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtLmludHJvID0gW107XG4gICAgICAgICAgICBpZiAoaXRlbS5hZ2UpIHtcbiAgICAgICAgICAgICAgaXRlbS5pbnRyby5wdXNoKGl0ZW0uYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmpvYkdlbmVyYWwpIHtcbiAgICAgICAgICAgICAgaXRlbS5pbnRyby5wdXNoKGl0ZW0uam9iR2VuZXJhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5qb2JEZXRhaWwpIHtcbiAgICAgICAgICAgICAgaXRlbS5pbnRyby5wdXNoKGl0ZW0uam9iRGV0YWlsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmVkdWNhdGlvbikge1xuICAgICAgICAgICAgICBpdGVtLmludHJvLnB1c2goaXRlbS5lZHVjYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5pbnRybyA9IGl0ZW0uaW50cm8uam9pbihcIiB8IFwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCB7IGN1cnJlbnRQYWdlIH0gPSB0aGlzLmRhdGE7XG4gICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICB1c2VyTGlzdDogZGF0YUxpc3QsXG4gICAgICAgICAgICBjdXJyZW50UGFnZTogY3VycmVudFBhZ2UgKyAxLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJnZXQgdXNlciBMaXN0XCIsIGVycik7XG4gICAgICB9KTtcbiAgfSxcblxuICBnb01hdGNoKCkge1xuICAgIGxldCByaWdodFR5cGUgPSBcImZhdGVNYXRjaFwiOyAvLyDnvJjliIbljLnphY1cbiAgICBpZiAoZGVhbFJpZ2h0SW50ZXJjZXB0KHJpZ2h0VHlwZSkpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBzaG93RGlhbG9nOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldFJpZ2h0U3RvcmFnZShyaWdodFR5cGUpO1xuXG4gICAgbGV0IHVzZXJJbmZvID0gYXBwLmdsb2JhbERhdGEudXNlckluZm87XG4gICAgaWYgKHVzZXJJbmZvICYmIHVzZXJJbmZvLnBob25lKSB7XG4gICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgdXJsOiBcIi4uL21hdGNoaW5nL21hdGNoaW5nXCIsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgIHVybDogXCIuLi9yZWdpc3Rlclh6L3JlZ2lzdGVyWHpcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB7IHBhZ2VMb2FkZWQgfSA9IHRoaXMuZGF0YTtcbiAgICBpZiAocGFnZUxvYWRlZCkge1xuICAgICAgdGhpcy5nZXRVc2VyTGlzdCh7fSk7XG4gICAgfVxuICB9LFxuXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7fSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHJpZ2h0VHlwZSA9IFwiZmF0ZVdhdGNoXCI7IC8vIOe8mOWIhuS4i+a7keafpeeci+mZkOWItlxuICAgIGNvbnN0IHsgdXNlckxpc3QsIGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSB9ID0gdGhpcy5kYXRhO1xuICAgIGlmIChjdXJyZW50UGFnZSA+IDIgJiYgZGVhbFJpZ2h0SW50ZXJjZXB0KHJpZ2h0VHlwZSkpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBzaG93RGlhbG9nOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldFJpZ2h0U3RvcmFnZShyaWdodFR5cGUsIGN1cnJlbnRQYWdlICogcGFnZVNpemUpO1xuICAgIGNvbnN0IGxhc3RJZCA9IHVzZXJMaXN0Lmxlbmd0aCA+IDAgPyB1c2VyTGlzdFt1c2VyTGlzdC5sZW5ndGggLSAxXS5faWQgOiBcIlwiO1xuICAgIFxuICAgIGNvbnN0IHsgb3B0aW9uVHlwZSwgc2VsZWN0aW9uIH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5kZWFsV2l0aFJlcXVlc3RQYXJhbWV0ZXIob3B0aW9uVHlwZSwgc2VsZWN0aW9uKTtcbiAgICBwYXJhbXMub2JqZWN0SWQgPSBsYXN0SWQ7XG4gICAgdGhpcy5nZXRVc2VyTGlzdChwYXJhbXMpO1xuICB9LFxuXG4gIGNsb3NlRGlhbG9nKCkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2hvd0RpYWxvZzogZmFsc2UsXG4gICAgfSk7XG4gIH0sXG5cbiAgLy8gdHlwZTogYWdlQXJyYXksIGhlaWdodEFycmF5LCBzYWxhcnlBcnJheVxuICBvcGVuU2VsZWN0KGU6IGFueSkge1xuICAgIGNvbnN0IG9wdGlvblR5cGVkYXRhID0gZS50YXJnZXQuZGF0YXNldC5vcHRpb25UeXBlO1xuICAgIGNvbnN0IHsgb3B0aW9uVHlwZSB9ID0gdGhpcy5kYXRhO1xuICAgIGlmIChvcHRpb25UeXBlZGF0YSA9PT0gb3B0aW9uVHlwZSkge1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIHNob3dTZWxlY3Q6IGZhbHNlLFxuICAgICAgICBvcHRpb25UeXBlOiAnJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHNob3dTZWxlY3Q6IHRydWUsXG4gICAgICBvcHRpb25UeXBlOiBvcHRpb25UeXBlZGF0YSxcbiAgICB9KTtcbiAgfSxcblxuICBjaG9vc2VUYXAoZTogYW55KSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uRGF0YSA9IGUudGFyZ2V0LmRhdGFzZXQuc2VsZWN0aW9uO1xuICAgIGNvbnN0IHNlbGVjdGlvbkluaXQgPSB0aGlzLmRhdGEuc2VsZWN0aW9uO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25EYXRhID09PSBzZWxlY3Rpb25Jbml0ID8gJycgOiBzZWxlY3Rpb25EYXRhLFxuICAgIH0pO1xuICAgIGNvbnN0IHsgb3B0aW9uVHlwZSwgc2VsZWN0aW9uIH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5kZWFsV2l0aFJlcXVlc3RQYXJhbWV0ZXIob3B0aW9uVHlwZSwgc2VsZWN0aW9uKTtcbiAgICB0aGlzLmdldFVzZXJMaXN0KHBhcmFtcyk7XG4gIH0sXG5cbiAgLypcbiAgICDmoLnmja7pgInmi6nnmoTlubTpvoQsIOi6q+mrmCwg5pS25YWl6IyD5Zu0LCDovazmjaLmiJDlr7nlupTor7fmsYLlj4LmlbBcbiAgICBUb0RvOlxuICAgICAg6aG16Z2i5LiK5bm06b6ELCDouqvpq5gsIOaUtuWFpeiMg+WbtOmAieaLqVxuICAqL1xuICBkZWFsV2l0aFJlcXVlc3RQYXJhbWV0ZXIob3B0aW9uVHlwZTogc3RyaW5nLCBzZWxlY3Rpb246IHN0cmluZykge1xuICAgIC8vIGdldCBzZWxlY3RPcHRpb25zIGZyb20gdGhpcy5kYXRhXG4gICAgLy8gY29uc3QgYWdlU2VsZWN0aW9uID0gXCJcIjtcbiAgICAvLyBjb25zdCBoZWlnaHRTZWxlY3Rpb24gPSBcIlwiO1xuICAgIC8vIGNvbnN0IHNhbGFyeVNlbGVjdGlvbiA9IFwiXCI7XG4gICAgY29uc3QgcmVxUGFyYW1zOiBhbnkgPSB7fTtcbiAgICAvLyBhZ2VBcnJheSwgaGVpZ2h0QXJyYXksIHNhbGFyeUFycmF5XG4gICAgc3dpdGNoKG9wdGlvblR5cGUpIHtcbiAgICAgIGNhc2UgJ2FnZUFycmF5JzpcbiAgICAgICAgcmVxUGFyYW1zLmFnZSA9IGFnZU1lbnVMaXN0W3NlbGVjdGlvbl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaGVpZ2h0QXJyYXknOlxuICAgICAgICByZXFQYXJhbXMuaGVpZ2h0ID0gaGVpZ2h0TWVudUxpc3Rbc2VsZWN0aW9uXVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NhbGFyeUFycmF5JzpcbiAgICAgICAgcmVxUGFyYW1zLnNhbGFyeSA9IHNlbGVjdGlvbjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiByZXFQYXJhbXM7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xuICAgKi9cbiAgb25TaGFyZUFwcE1lc3NhZ2U6IGZ1bmN0aW9uIChcbiAgICBvcHRpb25zPzogUGFnZS5JU2hhcmVBcHBNZXNzYWdlT3B0aW9uIHwgdW5kZWZpbmVkXG4gICk6IFBhZ2UuSUN1c3RvbVNoYXJlQ29udGVudCB7XG4gICAgY29uc29sZS5sb2coXCJvblNoYXJlQXBwTWVzc2FnZSBvcHRpb25zXCIsIG9wdGlvbnMpO1xuICAgIHJldHVybiB7fTtcbiAgfSxcbn0pOyJdfQ==
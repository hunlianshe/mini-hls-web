"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const utils_1 = require("../../utils/utils");
const topMenuList_1 = require("./topMenuList");
const app = getApp();
Page({
    data: {
        userInfo: {},
        userList: [],
        curruserList: [],
        dataAlready: false,
        currentCity: "",
        selectValue: "",
        currentQrcode: "",
        currentPhone: "",
        phone: "",
        popHidden: true,
        pageLoaded: false,
        popWechat: false,
        currentPage: 1,
        pageSize: 10,
        totalCount: 0,
        pullDown: false,
        pullUp: false,
        showDialog: false,
        topMenuContent: {
            ageArray: topMenuList_1.getAgeMenuList(),
            heightArray: topMenuList_1.getHeightMenuList(),
            salaryArray: ["5千以下", "5千～1万", "1万～2万", "2万～5万", "5万以上"],
        },
        showSelect: false,
        optionType: 'ageArray',
    },
    onLoad() {
        let _this = this;
        wx.getStorage({
            key: "user",
            success: function (res) {
                _this.setData({
                    userInfo: res.data,
                });
            },
        });
        this.getUserList("");
        this.setData({
            pageLoaded: true,
        });
    },
    userDetail(e) {
        const { openid } = e.currentTarget.dataset;
        wx.navigateTo({
            url: `../userDetail/userDetail?openid=${openid}`,
        });
    },
    getUserList(objectId) {
        const params = { objectId };
        Api.getUserList(params)
            .then((result) => {
            if (result.code === 200) {
                let dataList = objectId ? this.data.userList : [];
                dataList = dataList.concat(result.data);
                dataList.map((data) => {
                    if (data.age && !data.age.toString().includes("岁")) {
                        data.age = data.age + "岁";
                    }
                });
                dataList.map((item) => {
                    if (item.photos && item.photos.length === 0) {
                        item.photos.push(item.avatarUrl);
                    }
                    item.intro = [];
                    if (item.age) {
                        item.intro.push(item.age);
                    }
                    if (item.jobGeneral) {
                        item.intro.push(item.jobGeneral);
                    }
                    if (item.jobDetail) {
                        item.intro.push(item.jobDetail);
                    }
                    if (item.education) {
                        item.intro.push(item.education);
                    }
                    item.intro = item.intro.join(" | ");
                });
                const { currentPage } = this.data;
                this.setData({
                    userList: dataList,
                    currentPage: currentPage + 1,
                });
            }
        })
            .catch((err) => {
            console.log("get user List", err);
        });
    },
    goMatch() {
        let rightType = "fateMatch";
        if (utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType);
        let userInfo = app.globalData.userInfo;
        if (userInfo && userInfo.phone) {
            wx.navigateTo({
                url: "../matching/matching",
            });
        }
        else {
            wx.navigateTo({
                url: "../registerXz/registerXz",
            });
        }
    },
    onShow: function () {
        const { pageLoaded } = this.data;
        if (pageLoaded) {
            this.getUserList("");
        }
    },
    onPullDownRefresh: function () { },
    onReachBottom: function () {
        let rightType = "fateWatch";
        const { userList, currentPage, pageSize } = this.data;
        if (currentPage > 2 && utils_1.dealRightIntercept(rightType)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        utils_1.setRightStorage(rightType, currentPage * pageSize);
        const lastId = userList.length > 0 ? userList[userList.length - 1]._id : "";
        this.getUserList(lastId);
    },
    closeDialog() {
        this.setData({
            showDialog: false,
        });
    },
    openSelect(e) {
        const optionType = e.target.dataset.optionType;
        this.setData({
            showSelect: true,
            optionType,
        });
    },
    dealWithRequestParameter() {
        const ageSelection = "";
        const heightSelection = "";
        const salarySelection = "";
        const reqParams = {};
        if (ageSelection) {
            reqParams.age = topMenuList_1.ageMenuList[ageSelection];
        }
        if (heightSelection) {
            reqParams.height = topMenuList_1.heightMenuList[heightSelection];
        }
        if (salarySelection) {
            reqParams.salary = salarySelection;
        }
        return reqParams;
    },
    onShareAppMessage: function (options) {
        console.log("onShareAppMessage options", options);
        return {};
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFDakQsNkNBQXdFO0FBRXhFLCtDQUE0RjtBQUM1RixNQUFNLEdBQUcsR0FBRyxNQUFNLEVBQVUsQ0FBQztBQUU3QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixRQUFRLEVBQUUsRUFBRTtRQUNaLFFBQVEsRUFBRSxFQUFXO1FBQ3JCLFlBQVksRUFBRSxFQUFFO1FBQ2hCLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLFdBQVcsRUFBRSxFQUFFO1FBQ2YsV0FBVyxFQUFFLEVBQUU7UUFDZixhQUFhLEVBQUUsRUFBRTtRQUNqQixZQUFZLEVBQUUsRUFBRTtRQUNoQixLQUFLLEVBQUUsRUFBRTtRQUNULFNBQVMsRUFBRSxJQUFJO1FBQ2YsVUFBVSxFQUFFLEtBQUs7UUFDakIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsV0FBVyxFQUFFLENBQUM7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLFVBQVUsRUFBRSxDQUFDO1FBQ2IsUUFBUSxFQUFFLEtBQUs7UUFDZixNQUFNLEVBQUUsS0FBSztRQUNiLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLGNBQWMsRUFBRTtZQUNkLFFBQVEsRUFBRSw0QkFBYyxFQUFFO1lBQzFCLFdBQVcsRUFBRSwrQkFBaUIsRUFBRTtZQUNoQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDO1NBQ3pEO1FBQ0QsVUFBVSxFQUFFLEtBQUs7UUFDakIsVUFBVSxFQUFFLFVBQVU7S0FDdkI7SUFFRCxNQUFNO1FBQ0osSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsTUFBTTtZQUNYLE9BQU8sRUFBRSxVQUFVLEdBQUc7Z0JBQ3BCLEtBQUssQ0FBQyxPQUFRLENBQUM7b0JB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LE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFLRCxpQkFBaUIsRUFBRSxVQUNqQixPQUFpRDtRQUVqRCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2xELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFwaSBmcm9tICcuLi8uLi9zZXJ2aWNlL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IGRlYWxSaWdodEludGVyY2VwdCwgc2V0UmlnaHRTdG9yYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgSU15QXBwIH0gZnJvbSAnLi4vLi4vYXBwJztcbmltcG9ydCB7Z2V0QWdlTWVudUxpc3QsIGdldEhlaWdodE1lbnVMaXN0LCBhZ2VNZW51TGlzdCwgaGVpZ2h0TWVudUxpc3R9IGZyb20gJy4vdG9wTWVudUxpc3QnXG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHVzZXJJbmZvOiB7fSxcbiAgICB1c2VyTGlzdDogW10gYXMgYW55W10sXG4gICAgY3VycnVzZXJMaXN0OiBbXSxcbiAgICBkYXRhQWxyZWFkeTogZmFsc2UsXG4gICAgY3VycmVudENpdHk6IFwiXCIsXG4gICAgc2VsZWN0VmFsdWU6IFwiXCIsXG4gICAgY3VycmVudFFyY29kZTogXCJcIixcbiAgICBjdXJyZW50UGhvbmU6IFwiXCIsXG4gICAgcGhvbmU6IFwiXCIsXG4gICAgcG9wSGlkZGVuOiB0cnVlLFxuICAgIHBhZ2VMb2FkZWQ6IGZhbHNlLFxuICAgIHBvcFdlY2hhdDogZmFsc2UsXG4gICAgY3VycmVudFBhZ2U6IDEsXG4gICAgcGFnZVNpemU6IDEwLCAvLyBkZWZhdWx0XG4gICAgdG90YWxDb3VudDogMCxcbiAgICBwdWxsRG93bjogZmFsc2UsXG4gICAgcHVsbFVwOiBmYWxzZSxcbiAgICBzaG93RGlhbG9nOiBmYWxzZSxcbiAgICB0b3BNZW51Q29udGVudDoge1xuICAgICAgYWdlQXJyYXk6IGdldEFnZU1lbnVMaXN0KCksXG4gICAgICBoZWlnaHRBcnJheTogZ2V0SGVpZ2h0TWVudUxpc3QoKSxcbiAgICAgIHNhbGFyeUFycmF5OiBbXCI15Y2D5Lul5LiLXCIsIFwiNeWNg++9njHkuIdcIiwgXCIx5LiH772eMuS4h1wiLCBcIjLkuIfvvZ415LiHXCIsIFwiNeS4h+S7peS4ilwiXSxcbiAgICB9LFxuICAgIHNob3dTZWxlY3Q6IGZhbHNlLFxuICAgIG9wdGlvblR5cGU6ICdhZ2VBcnJheScsXG4gIH0sXG5cbiAgb25Mb2FkKCkge1xuICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgd3guZ2V0U3RvcmFnZSh7XG4gICAgICBrZXk6IFwidXNlclwiLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICBfdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgdXNlckluZm86IHJlcy5kYXRhLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGhpcy5nZXRVc2VyTGlzdChcIlwiKTtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHBhZ2VMb2FkZWQ6IHRydWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqIOivpuaDhSAqL1xuICB1c2VyRGV0YWlsKGU6IGFueSkge1xuICAgIGNvbnN0IHsgb3BlbmlkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldDtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogYC4uL3VzZXJEZXRhaWwvdXNlckRldGFpbD9vcGVuaWQ9JHtvcGVuaWR9YCxcbiAgICB9KTtcbiAgICAvLyB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAvLyAgIHVybDogJy4uL3JlZ2lzdGVyUGhvbmUvcmVnaXN0ZXJQaG9uZScsXG4gICAgLy8gfSlcbiAgfSxcblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9iamVjdElkXG4gICAqIHBhZ2VTaXplIOm7mOiupCAxMFxuICAgKi9cbiAgZ2V0VXNlckxpc3Qob2JqZWN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHBhcmFtcyA9IHsgb2JqZWN0SWQgfTtcbiAgICBBcGkuZ2V0VXNlckxpc3QocGFyYW1zKVxuICAgICAgLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgIGlmIChyZXN1bHQuY29kZSA9PT0gMjAwKSB7XG4gICAgICAgICAgbGV0IGRhdGFMaXN0ID0gb2JqZWN0SWQgPyB0aGlzLmRhdGEudXNlckxpc3QgOiBbXTtcbiAgICAgICAgICBkYXRhTGlzdCA9IGRhdGFMaXN0LmNvbmNhdChyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgZGF0YUxpc3QubWFwKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGF0YS5hZ2UgJiYgIWRhdGEuYWdlLnRvU3RyaW5nKCkuaW5jbHVkZXMoXCLlsoFcIikpIHtcbiAgICAgICAgICAgICAgZGF0YS5hZ2UgPSBkYXRhLmFnZSArIFwi5bKBXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZGF0YUxpc3QubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS5waG90b3MgJiYgaXRlbS5waG90b3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgIGl0ZW0ucGhvdG9zLnB1c2goaXRlbS5hdmF0YXJVcmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5pbnRybyA9IFtdO1xuICAgICAgICAgICAgaWYgKGl0ZW0uYWdlKSB7XG4gICAgICAgICAgICAgIGl0ZW0uaW50cm8ucHVzaChpdGVtLmFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5qb2JHZW5lcmFsKSB7XG4gICAgICAgICAgICAgIGl0ZW0uaW50cm8ucHVzaChpdGVtLmpvYkdlbmVyYWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uam9iRGV0YWlsKSB7XG4gICAgICAgICAgICAgIGl0ZW0uaW50cm8ucHVzaChpdGVtLmpvYkRldGFpbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5lZHVjYXRpb24pIHtcbiAgICAgICAgICAgICAgaXRlbS5pbnRyby5wdXNoKGl0ZW0uZWR1Y2F0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW0uaW50cm8gPSBpdGVtLmludHJvLmpvaW4oXCIgfCBcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgeyBjdXJyZW50UGFnZSB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgdXNlckxpc3Q6IGRhdGFMaXN0LFxuICAgICAgICAgICAgY3VycmVudFBhZ2U6IGN1cnJlbnRQYWdlICsgMSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0IHVzZXIgTGlzdFwiLCBlcnIpO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgZ29NYXRjaCgpIHtcbiAgICBsZXQgcmlnaHRUeXBlID0gXCJmYXRlTWF0Y2hcIjsgLy8g57yY5YiG5Yy56YWNXG4gICAgaWYgKGRlYWxSaWdodEludGVyY2VwdChyaWdodFR5cGUpKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgc2hvd0RpYWxvZzogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZXRSaWdodFN0b3JhZ2UocmlnaHRUeXBlKTtcblxuICAgIGxldCB1c2VySW5mbyA9IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvO1xuICAgIGlmICh1c2VySW5mbyAmJiB1c2VySW5mby5waG9uZSkge1xuICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgIHVybDogXCIuLi9tYXRjaGluZy9tYXRjaGluZ1wiLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICB1cmw6IFwiLi4vcmVnaXN0ZXJYei9yZWdpc3Rlclh6XCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgeyBwYWdlTG9hZGVkIH0gPSB0aGlzLmRhdGE7XG4gICAgaWYgKHBhZ2VMb2FkZWQpIHtcbiAgICAgIHRoaXMuZ2V0VXNlckxpc3QoXCJcIik7XG4gICAgfVxuICB9LFxuXG4gIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7fSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHJpZ2h0VHlwZSA9IFwiZmF0ZVdhdGNoXCI7IC8vIOe8mOWIhuS4i+a7keafpeeci+mZkOWItlxuICAgIGNvbnN0IHsgdXNlckxpc3QsIGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSB9ID0gdGhpcy5kYXRhO1xuICAgIGlmIChjdXJyZW50UGFnZSA+IDIgJiYgZGVhbFJpZ2h0SW50ZXJjZXB0KHJpZ2h0VHlwZSkpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBzaG93RGlhbG9nOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldFJpZ2h0U3RvcmFnZShyaWdodFR5cGUsIGN1cnJlbnRQYWdlICogcGFnZVNpemUpO1xuICAgIGNvbnN0IGxhc3RJZCA9IHVzZXJMaXN0Lmxlbmd0aCA+IDAgPyB1c2VyTGlzdFt1c2VyTGlzdC5sZW5ndGggLSAxXS5faWQgOiBcIlwiO1xuICAgIHRoaXMuZ2V0VXNlckxpc3QobGFzdElkKTtcbiAgfSxcblxuICBjbG9zZURpYWxvZygpIHtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHNob3dEaWFsb2c6IGZhbHNlLFxuICAgIH0pO1xuICB9LFxuXG4gIC8vIHR5cGU6IGFnZUFycmF5LCBoZWlnaHRBcnJheSwgc2FsYXJ5QXJyYXlcbiAgb3BlblNlbGVjdChlOiBhbnkpIHtcbiAgICBjb25zdCBvcHRpb25UeXBlID0gZS50YXJnZXQuZGF0YXNldC5vcHRpb25UeXBlO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgc2hvd1NlbGVjdDogdHJ1ZSxcbiAgICAgIG9wdGlvblR5cGUsXG4gICAgfSk7XG4gIH0sXG5cbiAgLypcbiAgICDmoLnmja7pgInmi6nnmoTlubTpvoQsIOi6q+mrmCwg5pS25YWl6IyD5Zu0LCDovazmjaLmiJDlr7nlupTor7fmsYLlj4LmlbBcbiAgICBUb0RvOlxuICAgICAg6aG16Z2i5LiK5bm06b6ELCDouqvpq5gsIOaUtuWFpeiMg+WbtOmAieaLqVxuICAqL1xuICBkZWFsV2l0aFJlcXVlc3RQYXJhbWV0ZXIoKSB7XG4gICAgLy8gZ2V0IHNlbGVjdE9wdGlvbnMgZnJvbSB0aGlzLmRhdGFcbiAgICBjb25zdCBhZ2VTZWxlY3Rpb24gPSBcIlwiO1xuICAgIGNvbnN0IGhlaWdodFNlbGVjdGlvbiA9IFwiXCI7XG4gICAgY29uc3Qgc2FsYXJ5U2VsZWN0aW9uID0gXCJcIjtcbiAgICBjb25zdCByZXFQYXJhbXM6IGFueSA9IHt9O1xuICAgIGlmIChhZ2VTZWxlY3Rpb24pIHtcbiAgICAgcmVxUGFyYW1zLmFnZSA9IGFnZU1lbnVMaXN0W2FnZVNlbGVjdGlvbl07XG4gICAgfVxuICAgIGlmIChoZWlnaHRTZWxlY3Rpb24pIHtcbiAgICAgIHJlcVBhcmFtcy5oZWlnaHQgPSBoZWlnaHRNZW51TGlzdFtoZWlnaHRTZWxlY3Rpb25dXG4gICAgfVxuICAgIGlmIChzYWxhcnlTZWxlY3Rpb24pIHtcbiAgICAgIHJlcVBhcmFtcy5zYWxhcnkgPSBzYWxhcnlTZWxlY3Rpb247XG4gICAgfVxuICAgIHJldHVybiByZXFQYXJhbXM7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xuICAgKi9cbiAgb25TaGFyZUFwcE1lc3NhZ2U6IGZ1bmN0aW9uIChcbiAgICBvcHRpb25zPzogUGFnZS5JU2hhcmVBcHBNZXNzYWdlT3B0aW9uIHwgdW5kZWZpbmVkXG4gICk6IFBhZ2UuSUN1c3RvbVNoYXJlQ29udGVudCB7XG4gICAgY29uc29sZS5sb2coXCJvblNoYXJlQXBwTWVzc2FnZSBvcHRpb25zXCIsIG9wdGlvbnMpO1xuICAgIHJldHVybiB7fTtcbiAgfSxcbn0pOyJdfQ==
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Api = require("../../service/api.service");
const utils_1 = require("../../utils/utils");
Page({
    data: {
        openid: "",
        userInfo: {},
        showDialog: false,
        imagePreview: false,
        imagePreviewUrl: ""
    },
    onLoad: function (options) {
        this.setData({
            openid: options.openid,
        });
        this.getUserInfo(options.openid);
    },
    getUserInfo(openid) {
        Api.getUserInfo(openid).then((result) => {
            if (result.code == 200) {
                const userInfo = result.data;
                userInfo.intro = [];
                if (userInfo.age) {
                    userInfo.intro.push(userInfo.age);
                }
                if (userInfo.jobGeneral) {
                    userInfo.intro.push(userInfo.jobGeneral);
                }
                if (userInfo.jobDetail) {
                    userInfo.intro.push(userInfo.jobDetail);
                }
                if (userInfo.education) {
                    userInfo.intro.push(userInfo.education);
                }
                userInfo.intro = userInfo.intro.join(" | ");
                this.setData({
                    userInfo,
                });
            }
        });
    },
    putUsersLike() {
        const { openid } = this.data;
        Api.putUsersLike(openid).then((result) => {
            if (result.code == 200) {
                wx.showToast({
                    title: "收藏成功",
                    icon: "success",
                });
            }
        });
    },
    goChat() {
        if (utils_1.dealFateChatIntercept(this.data.openid)) {
            this.setData({
                showDialog: true,
            });
            return;
        }
        Api.startChatSession({
            userIds: [this.data.openid],
        }).then((result) => {
            if (result.code == 200) {
                console.log(`start chat session result`, result.data);
                wx.navigateTo({
                    url: `../chat/chat?openid=${this.data.openid}&cid=${result.data._id}`,
                });
            }
        });
    },
    _openImage: function (e) {
        const index = e.currentTarget.dataset.index;
        const userInfo = this.data.userInfo;
        if (!index && index !== 0) {
            this.data.imagePreviewUrl = userInfo.avatarUrl;
        }
        else {
            this.data.imagePreviewUrl = userInfo.photos[index];
        }
        this.setData({
            imagePreview: true,
            imagePreviewUrl: this.data.imagePreviewUrl
        });
    },
    _close: function () {
        this.setData({
            imagePreview: false,
        });
    },
    closeDialog: function () {
        this.setData({
            showDialog: false
        });
    },
    onReady: function () { },
    onShow: function () { },
    onHide: function () { },
    onUnload: function () { },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlckRldGFpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVzZXJEZXRhaWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBaUQ7QUFDakQsNkNBQTBEO0FBRTFELElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLE1BQU0sRUFBRSxFQUFFO1FBQ1YsUUFBUSxFQUFFLEVBQVM7UUFDbkIsVUFBVSxFQUFFLEtBQUs7UUFDakIsWUFBWSxFQUFFLEtBQUs7UUFDbkIsZUFBZSxFQUFFLEVBQUU7S0FDcEI7SUFFRCxNQUFNLEVBQUUsVUFBVSxPQUFZO1FBQzVCLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07U0FDdkIsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUdELFdBQVcsQ0FBQyxNQUFjO1FBQ3hCLEdBQUcsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBVyxFQUFFLEVBQUU7WUFDM0MsSUFBSSxNQUFNLENBQUMsSUFBSSxJQUFJLEdBQUcsRUFBRTtnQkFDdEIsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDN0IsUUFBUSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQ3BCLElBQUksUUFBUSxDQUFDLEdBQUcsRUFBRTtvQkFDaEIsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNuQztnQkFDRCxJQUFJLFFBQVEsQ0FBQyxVQUFVLEVBQUU7b0JBQ3ZCLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztpQkFDMUM7Z0JBQ0QsSUFBSSxRQUFRLENBQUMsU0FBUyxFQUFFO29CQUN0QixRQUFRLENBQUMsS0FBSyxDQUFDLElB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LEVBQUUsY0FBYSxDQUFDO0lBS3RCLFFBQVEsRUFBRSxjQUFhLENBQUM7Q0FDekIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQXBpIGZyb20gJy4uLy4uL3NlcnZpY2UvYXBpLnNlcnZpY2UnOyBcbmltcG9ydCB7IGRlYWxGYXRlQ2hhdEludGVyY2VwdCB9IGZyb20gXCIuLi8uLi91dGlscy91dGlsc1wiO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIG9wZW5pZDogXCJcIixcbiAgICB1c2VySW5mbzoge30gYXMgYW55LFxuICAgIHNob3dEaWFsb2c6IGZhbHNlLFxuICAgIGltYWdlUHJldmlldzogZmFsc2UsXG4gICAgaW1hZ2VQcmV2aWV3VXJsOiBcIlwiXG4gIH0sXG5cbiAgb25Mb2FkOiBmdW5jdGlvbiAob3B0aW9uczogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBvcGVuaWQ6IG9wdGlvbnMub3BlbmlkLFxuICAgIH0pO1xuICAgIHRoaXMuZ2V0VXNlckluZm8ob3B0aW9ucy5vcGVuaWQpO1xuICB9LFxuXG4gIC8qKiDojrflj5bnlKjmiLfkv6Hmga8gKi9cbiAgZ2V0VXNlckluZm8ob3BlbmlkOiBzdHJpbmcpIHtcbiAgICBBcGkuZ2V0VXNlckluZm8ob3BlbmlkKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5jb2RlID09IDIwMCkge1xuICAgICAgICBjb25zdCB1c2VySW5mbyA9IHJlc3VsdC5kYXRhO1xuICAgICAgICB1c2VySW5mby5pbnRybyA9IFtdO1xuICAgICAgICBpZiAodXNlckluZm8uYWdlKSB7XG4gICAgICAgICAgdXNlckluZm8uaW50cm8ucHVzaCh1c2VySW5mby5hZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VySW5mby5qb2JHZW5lcmFsKSB7XG4gICAgICAgICAgdXNlckluZm8uaW50cm8ucHVzaCh1c2VySW5mby5qb2JHZW5lcmFsKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXNlckluZm8uam9iRGV0YWlsKSB7XG4gICAgICAgICAgdXNlckluZm8uaW50cm8ucHVzaCh1c2VySW5mby5qb2JEZXRhaWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VySW5mby5lZHVjYXRpb24pIHtcbiAgICAgICAgICB1c2VySW5mby5pbnRyby5wdXNoKHVzZXJJbmZvLmVkdWNhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdXNlckluZm8uaW50cm8gPSB1c2VySW5mby5pbnRyby5qb2luKFwiIHwgXCIpO1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICB1c2VySW5mbyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqIOWFs+azqCjmlLbol48p5o6l5Y+jICovXG4gIHB1dFVzZXJzTGlrZSgpIHtcbiAgICBjb25zdCB7IG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuICAgIEFwaS5wdXRVc2Vyc0xpa2Uob3BlbmlkKS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5jb2RlID09IDIwMCkge1xuICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOiBcIuaUtuiXj+aIkOWKn1wiLFxuICAgICAgICAgIGljb246IFwic3VjY2Vzc1wiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICAvKiog5Y676IGK5aSpICovXG4gIGdvQ2hhdCgpIHtcbiAgICBpZiAoZGVhbEZhdGVDaGF0SW50ZXJjZXB0KHRoaXMuZGF0YS5vcGVuaWQpKSB7XG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgc2hvd0RpYWxvZzogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyDlvIDlp4vlm57or51cbiAgICBBcGkuc3RhcnRDaGF0U2Vzc2lvbih7XG4gICAgICB1c2VySWRzOiBbdGhpcy5kYXRhLm9wZW5pZF0sXG4gICAgfSkudGhlbigocmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIGlmIChyZXN1bHQuY29kZSA9PSAyMDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYHN0YXJ0IGNoYXQgc2Vzc2lvbiByZXN1bHRgLCByZXN1bHQuZGF0YSk7XG4gICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICAgIHVybDogYC4uL2NoYXQvY2hhdD9vcGVuaWQ9JHt0aGlzLmRhdGEub3BlbmlkfSZjaWQ9JHtyZXN1bHQuZGF0YS5faWR9YCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgX29wZW5JbWFnZTogZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGNvbnN0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgY29uc3QgdXNlckluZm8gPSB0aGlzLmRhdGEudXNlckluZm87XG4gICAgaWYgKCFpbmRleCAmJiBpbmRleCAhPT0gMCkge1xuICAgICAgdGhpcy5kYXRhLmltYWdlUHJldmlld1VybCA9IHVzZXJJbmZvLmF2YXRhclVybFxuICAgIH1lbHNle1xuICAgICAgdGhpcy5kYXRhLmltYWdlUHJldmlld1VybCA9IHVzZXJJbmZvLnBob3Rvc1tpbmRleF1cbiAgICB9XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBpbWFnZVByZXZpZXc6IHRydWUsXG4gICAgICBpbWFnZVByZXZpZXdVcmw6IHRoaXMuZGF0YS5pbWFnZVByZXZpZXdVcmxcbiAgICB9KTtcbiAgfSxcbiAgXG4gIF9jbG9zZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaW1hZ2VQcmV2aWV3OiBmYWxzZSxcbiAgICB9KTtcbiAgfSxcblxuICBjbG9zZURpYWxvZzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBzaG93RGlhbG9nOiBmYWxzZVxuICAgIH0pXG4gIH0sXG5cbiAgb25SZWFkeTogZnVuY3Rpb24gKCkge30sXG5cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7fSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge30sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XG4gICAqL1xuICBvblVubG9hZDogZnVuY3Rpb24gKCkge30sXG59KTsiXX0=
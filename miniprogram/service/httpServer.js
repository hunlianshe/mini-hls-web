"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("../config");
const loading_1 = require("./loading");
const _handleResponse = (res, { resolve, reject }) => {
    if (res.code == 401) {
        wx.navigateTo({
            url: '../login/login?auth=true',
        });
        return;
    }
    if (res.code === 500) {
        reject(res);
        throw res.msg;
    }
    resolve(res);
};
const _request = (...argus) => {
    let user;
    try {
        user = wx.getStorageSync('user');
        console.log('user', user);
        const header_pre = {
            'authorization': 'Bearer ' + user.token,
            'content-type': 'application/json'
        };
        let options = argus[0];
        let { method = 'GET', url, data = {}, header, reject = function () { console.log('default reject func'); }, } = options;
        let { needLoading = '0' } = data;
        if (needLoading === '1') {
            loading_1.default.show();
        }
        wx.request({
            url: config_1.default.hostUrl + url,
            method: method,
            data: data,
            header: Object.assign({}, header_pre, header),
            success: (res) => {
                _handleResponse(res.data, options);
            },
            fail: (res) => {
                if (reject) {
                    reject(res);
                }
            },
            complete: () => {
                if (needLoading === '1') {
                    loading_1.default.hide();
                }
            }
        });
    }
    catch (e) {
        console.log('请求异常');
    }
};
const promisify = (callback) => {
    return (options, ...params) => {
        return new Promise((resolve, reject) => {
            callback(Object.assign({}, options, { resolve: resolve, reject: reject }), ...params);
        });
    };
};
const _get = (...argus) => _request(Object.assign({}, argus[0], { method: 'GET' }));
const _put = (...argus) => _request(Object.assign({}, argus[0], { method: 'PUT' }));
const _post = (...argus) => _request(Object.assign({}, argus[0], { method: 'POST' }));
const _post_form = (...argus) => _request(Object.assign({}, argus[0], {
    method: 'POST',
    header: {
        'authorization': 'Bearer ' + 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJQd0MgTmV3IFZlbnR1cmVzIiwiaWF0IjoxNTQxNTc3MTE4LCJleHAiOjE2MDQ3MzU1MTgsImF1ZCI6InB3Yy5jb20iLCJzdWIiOiJQd0MgTmV3IFZlbnR1cmVzIHRlc3QgdG9rZW4iLCJjbGllbnROYW1lIjoiUHdDIE9uZUNoYXQifQ.d4_jlSqDndisproPjiy1zy1_aELwMYVLk_nQRwCGcTc',
        'content-type': 'application/x-www-form-urlencoded'
    }
}));
let HttpServer = {
    get: promisify(_get),
    put: promisify(_put),
    post: promisify(_post),
    post_form: promisify(_post_form),
};
exports.default = HttpServer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cFNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImh0dHBTZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxzQ0FBK0I7QUFDL0IsdUNBQWdDO0FBRWhDLE1BQU0sZUFBZSxHQUFHLENBQUMsR0FBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBTyxFQUFFLEVBQUU7SUFDN0QsSUFBSSxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsRUFBRTtRQUNuQixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLDBCQUEwQjtTQUNoQyxDQUFDLENBQUE7UUFDRixPQUFNO0tBQ1A7SUFDRCxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssR0FBRyxFQUFFO1FBQ3BCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNaLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQztLQUNmO0lBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQyxDQUFBO0FBRUQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFHLEtBQVksRUFBRSxFQUFFO0lBQ25DLElBQUksSUFBVSxDQUFDO0lBQ2YsSUFBSTtRQUNGLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3pCLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLGVBQWUsRUFBRSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUs7WUFDdkMsY0FBYyxFQUFFLGtCQUFrQjtTQUNuQyxDQUFDO1FBQ0YsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFDRixNQUFNLEdBQUcsS0FBSyxFQUNkLEdBQUcsRUFDSCxJQUFJLEdBQUcsRUFBRSxFQUNULE1BQU0sRUFDTixNQUFNLEdBQUcsY0FBYyxPQUFPLENBQUMsR0FBRyxDQUFD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QUFHLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQztJQUNwQixHQUFHLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQztJQUNwQixJQUFJLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQztJQUN0QixTQUFTLEVBQUUsU0FBUyxDQUFDLFVBQVUsQ0FBQztDQUNqQyxDQUFDO0FBTUYsa0JBQWUsVUFBVSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnJztcclxuaW1wb3J0IGxvYWRpbmcgZnJvbSAnLi9sb2FkaW5nJztcclxuXHJcbmNvbnN0IF9oYW5kbGVSZXNwb25zZSA9IChyZXM6IGFueSwgeyByZXNvbHZlLCByZWplY3QgfTogYW55KSA9PiB7XHJcbiAgaWYgKHJlcy5jb2RlID09IDQwMSkge1xyXG4gICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgIHVybDogJy4uL2luZGV4L2luZGV4P2F1dGg9dHJ1ZScsXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuXHJcbiAgfVxyXG4gIGlmIChyZXMuY29kZSA9PT0gNTAwKSB7XHJcbiAgICByZWplY3QocmVzKTtcclxuICAgIHRocm93IHJlcy5tc2c7XHJcbiAgfVxyXG4gIHJlc29sdmUocmVzKTtcclxufVxyXG5cclxuY29uc3QgX3JlcXVlc3QgPSAoLi4uYXJndXM6IGFueVtdKSA9PiB7XHJcbiAgbGV0IHVzZXI6IFVzZXI7XHJcbiAgdHJ5IHtcclxuICAgIHVzZXIgPSB3eC5nZXRTdG9yYWdlU3luYygndXNlcicpO1xyXG4gICAgY29uc29sZS5sb2coJ3VzZXInLCB1c2VyKVxyXG4gICAgY29uc3QgaGVhZGVyX3ByZSA9IHtcclxuICAgICAgJ2F1dGhvcml6YXRpb24nOiAnQmVhcmVyICcgKyB1c2VyLnRva2VuLFxyXG4gICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICB9O1xyXG4gICAgbGV0IG9wdGlvbnMgPSBhcmd1c1swXTtcclxuICAgIGxldCB7XHJcbiAgICAgIG1ldGhvZCA9ICdHRVQnLFxyXG4gICAgICB1cmwsXHJcbiAgICAgIGRhdGEgPSB7fSxcclxuICAgICAgaGVhZGVyLFxyXG4gICAgICByZWplY3QgPSBmdW5jdGlvbiAoKSB7IGNvbnNvbGUubG9nKCdkZWZhdWx0IHJlamVjdCBmdW5jJykgfSxcclxuICAgIH0gPSBvcHRpb25zO1xyXG4gICAgbGV0IHsgbmVlZExvYWRpbmcgPSAnMCcgfSA9IGRhdGE7XHJcbiAgICBpZiAobmVlZExvYWRpbmcgPT09ICcxJykge1xyXG4gICAgICBsb2FkaW5nLnNob3coKTtcclxuICAgIH1cclxuICAgIHd4LnJlcXVlc3Qoe1xyXG4gICAgICB1cmw6IGNvbmZpZy5ob3N0VXJsICsgdXJsLFxyXG4gICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgaGVhZGVyOiBPYmplY3QuYXNzaWduKHt9LCBoZWFkZXJfcHJlLCBoZWFkZXIpLFxyXG4gICAgICBzdWNjZXNzOiAocmVzOiBhbnkpID0+IHtcclxuICAgICAgICBfaGFuZGxlUmVzcG9uc2UocmVzLmRhdGEsIG9wdGlvbnMpO1xyXG4gICAgICB9LFxyXG4gICAgICBmYWlsOiAocmVzOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAocmVqZWN0KSB7XHJcbiAgICAgICAgICByZWplY3QocmVzKVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgY29tcGxldGU6ICgpID0+IHtcclxuICAgICAgICBpZiAobmVlZExvYWRpbmcgPT09ICcxJykge1xyXG4gICAgICAgICAgbG9hZGluZy5oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBjb25zb2xlLmxvZygn6K+35rGC5byC5bi4Jyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgcHJvbWlzaWZ5ID0gKGNhbGxiYWNrOiBhbnkpID0+IHtcclxuICByZXR1cm4gKG9wdGlvbnM6IGFueSwgLi4ucGFyYW1zOiBhbnlbXSkgPT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY2FsbGJhY2soT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywgeyByZXNvbHZlOiByZXNvbHZlLCByZWplY3Q6IHJlamVjdCB9KSwgLi4ucGFyYW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgX2dldCA9ICguLi5hcmd1czogYW55KSA9PiBfcmVxdWVzdChPYmplY3QuYXNzaWduKHt9LCBhcmd1c1swXSwgeyBtZXRob2Q6ICdHRVQnIH0pKTtcclxuY29uc3QgX3B1dCA9ICguLi5hcmd1czogYW55KSA9PiBfcmVxdWVzdChPYmplY3QuYXNzaWduKHt9LCBhcmd1c1swXSwgeyBtZXRob2Q6ICdQVVQnIH0pKTtcclxuY29uc3QgX3Bvc3QgPSAoLi4uYXJndXM6IGFueSkgPT4gX3JlcXVlc3QoT2JqZWN0LmFzc2lnbih7fSwgYXJndXNbMF0sIHsgbWV0aG9kOiAnUE9TVCcgfSkpO1xyXG5jb25zdCBfcG9zdF9mb3JtID0gKC4uLmFyZ3VzOiBhbnkpID0+IF9yZXF1ZXN0KE9iamVjdC5hc3NpZ24oe30sIGFyZ3VzWzBdLCB7XHJcbiAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgaGVhZGVyOiB7XHJcbiAgICAnYXV0aG9yaXphdGlvbic6ICdCZWFyZXIgJyArICdleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpJVXpJMU5pSjkuZXlKcGMzTWlPaUpRZDBNZ1RtVjNJRlpsYm5SMWNtVnpJaXdpYVdGMElqb3hOVFF4TlRjM01URTRMQ0psZUhBaU9qRTJNRFEzTXpVMU1UZ3NJbUYxWkNJNkluQjNZeTVqYjIwaUxDSnpkV0lpT2lKUWQwTWdUbVYzSUZabGJuUjFjbVZ6SUhSbGMzUWdkRzlyWlc0aUxDSmpiR2xsYm5ST1lXMWxJam9pVUhkRElFOXVaVU5vWVhRaWZRLmQ0X2psU3FEbmRpc3Byb1BqaXkxenkxX2FFTHdNWVZMa19uUVJ3Q0djVGMnLFxyXG4gICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnXHJcbiAgfVxyXG59KSk7XHJcblxyXG5sZXQgSHR0cFNlcnZlciA9IHtcclxuICBnZXQ6IHByb21pc2lmeShfZ2V0KSxcclxuICBwdXQ6IHByb21pc2lmeShfcHV0KSxcclxuICBwb3N0OiBwcm9taXNpZnkoX3Bvc3QpLFxyXG4gIHBvc3RfZm9ybTogcHJvbWlzaWZ5KF9wb3N0X2Zvcm0pLFxyXG59O1xyXG5cclxuaW50ZXJmYWNlIFVzZXIge1xyXG4gIHRva2VuOiBzdHJpbmcsXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEh0dHBTZXJ2ZXJcclxuXHJcblxyXG4iXX0=